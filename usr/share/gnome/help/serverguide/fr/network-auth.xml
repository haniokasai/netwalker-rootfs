<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN" "http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd" [
<!ENTITY % globalent SYSTEM "../../libs/global.ent">
<!-- NAMES --><!ENTITY canonical-name "Canonical Ltd.">
<!ENTITY project-name "Ubuntu Documentation Project">
<!ENTITY ubuntu "<phrase>Ubuntu</phrase>">
<!ENTITY sg-title "Server Guide">
<!-- VERSIONS --><!ENTITY distro-version "Jaunty Jackalope">
<!ENTITY distro-rev "9.04">
<!ENTITY distro-release-date "April 2009">
<!ENTITY distro-short-codename "jaunty">
<!ENTITY distro-apt-cd-name "Ubuntu 9.04_Jaunty_Jackalope">
<!ENTITY linux-kernel-version "2.6.27">
<!ENTITY gcc-version "4.3.1">
<!ENTITY glibc-version "2.8">
<!ENTITY python-version "2.5">
<!ENTITY glossary SYSTEM "../common/C/glossary.xml">
<!-- LEGAL URLs --><!ENTITY legalnotice SYSTEM "../libs/C/legalnotice.xml">
<!ENTITY gpl-url '<ulink url="http://www.gnu.org/licenses/gpl.html">GNU General Public License</ulink>'>
<!ENTITY cc "http://creativecommons.org/">
<!ENTITY cc-attrib '<ulink url="http://creativecommons.org/licenses/by-sa/2.5/">Attribution-ShareAlike 2.5</ulink>'>
<!ENTITY cc-fulldeed-url "http://creativecommons.org/licenses/by-sa/2.5/legalcode/">
<!ENTITY fdl-url '<ulink url="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License</ulink>'>
<!ENTITY cc-disclaimer-url "http://creativecommons.org/licenses/disclaimer-popup?lang=en">
<!-- CANONICAL URL RESOURCES --><!ENTITY canonical-url "http://www.canonical.com">
<!-- OTHER UBUNTU RELATED RESOURCES --><!ENTITY upstart-url "http://upstart.ubuntu.com">
<!-- UBUNTU IRC INFORMATION --><!ENTITY irc-network "Freenode">
<!ENTITY irc-server "irc.ubuntu.com">
<!ENTITY ubuntu-irc "irc.ubuntu.com channel #ubuntu">
<!ENTITY kubuntu-irc "irc.ubuntu.com channel #kubuntu">
<!ENTITY xubuntu-irc "irc.ubuntu.com channel #xubuntu">
<!ENTITY edubuntu-irc "irc.ubuntu.com channel #edubuntu">
<!-- UBUNTU URL RESOURCES --><!ENTITY ubuntu-packages "http://packages.ubuntu.com">
<!ENTITY ubuntu-web "http://www.ubuntu.com">
<!ENTITY ubuntu-main "http://www.ubuntu.com">
<!ENTITY ubuntu-download "http://www.ubuntu.com/download">
<!ENTITY ubuntu-forums "http://www.ubuntu.com/community/forums">
<!ENTITY ubuntu-components "http://www.ubuntu.com/ubuntu/components">
<!ENTITY ubuntu-lists "http://lists.ubuntu.com">
<!ENTITY ubuntu-wiki "http://wiki.ubuntu.com">
<!ENTITY ubuntu-bugzilla "https://launchpad.net/distros/ubuntu/+bugs">
<!ENTITY ubuntu-doc-bugs "https://launchpad.net/products/ubuntu-doc/+bugs">
<!ENTITY ubuntu-support "http://www.ubuntu.com/support">
<!ENTITY ubuntu-paidsupport "http://www.ubuntu.com/support/paid">
<!ENTITY ubuntu-freesupport "http://www.ubuntu.com/support/free">
<!ENTITY ubuntu-comments "http://www.ubuntuforums.org/showthread.php?p=21787">
<!ENTITY ubuntu-documentation "http://help.ubuntu.com">
<!ENTITY ubuntu-documentation-repos "https://docteam.ubuntu.com/repos/trunk">
<!ENTITY ubuntu-doc-team "https://wiki.ubuntu.com/DocumentationTeam">
<!ENTITY ubuntu-doc-list "http://lists.ubuntu.com/mailman/listinfo/ubuntu-doc">
<!ENTITY ubuntu-shipit "http://shipit.ubuntu.com">
<!ENTITY ubuntu-launchpad "https://launchpad.ubuntu.com">
<!ENTITY ubuntu-rosetta "https://launchpad.ubuntu.com/rosetta">
<!ENTITY ubuntu-planet "http://planet.ubuntu.com">
<!ENTITY ubuntu-philosophy "http://www.ubuntu.com/ubuntu/philosophy">
<!ENTITY ubuntu-participate "http://www.ubuntu.com/community/participate/">
<!ENTITY ubuntu-marketplace "http://www.ubuntu.com/support/marketplace">
<!ENTITY ubuntu-hwdb "http://hwdb.ubuntu.com">
<!-- UBUNTU WIKI RESOURCES --><!ENTITY wiki-UserDocumentation "https://help.ubuntu.com/community/UserDocumentation">
<!ENTITY restricted-formats "https://help.ubuntu.com/community/RestrictedFormats">
<!ENTITY wiki-RestrictedFormats "https://help.ubuntu.com/community/RestrictedFormats">
<!ENTITY wiki-XChatHowto "https://help.ubuntu.com/community/XChatHowto">
<!ENTITY wiki-RootSudo "https://help.ubuntu.com/community/RootSudo">
<!ENTITY wiki-HowToGetHelp "https://help.ubuntu.com/community/HowToGetHelp">
<!ENTITY transcode "https://help.ubuntu.com/community/DVDRippingandEncoding">
<!ENTITY wiki-Wine "https://help.ubuntu.com/community/Wine">
<!ENTITY wiki-Cedega "https://help.ubuntu.com/community/Cedega">
<!ENTITY wiki-Nano "https://help.ubuntu.com/community/NanoHowto">
<!ENTITY wiki-locoteams "https://wiki.ubuntu.com/LoCoTeamList">
<!ENTITY wiki-BasicCommands "https://help.ubuntu.com/community/BasicCommands">
<!ENTITY wiki-filepermissions "https://help.ubuntu.com/community/FilePermissions">
<!-- KUBUNTU URL RESOURCES --><!ENTITY kubuntu-web "http://www.kubuntu.org">
<!ENTITY kubuntu-main "http://www.kubuntu.org">
<!ENTITY kubuntu-download "http://releases.ubuntu.com/kubuntu/">
<!ENTITY kubuntu-packages "http://packages.ubuntu.com/edgy/">
<!ENTITY kubuntu-cdpackages-nodefault "http://people.ubuntu.com/~cjwatson/seeds/kubuntu-edgy/ship">
<!ENTITY kubuntu-lists "http://lists.ubuntu.com/archives/kubuntu-users/">
<!ENTITY kubuntu-lists-users "http://lists.ubuntu.com/mailman/listinfo/kubuntu-users/">
<!ENTITY kubuntu-lists-devel "http://lists.ubuntu.com/mailman/listinfo/kubuntu-devel/">
<!ENTITY kubuntu-mirrors "http://distrowatch.com/kubuntu">
<!ENTITY kubuntu-forums "http://kubuntuforums.net">
<!ENTITY kubuntu-wiki "https://wiki.kubuntu.org">
<!ENTITY kubuntu-documentation-site "http://www.kubuntu.org/documentation.php">
<!ENTITY kubuntu-wiki-UserDocumentation "https://help.ubuntu.com/community/UserDocumentation">
<!ENTITY kubuntu-support "http://www.kubuntu.org/support.php">
<!-- XUBUNTU URL RESOURCES --><!ENTITY xubuntu-web "http://www.xubuntu.org">
<!ENTITY xubuntu-main "http://www.xubuntu.org">
<!ENTITY xubuntu-web-help "http://www.xubuntu.org/help">
<!-- DEBIAN RESOURCES --><!ENTITY debian-apt "http://www.debian.org/doc/user-manuals#apt-howto">
<!-- EXTERNAL URL RESOURCES --><!ENTITY linmodem "http://www.linmodems.org/">
<!ENTITY gnome "http://www.gnome.org/">
<!ENTITY linuxorg "http://www.linux.org/">
<!ENTITY ooo "http://www.openoffice.org/">
<!ENTITY kde "http://www.kde.org/">
<!ENTITY lugww "http://lugww.counter.li.org/">
<!ENTITY ubuntu-watch "http://distrowatch.com/ubuntu/">
<!ENTITY realplayer-download "http://www.real.com/linux/">
<!ENTITY nvu-download "http://www.nvu.com/download.html">
<!ENTITY sunjava-download "http://java.sun.com/j2se/1.5.0/download.jsp">
<!ENTITY xorg "http://www.x.org">
<!ENTITY dyndns "http://www.dyndns.org">
<!ENTITY shoutcast "http://www.shoutcast.com/">
<!ENTITY freedomtoaster "http://www.freedomtoaster.org/">
<!ENTITY xfce "http://www.xfce.org/">
<!-- ubuntu-screenshots TODO --><!ENTITY kubuntu-screenshots "http://shots.osdir.com/">
<!ENTITY mozilla "http://www.mozilla.org/">
<!ENTITY mozilla-firefox "http://www.mozilla.org/products/firefox/">
<!ENTITY gnu "http://www.gnu.org/">
<!ENTITY gnu-philosophy "http://www.gnu.org/philosophy/">
<!ENTITY win4lin "http://www.win4lin.com">
<!ENTITY codeweavers "http://www.codeweavers.com">
<!ENTITY kernel "http://www.kernel.org">
<!ENTITY google "http://www.google.com">
<!ENTITY kdelook " http://www.kde-look.org">
<!ENTITY lulu-store "http://www.lulu.com/ubuntu-doc">
<!-- this entity controls the url for addons--><!ENTITY java-download "http://java.sun.com/j2se/1.5.0/download.jsp">
<!ENTITY skype-deb "skype_1.2.0.17-1_i386.deb">
<!ENTITY skype-download "http://www.skype.com/go/getskype-linux-deb">
<!ENTITY scanmodem-gz "scanModem.gz">
<!ENTITY scanmodem-url "http://linmodems.technion.ac.il/packages/scanModem.gz">
<!ENTITY ext2fs-url "http://www.fs-driver.org/index.html">
<!ENTITY mvb-tar "mvb_1.6.tgz">
<!ENTITY mvb-url "http://www.xscd.com/pub/mvb/&mvb-tar;">
<!-- TLDP --><!ENTITY ldp-pre-install-check "http://tldp.org/HOWTO/Pre-Installation-Checklist/">
<!-- LANGUAGES (sorted by two letter code)--><!ENTITY Afar "aa">
<!ENTITY Abkhazian "ab">
<!ENTITY Afrikaans "af">
<!ENTITY Amharic "af">
<!ENTITY Arabic "ar">
<!ENTITY Assamese "as">
<!ENTITY Aymara "ay">
<!ENTITY Azerbaijani "az">
<!ENTITY Bashkir "ba">
<!ENTITY Byelorussian "be">
<!ENTITY Bulgarian "bg">
<!ENTITY Bihari "bh">
<!ENTITY Bislama "bi">
<!ENTITY Bangla "bn">
<!ENTITY Bengali "bn">
<!ENTITY Tibetan "bo">
<!ENTITY Breton "br">
<!ENTITY Catalan "ca">
<!ENTITY Corsican "co">
<!ENTITY Czech "cs">
<!ENTITY Welsh "cy">
<!ENTITY Danish "da">
<!ENTITY German "de">
<!ENTITY Bhutani "dz">
<!ENTITY Greek "el">
<!-- <!ENTITY EnglishAmerican 'en'> --><!ENTITY EnglishAmerican "C">
<!ENTITY Esperanto "eo">
<!ENTITY Spanish "es">
<!ENTITY Estonian "et">
<!ENTITY Basque "eu">
<!ENTITY Persian "fa">
<!ENTITY Finnish "fi">
<!ENTITY Fiji "fj">
<!ENTITY Faeroese "fo">
<!ENTITY French "fr">
<!ENTITY Frisian "fy">
<!ENTITY Irish "ga">
<!ENTITY Gaelic "gd">
<!ENTITY ScotsGaelic "gd">
<!ENTITY Galician "gl">
<!ENTITY Guarani "gn">
<!ENTITY Gujarati "gu">
<!ENTITY Hausa "ha">
<!ENTITY Hindi "hi">
<!ENTITY Croatian "hr">
<!ENTITY Hungarian "hu">
<!ENTITY Armenian "hy">
<!ENTITY Interlingua "ia">
<!ENTITY Interlingue "ie">
<!ENTITY Inupiak "ik">
<!ENTITY Indonesian "in">
<!ENTITY Icelandic "is">
<!ENTITY Italian "it">
<!ENTITY Hebrew "iw">
<!ENTITY Japanese "ja">
<!ENTITY Yiddish "ji">
<!ENTITY Javanese "jw">
<!ENTITY Georgian "ka">
<!ENTITY Kazakh "kk">
<!ENTITY Greenlandic "kl">
<!ENTITY Cambodian "km">
<!ENTITY Kannada "kn">
<!ENTITY Korean "ko">
<!ENTITY Kashmiri "ks">
<!ENTITY Kurdish "ku">
<!ENTITY Kirghiz "ky">
<!ENTITY Latin "la">
<!ENTITY Lingala "ln">
<!ENTITY Laothian "lo">
<!ENTITY Lithuanian "lt">
<!ENTITY Latvian "lv">
<!ENTITY Lettish "lv">
<!ENTITY Malagasy "mg">
<!ENTITY Maori "mi">
<!ENTITY Macedonian "mk">
<!ENTITY Malayalam "ml">
<!ENTITY Mongolian "mn">
<!ENTITY Moldavian "mo">
<!ENTITY Marathi "mr">
<!ENTITY Malay "ms">
<!ENTITY Maltese "mt">
<!ENTITY Burmese "my">
<!ENTITY Nauru "na">
<!ENTITY Nepali "ne">
<!ENTITY Dutch "nl">
<!ENTITY Norwegian "no">
<!ENTITY Occitan "oc">
<!ENTITY Afan "om">
<!ENTITY Oromo "om">
<!ENTITY Oriya "or">
<!ENTITY Punjabi "pa">
<!ENTITY Polish "pl">
<!ENTITY Pushto "ps">
<!ENTITY Pashto "ps">
<!ENTITY Portuguese "pt">
<!ENTITY Quechua "qu">
<!ENTITY Rhaeto-Romance "rm">
<!ENTITY Kirundi "rn">
<!ENTITY Romanian "ro">
<!ENTITY Russian "ru">
<!ENTITY Kinyarwanda "rw">
<!ENTITY Sanskrit "sa">
<!ENTITY Sindhi "sd">
<!ENTITY Sangro "sg">
<!ENTITY Serbo-Croatian "sh">
<!ENTITY Singhalese "si">
<!ENTITY Slovak "sk">
<!ENTITY Slovenian "sl">
<!ENTITY Samoan "sm">
<!ENTITY Shona "sn">
<!ENTITY Somali "so">
<!ENTITY Albanian "sq">
<!ENTITY Serbian "sr">
<!ENTITY Siswati "ss">
<!ENTITY Sesotho "st">
<!ENTITY Sudanese "su">
<!ENTITY Swedish "sv">
<!ENTITY Swahili "sw">
<!ENTITY Tamil "ta">
<!ENTITY Tegulu "te">
<!ENTITY Tajik "tg">
<!ENTITY Thai "th">
<!ENTITY Tigrinya "ti">
<!ENTITY Turkmen "tk">
<!ENTITY Tagalog "tl">
<!ENTITY Setswana "tn">
<!ENTITY Tonga "to">
<!ENTITY Turkish "tr">
<!ENTITY Tsonga "ts">
<!ENTITY Tatar "tt">
<!ENTITY Twi "tw">
<!ENTITY Ukrainian "uk">
<!ENTITY Urdu "ur">
<!ENTITY Uzbek "uz">
<!ENTITY Vietnamese "vi">
<!ENTITY Volapuk "vo">
<!ENTITY Wolof "wo">
<!ENTITY Xhosa "xh">
<!ENTITY Yoruba "yo">
<!ENTITY Chinese "zh">
<!ENTITY Zulu "zu">
<!ENTITY % gnome-menus-C SYSTEM "../../libs/gnome-menus-C.ent">
<!-- MENUS --><!-- Please keep entries alphabetical, it makes them much easier to find & use --><!ENTITY about-me "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>About-me</guimenuitem></menuchoice>">
<!ENTITY accessories "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Accessories</guimenuitem></menuchoice>">
<!ENTITY acro-read "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Graphics</guimenuitem><guimenuitem>Acrobat Reader</guimenuitem></menuchoice>">
<!ENTITY administration "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem></menuchoice>">
<!ENTITY aisleriot "<menuchoice><guimenuitem>Applications</guimenuitem><guimenuitem>Games</guimenuitem><guimenuitem>AisleRiot Solitaire</guimenuitem></menuchoice>">
<!ENTITY amule "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>aMule</guimenuitem></menuchoice>">
<!ENTITY anjuta-ide "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Programming</guimenuitem><guimenuitem>Anjuta IDE</guimenuitem></menuchoice>">
<!ENTITY archive-man "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Accessories</guimenuitem><guimenuitem>Archive Manager</guimenuitem></menuchoice>">
<!ENTITY assistive-technology-preferences "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Assistive Technology Support</guimenuitem></menuchoice>">
<!ENTITY audacity "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Sound &amp; Video</guisubmenu><guimenuitem>Audacity</guimenuitem></menuchoice>">
<!ENTITY azureus "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Azureus</guimenuitem></menuchoice>">
<!ENTITY baobab "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Accessories</guimenuitem><guimenuitem>Disk Usage Analyzer</guimenuitem></menuchoice>">
<!ENTITY bittorrent "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Bittorrent</guimenuitem></menuchoice>">
<!ENTITY blender3d "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Graphics</guimenuitem><guimenuitem>Blender 3d modeller</guimenuitem></menuchoice>">
<!ENTITY bluefish "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Programming</guimenuitem><guimenuitem>Bluefish Editor</guimenuitem></menuchoice>">
<!ENTITY boot "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Boot</guimenuitem></menuchoice>">
<!ENTITY brasero "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem><guimenuitem>Brasero Disc Burning</guimenuitem></menuchoice>">
<!ENTITY bum "<menuchoice><guimenu>System</guimenu><guisubmenu>Administration</guisubmenu><guimenuitem>Boot-up Manager</guimenuitem></menuchoice>">
<!ENTITY bzrgtk "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Programming</guisubmenu><guimenuitem>Olive bazaar Branch Manager</guimenuitem></menuchoice>">
<!ENTITY calculator "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Accessories</guimenuitem><guimenuitem>Calculator</guimenuitem></menuchoice>">
<!ENTITY character-map "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Accessories</guimenuitem><guimenuitem>Character Map</guimenuitem></menuchoice>">
<!ENTITY compizconfig "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>CompizConfig Settings Manager</guimenuitem></menuchoice>">
<!ENTITY computer "<menuchoice><guimenu>Places</guimenu><guimenuitem>Computer</guimenuitem></menuchoice>">
<!ENTITY connecttoserver "<menuchoice><guimenu>Places</guimenu><guimenuitem>Connect to Server...</guimenuitem></menuchoice>">
<!ENTITY cowbell "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Sound &amp; Video</guisubmenu><guimenuitem>Cowbell Music Organizer</guimenuitem>	</menuchoice>">
<!ENTITY chromium "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Games</guisubmenu><guisubmenu>Chromium</guisubmenu></menuchoice>">
<!ENTITY computer-janitor "<menuchoice><guimenu>System</guimenu><guisubmenu>Administration</guisubmenu><guisubmenu>System Janitor</guisubmenu></menuchoice>">
<!ENTITY desktop-background "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Desktop Background</guimenuitem></menuchoice>">
<!ENTITY desktop-effects "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Appearance</guimenuitem><guimenuitem>Visual Effects</guimenuitem></menuchoice>">
<!ENTITY desktop-preferences "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem></menuchoice>">
<!ENTITY devhelp "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Programming</guisubmenu><guimenuitem>Devhelp</guimenuitem></menuchoice>">
<!ENTITY device-manager "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Hardware Information</guimenuitem></menuchoice>">
<!ENTITY dictionary "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Accessories</guimenuitem><guimenuitem>Dictionary</guimenuitem></menuchoice>">
<!ENTITY disks "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Disks</guimenuitem></menuchoice>">
<!ENTITY downloader-x "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Downloader for X</guimenuitem></menuchoice>">
<!ENTITY eclipse-ide "<menuchoice><guimenuitem>Applications</guimenuitem><guimenuitem>Programming</guimenuitem><guimenuitem>Eclipse IDE</guimenuitem></menuchoice>">
<!ENTITY ekiga "<menuchoice><guimenuitem>Applications</guimenuitem><guimenuitem>Internet</guimenuitem><guimenuitem>Ekiga Softphone</guimenuitem></menuchoice>">
<!ENTITY efax-gtk "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Office</guisubmenu><guimenuitem>Efax-gtk</guimenuitem></menuchoice>">
<!ENTITY etherape "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Etherape</guimenuitem></menuchoice>">
<!ENTITY evolution-mail "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Evolution Mail</guimenuitem></menuchoice>">
<!ENTITY file-management "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>File Management</guimenuitem></menuchoice>">
<!ENTITY firefox "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Internet</guisubmenu><guimenuitem>Firefox Web Browser</guimenuitem></menuchoice>">
<!ENTITY firestarter-firewall-tool "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Firestarter</guimenuitem></menuchoice>">
<!ENTITY five-or-more "<menuchoice><guimenuitem>Applications</guimenuitem><guimenuitem>Games</guimenuitem><guimenuitem>Five or More</guimenuitem></menuchoice>">
<!ENTITY font "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Font</guimenuitem></menuchoice>">
<!ENTITY f-spot "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Graphics</guimenuitem><guimenuitem>F-Spot Photo Manager</guimenuitem></menuchoice>">
<!ENTITY frozen-bubble "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Games</guisubmenu><guisubmenu>Frozen Bubble</guisubmenu></menuchoice> to play <application>Frozen Bubble</application>">
<!ENTITY gambas "<menuchoice><guimenuitem>Applications</guimenuitem><guimenuitem>Programming</guimenuitem><guimenuitem>Gambas</guimenuitem></menuchoice>">
<!ENTITY games "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Games</guimenuitem></menuchoice>">
<!ENTITY gdesklets "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Accessories</guisubmenu><guimenuitem>gDesklets</guimenuitem></menuchoice>">
<!ENTITY gftp "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>gFTP</guimenuitem></menuchoice>">
<!ENTITY gimp "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Graphics</guimenuitem><guimenuitem>GIMP Image Editor</guimenuitem></menuchoice>">
<!ENTITY gnome-app-install "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Add/Remove...</guimenuitem></menuchoice>">
<!ENTITY gnome-config-editor "<screen><command>gconf-editor</command></screen>">
<!ENTITY gnome-sound-recorder "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem><guimenuitem>Sound Recorder</guimenuitem></menuchoice>">
<!ENTITY gparted "<menuchoice><guimenu>System</guimenu><guisubmenu>Administration </guisubmenu><guimenuitem>Gnome Partition Editor</guimenuitem></menuchoice>">
<!ENTITY graphics "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Graphics</guimenuitem></menuchoice>">
<!ENTITY gthumb "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Graphics</guimenuitem><guimenuitem>gThumb Image Viewer</guimenuitem></menuchoice>">
<!ENTITY gtkpod "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Sound &amp; Video</guisubmenu><guimenuitem>gtkpod</guimenuitem></menuchoice>">
<!ENTITY gnucash "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Office</guimenuitem><guimenuitem>GnuCash Finance Management</guimenuitem></menuchoice>">
<!ENTITY gxine "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem><guimenuitem>gxine</guimenuitem></menuchoice>">
<!ENTITY home-folder "<menuchoice><guimenu>Places</guimenu><guimenuitem>Home Folder</guimenuitem></menuchoice>">
<!ENTITY homebank "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Office</guimenuitem><guimenuitem>HomeBank</guimenuitem></menuchoice>">
<!ENTITY hubackup "<menuchoice><guimenu>System</guimenu><guisubmenu>Administration</guisubmenu><guimenuitem>Home User Backup</guimenuitem></menuchoice>">
<!ENTITY hurestore "<menuchoice><guimenu>System</guimenu><guisubmenu>Administration</guisubmenu><guimenuitem>Home User Restore</guimenuitem></menuchoice>">
<!ENTITY inkscape "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Graphics</guimenuitem><guimenuitem>Inkscape SVG Vector Illustrator</guimenuitem></menuchoice>">
<!ENTITY internet "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem></menuchoice>">
<!ENTITY kdevelop "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Programming</guisubmenu><guimenuitem>KDevelop</guimenuitem></menuchoice>">
<!ENTITY keyboard "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Keyboard</guimenuitem></menuchoice>">
<!ENTITY keyboard-shortcuts "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Keyboard Shortcuts</guimenuitem></menuchoice>">
<!ENTITY language-support "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Language Support</guimenuitem></menuchoice>">
<!ENTITY liferea "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Liferea Feed Reader</guimenuitem></menuchoice>">
<!ENTITY limewire "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>LimeWire</guimenuitem></menuchoice>">
<!ENTITY lockscreen "<menuchoice><guimenu>System</guimenu><guimenuitem>Lock Screen</guimenuitem></menuchoice>">
<!ENTITY login-screen-setup "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Login Window</guimenuitem></menuchoice>">
<!ENTITY mahjongg "<menuchoice><guimenuitem>Applications</guimenuitem><guimenuitem>Games</guimenuitem><guimenuitem>Mahjongg</guimenuitem></menuchoice>">
<!ENTITY menu-editor "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Accessories</guisubmenu><guimenuitem>Applications Menu Editor</guimenuitem></menuchoice>">
<!ENTITY menus-and-toolbars "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Menus &amp; Toolbars</guimenuitem></menuchoice>">
<!ENTITY monodevelop "<menuchoice><guimenuitem>Applications</guimenuitem><guimenuitem>Programming</guimenuitem><guimenuitem>MonoDevelop</guimenuitem></menuchoice>">
<!ENTITY monodoc "<menuchoice><guimenuitem>Applications</guimenuitem><guimenuitem>Programming</guimenuitem><guimenuitem>MonoDoc</guimenuitem></menuchoice>">
<!ENTITY mouse "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Mouse</guimenuitem></menuchoice>">
<!ENTITY mtink "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Accessories</guimenuitem><guimenuitem>mtink</guimenuitem></menuchoice>">
<!ENTITY music "<menuchoice><guimenu>Places</guimenu><guimenuitem>Music</guimenuitem></menuchoice>">
<!ENTITY multimedia-systems-selector "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Multimedia Systems Selector</guimenuitem></menuchoice>">
<!ENTITY ndisgtk "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Windows Wireless Drivers</guimenuitem></menuchoice>">
<!ENTITY network-proxy "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Network Proxy</guimenuitem></menuchoice>">
<!ENTITY network-tools "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Network Tools</guimenuitem></menuchoice>">
<!ENTITY networking "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Network</guimenuitem></menuchoice>">
<!ENTITY network-servers "<menuchoice><guimenu>Places</guimenu><guimenuitem>Network</guimenuitem></menuchoice>">
<!ENTITY neverball "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Games</guisubmenu><guisubmenu>Neverball</guisubmenu></menuchoice>">
<!ENTITY neverputt "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Games</guisubmenu><guisubmenu>Neverputt</guisubmenu></menuchoice>">
<!ENTITY nexuiz "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Games</guisubmenu><guisubmenu>Nexuiz</guisubmenu></menuchoice>">
<!ENTITY open-office "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Office</guimenuitem></menuchoice>">
<!ENTITY openoffice-base "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Office</guimenuitem><guimenuitem>OpenOffice.org Database</guimenuitem></menuchoice>">
<!ENTITY openoffice-draw "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Graphics</guimenuitem><guimenuitem>OpenOffice.org Draw</guimenuitem></menuchoice>">
<!ENTITY openoffice-presentation "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Office</guimenuitem><guimenuitem>OpenOffice.org Presentation</guimenuitem></menuchoice>">
<!ENTITY openoffice-spreadsheet "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Office</guimenuitem><guimenuitem>OpenOffice.org Spreadsheet</guimenuitem></menuchoice>">
<!ENTITY openoffice-writer "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Office</guimenuitem><guimenuitem>OpenOffice.org Word Processor</guimenuitem></menuchoice>">
<!ENTITY palmos-devices "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>PalmOS Devices</guimenuitem></menuchoice>">
<!ENTITY pan "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Pan Newsreader</guimenuitem></menuchoice>">
<!ENTITY photoprint "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Graphics</guimenuitem><guimenuitem>PhotoPrint</guimenuitem></menuchoice>">
<!ENTITY pidgin "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Pidgin Internet Messenger</guimenuitem></menuchoice>">
<!ENTITY power-management "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Power Management</guimenuitem></menuchoice>">
<!ENTITY ppracer "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Games</guisubmenu><guisubmenu>Planet Penguin Racer</guisubmenu></menuchoice>">
<!ENTITY preferences "<menuchoice><guimenu>System</guimenu><guisubmenu>Preferences</guisubmenu></menuchoice>">
<!ENTITY preferred-applications "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Preferred Applications</guimenuitem></menuchoice>">
<!ENTITY print "<menuchoice><guimenu>File</guimenu><guimenuitem>Print</guimenuitem></menuchoice>">
<!ENTITY printing "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Printing</guimenuitem></menuchoice>">
<!ENTITY qtparted "<menuchoice><guimenu>Applications</guimenu><guimenuitem>System Tools</guimenuitem><guimenuitem>QTParted</guimenuitem></menuchoice>">
<!ENTITY remote-desktop "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Remote Desktop</guimenuitem></menuchoice>">
<!ENTITY removable-drives-and-media "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Removable Drives and Media</guimenuitem></menuchoice>">
<!ENTITY realplayer "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem><guimenuitem>RealPlayer 11</guimenuitem></menuchoice>">
<!ENTITY restricted-manager "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Hardware Drivers</guimenuitem></menuchoice>">
<!ENTITY rhythmbox "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem><guimenuitem>Rhythmbox Music Player</guimenuitem></menuchoice>">
<!ENTITY route-planner "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>aMule</guimenuitem></menuchoice>">
<!ENTITY scorched3d "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Games</guisubmenu><guimenuitem>Scorched 3D</guimenuitem></menuchoice>">
<!ENTITY screen-resolution "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Screen Resolution</guimenuitem></menuchoice>">
<!ENTITY screensaver "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Screensaver</guimenuitem></menuchoice>">
<!ENTITY scribus "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Office</guimenuitem><guimenuitem>Scribus</guimenuitem></menuchoice>">
<!ENTITY serpentine "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem><guimenuitem>Serpentine Audio CD Creator</guimenuitem></menuchoice>">
<!ENTITY services "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Services</guimenuitem></menuchoice>">
<!ENTITY sessions "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Sessions</guimenuitem></menuchoice>">
<!ENTITY shared-folders "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Shared Folders</guimenuitem></menuchoice>">
<!ENTITY skype "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Skype</guimenuitem></menuchoice>">
<!ENTITY software-properties "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Software Sources</guimenuitem></menuchoice>">
<!ENTITY software-sources "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Software Sources</guimenuitem></menuchoice>">
<!ENTITY sound "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Sound</guimenuitem></menuchoice>">
<!ENTITY soundandvideo "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem></menuchoice>">
<!ENTITY soundjuicer "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem><guimenuitem>Audio CD Extractor</guimenuitem></menuchoice>">
<!ENTITY supertux "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Games</guisubmenu><guisubmenu>SuperTux</guisubmenu></menuchoice>">
<!ENTITY shutdown "<menuchoice><guimenu>System</guimenu><guimenuitem>Shut Down...</guimenuitem></menuchoice>">
<!ENTITY synaptic "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Synaptic Package Manager</guimenuitem></menuchoice>">
<!ENTITY system-monitor "<menuchoice><guimenu>System</guimenu><guisubmenu>Administration</guisubmenu><guimenuitem>System Monitor</guimenuitem></menuchoice>">
<!ENTITY systemtools "<menuchoice><guimenu>Applications</guimenu><guimenuitem>System Tools</guimenuitem></menuchoice>">
<!ENTITY terminal "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Accessories</guimenuitem><guimenuitem>Terminal</guimenuitem></menuchoice>">
<!ENTITY text-editor "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Accessories</guimenuitem><guimenuitem>Text Editor</guimenuitem></menuchoice>">
<!ENTITY theme "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Theme</guimenuitem></menuchoice>">
<!ENTITY thunderbird "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Mozilla Thunderbird Mail/News</guimenuitem></menuchoice>">
<!ENTITY time-date "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Time and Date</guimenuitem></menuchoice>">
<!ENTITY totem "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem><guimenuitem>Movie Player</guimenuitem></menuchoice>">
<!ENTITY touchpad "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Touchpad</guimenuitem></menuchoice>">
<!ENTITY tremulous "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Games</guisubmenu><guisubmenu>Tremulous</guisubmenu></menuchoice>">
<!ENTITY ubuntu-update-manager "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Ubuntu Update Manager</guimenuitem></menuchoice>">
<!ENTITY update-manager "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Update Manager</guimenuitem></menuchoice>">
<!ENTITY users "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Users and Groups</guimenuitem></menuchoice>">
<!ENTITY users-groups "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Users and Groups</guimenuitem></menuchoice>">
<!ENTITY windows "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Windows</guimenuitem></menuchoice>">
<!ENTITY wireshark "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Wireshark</guimenuitem></menuchoice>">
<!ENTITY xchat-gnome "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Xchat-GNOME IRC Chat</guimenuitem></menuchoice>">
<!ENTITY xine "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem><guimenuitem>xine</guimenuitem></menuchoice>">
<!ENTITY xmms "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem><guimenuitem>XMMS</guimenuitem></menuchoice>">
<!ENTITY xsane "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Graphics</guimenuitem><guimenuitem>XSane Image Scanner</guimenuitem></menuchoice>">
<!ENTITY % xinclude SYSTEM "../../libs/xinclude.mod">
<!ELEMENT xi:include (xi:fallback)?>
<!ATTLIST xi:include xmlns:xi CDATA #FIXED "http://www.w3.org/2001/XInclude">
<!ATTLIST xi:include href CDATA #REQUIRED>
<!ATTLIST xi:include parse (xml | text) "xml">
<!ATTLIST xi:include xpointer CDATA #IMPLIED>
<!ATTLIST xi:include encoding CDATA #IMPLIED>
<!ATTLIST xi:include accept CDATA #IMPLIED>
<!ATTLIST xi:include accept-charset CDATA #IMPLIED>
<!ATTLIST xi:include accept-language CDATA #IMPLIED>
<!ELEMENT xi:fallback ANY>
<!ATTLIST xi:fallback xmlns:xi CDATA #FIXED "http://www.w3.org/2001/XInclude">
<!ENTITY % local.preface.class "| xi:include">
<!ENTITY % local.part.class "| xi:include">
<!ENTITY % local.chapter.class "| xi:include">
<!ENTITY % local.divcomponent.mix "| xi:include">
<!ENTITY % local.para.char.mix "| xi:include">
<!ENTITY % local.info.class "| xi:include">
<!ENTITY % local.common.attrib "xmlns:xi            CDATA       #FIXED       'http://www.w3.org/2001/XInclude'">
<!ENTITY language "&EnglishAmerican;">
]>
<chapter id="network-authentication" status="review">
	<title>Authentification réseau</title>

         <para>Cette partie présente plusieurs protocoles d'authentification réseau.</para>
	<sect1 id="openldap-server" status="review">
		<title>Serveur OpenLDAP</title>
         <para>LDAP signifie Lightweight Directory Access Protocol, c'est une version simplifiée du protocole X.500. La configuration de l'annuaire dans cette section sera utilisée pour l'authentification. Néanmoins, un annuaire LDAP peut-être utilisé de différentes façons : authentification, annuaire partagé (pour les clients de messagerie), carnet d'adresses, etc.</para>

         <para>Pour décrire rapidement LDAP, toutes les informations sont stockées dans une structure arborescente. Avec <application>OpenLDAP</application> vous avez la liberté de déterminer vous-même l'arborescence de l'annuaire (Directory Information Tree ou DIT). Nous allons démarrer avec une arborescence basique contenant deux nœuds sous la racine :</para>

	 <itemizedlist>
           <listitem>
               <para>Le nœud « Personnes » dans lequel seront enregistrés vos utilisateurs</para>
           </listitem>
           <listitem>
               <para>Le nœud « Groupes » dans lequel seront enregistrés vos groupes.</para>
           </listitem>
         </itemizedlist>

	 <para>Avant de commencer, vous devez déterminer quelle sera la racine de votre annuaire LDAP. Par défaut, votre arbre sera déterminé par votre nom de domaine pleinement qualifié (FQDN). Si votre domaine est exemple.com (qu'on utilisera dans cette exemple), votre nœud racine sera dc=example,dc=com.</para>

	<sect2 id="openldap-server-installation" status="review">
		<title>Installation</title>

   	<para>Tout d'abord, installez le démon <application>slapd</application> du serveur <application>OpenLDAP</application> et <application>ldap-utils</application>, un paquet contenant les outils de gestion de LDAP :</para>
<screen>
<command>sudo apt-get install slapd ldap-utils</command>
</screen>
	
	<para>Le processus d'installation vous demandera deux fois le mot de passe administrateur de l'annuaire LDAP.</para>

	<para>Par défaut le suffixe d'annuaire correspondra au nom de domaine du serveur. Par exemple, si le FQDN est ldap.example.com, le suffixe par défaut sera <emphasis>dc=example,dc=com</emphasis>. Si vous préférez un suffixe différent, l'annuaire peut être paramétré à nouveau en utilisant <application>dpkg-reconfigure</application>. Saisissez dans un terminal :</para>

<screen>
<command>sudo dpkg-reconfigure slapd</command>
</screen>

	<para>Une interface de dialogue à base de menus, vous permettra ensuite de paramétrer diverses options <application>slapd</application>.</para>
	
	</sect2>
        <sect2 id="openldap-configuration" status="review">
          <title>Configuration</title>

          <para><application>OpenLDAP</application> utilise une base de données contenant l'arborescence de l'annuaire (Directory Information Tree - DIT) <emphasis>cn=config</emphasis>. Le DIT <emphasis>cn=config</emphasis> est utilisé pour paramétrer le démon <application>slapd</application>, permettant ainsi la modification des schémas, index, ACL etc., sans pour autant arrêter le service.</para>

          <para>L'arborescence <emphasis>cn=config</emphasis> peut être manipulée avec les utilitaires du paquet <application>ldap-utils</application>. Par exemple :</para>

          <itemizedlist>
            <listitem>

              <para>Utilisez <application>ldapsearch</application> pour afficher l'arborescence, en saisissant le mot de passe administrateur défini lors de l'installation ou la re-configuration :</para>

<screen>
<command>ldapsearch -xLLL -b cn=config -D cn=admin,cn=config -W olcDatabase={1}hdb</command>
</screen>

<screen>
<computeroutput>Enter LDAP Password: 
dn: olcDatabase={1}hdb,cn=config
objectClass: olcDatabaseConfig
objectClass: olcHdbConfig
olcDatabase: {1}hdb
olcDbDirectory: /var/lib/ldap
olcSuffix: dc=example,dc=com
olcAccess: {0}to attrs=userPassword,shadowLastChange by dn="cn=admin,dc=exampl
 e,dc=com" write by anonymous auth by self write by * none
olcAccess: {1}to dn.base="" by * read
olcAccess: {2}to * by dn="cn=admin,dc=example,dc=com" write by * read
olcLastMod: TRUE
olcDbCheckpoint: 512 30
olcDbConfig: {0}set_cachesize 0 2097152 0
olcDbConfig: {1}set_lk_max_objects 1500
olcDbConfig: {2}set_lk_max_locks 1500
olcDbConfig: {3}set_lk_max_lockers 1500
olcDbIndex: objectClass eq
</computeroutput>
</screen>

              <para>La sortie de la commande ci-dessus est la configuration actuelle de la base de données <emphasis>hdb</emphasis>. Dans le cas présent, les options contiennent le suffixe <emphasis>dc=example,dc=com</emphasis>.</para>

            </listitem>
            <listitem>

              <para>Affinez la recherche en fournissant un <emphasis role="italic">filtre</emphasis>, dans le cas présent, n'afficher que les attributs indexés :</para>

<screen>
<command>ldapsearch -xLLL -b cn=config -D cn=admin,cn=config -W olcDatabase={1}hdb olcDbIndex</command>
</screen>

<screen>
<computeroutput>Enter LDAP Password: 
dn: olcDatabase={1}hdb,cn=config
olcDbIndex: objectClass eq
</computeroutput>
</screen>

            </listitem>
            <listitem>

              <para>À titre d'exemple de modification de l'arborescence <emphasis>cn=config</emphasis>, ajoutez un attribut à la liste d'index en utilisant <application>ldapmodify</application>  :</para>

<screen>
<command>ldapmodify -x -D cn=admin,cn=config -W</command>
</screen>

<screen>
<computeroutput>Enter LDAP Password:<userinput>
dn: olcDatabase={1}hdb,cn=config
add: olcDbIndex
olcDbIndex: entryUUID eq</userinput>

modifying entry "olcDatabase={1}hdb,cn=config"
</computeroutput>
</screen>

              <para>Appuyez sur <emphasis>Ctrl+D</emphasis> une fois les modifications effectuées pour quitter l'utilitaire.</para>

            </listitem>
            <listitem>

              <para><application>ldapmodify</application> peut aussi utiliser un fichier pour faire des modifications. Copiez et collez ce qui suit dans un fichier nommé <filename>uid_index.ldif</filename> :</para>

<programlisting>
dn: olcDatabase={1}hdb,cn=config
add: olcDbIndex
olcDbIndex: uid eq,pres,sub
</programlisting>

              <para>Lancez ensuite <application>ldapmodify</application> :</para> 

<screen>
<command>ldapmodify -x -D cn=admin,cn=config -W -f uid_index.ldif</command>
</screen>

<screen>
<computeroutput>Enter LDAP Password: 
modifying entry "olcDatabase={1}hdb,cn=config"
</computeroutput>
</screen>

              <para>L'injection par fichier est très utile pour des changements importants (en quantité).</para>

            </listitem>
            <listitem>

              <para>Ajouter des <emphasis>schémas</emphasis> supplémentaires à <application>slapd</application> nécessite la conversion du schéma au format LDIF. Heureusement le programme <application>slapd</application> peut être utilisé pour automatiser la transformation. L'exemple suivant ajoutera le schéma <emphasis>misc.schema</emphasis> :</para>

              <procedure>
                <step>
                  <para>Créez d'abord un fichier de conversion <filename>schema_convert.conf</filename> contenant les lignes :</para>

<programlisting>
include /etc/ldap/schema/core.schema
include /etc/ldap/schema/collective.schema
include /etc/ldap/schema/corba.schema
include /etc/ldap/schema/cosine.schema
include /etc/ldap/schema/duaconf.schema
include /etc/ldap/schema/dyngroup.schema
include /etc/ldap/schema/inetorgperson.schema
include /etc/ldap/schema/java.schema
include /etc/ldap/schema/misc.schema
include /etc/ldap/schema/nis.schema
include /etc/ldap/schema/openldap.schema
include /etc/ldap/schema/ppolicy.schema
</programlisting>

                </step>
                <step>

                  <para>Ensuite, créez un dossier temporaire pour conserver le résultat :</para> 

<screen>
<command>mkdir /tmp/ldif_output</command>
</screen>

                </step>
                <step>

                  <para>Convertissez maintenant les fichiers « schema » au format LDIF en utilisant <application>slaptest</application> :</para>

<screen>
<command>slaptest -f schema_convert.conf -F /tmp/ldif_output</command>
</screen>

                  <para>Adaptez le nom du fichier de configuration et les noms des dossiers temporaires si les vôtres sont différents. Il peut également être intéressant de conserver le dossier <filename>ldif_output</filename> quelque part, au cas où vous voudriez ajouter d'autres schémas par la suite.</para>

                </step>
                <step>

                  <para>Modifiez le fichier <filename>/tmp/ldif_output/cn=config/cn=schema/cn={8}misc.ldif</filename>, en changeant les attributs suivants :</para> 

<programlisting>
dn: cn=misc,cn=schema,cn=config
...
cn: misc
</programlisting>

                  <para>Et supprimez les lignes suivantes situées en fin de fichier :</para> 

<programlisting>
structuralObjectClass: olcSchemaConfig
entryUUID: 10dae0ea-0760-102d-80d3-f9366b7f7757
creatorsName: cn=config
createTimestamp: 20080826021140Z
entryCSN: 20080826021140.791425Z#000000#000#000000
modifiersName: cn=config
modifyTimestamp: 20080826021140Z
</programlisting>

                  <note>
                    <para>Les valeurs des attributs peuvent varier, assurez-vous simplement qu'ils soient supprimés.</para>
                  </note>

                </step>
                <step>

                  <para>Finalement, ajoutez le nouveau schéma au dossier en utilisant <application>ldapadd</application> :</para>

<screen>
<command>ldapadd -x -D cn=admin,cn=config -W -f /tmp/ldif_output/cn\=config/cn\=schema/cn\=\{8\}misc.ldif</command>
</screen>

                </step>
              </procedure>

              <para>Il doit maintenant y avoir une entrée <emphasis>dn: cn={4}misc,cn=schema,cn=config</emphasis> dans l'arborescence de cn=config.</para> 

            </listitem>
          </itemizedlist>

        </sect2>
	<sect2 id="openldap-server-populate" status="review">
		<title>Peuplement de LDAP</title>

	<para>L'annuaire a été créé au cours de l'installation et de la reconfiguration et il faut maintenant le compléter d'entrées « classiques » compatibles avec des applications de carnet d'adresse et de compte Unix Posix. Les comptes Posix permettent l'authentification de nombreuses applications telles que les navigateurs web, les clients de messageries (Mail Transfert Agent :MTA), etc.</para>
	
	<note>
	  <para>Chaque application externe devant utiliser l'authentification LDAP devra être spécifiquement configurée. Consultez la documentation de chacune de ces applications pour plus de renseignements.</para>
	</note>

	<para>Les annuaires LDAP peuvent être peuplés par des fichiers LDIF (LDAP Directory Interchange Format). Copiez l'exemple de fichier LDIF suivant, en le nommant<filename>example.com.ldif</filename>, quelque part sur votre système :</para>

<programlisting>
dn: ou=people,dc=example,dc=com
objectClass: organizationalUnit
ou: people

dn: ou=groups,dc=example,dc=com
objectClass: organizationalUnit
ou: groups

dn: uid=john,ou=people,dc=example,dc=com
objectClass: inetOrgPerson
objectClass: posixAccount
objectClass: shadowAccount
uid: john
sn: Doe
givenName: John
cn: John Doe
displayName: John Doe
uidNumber: 1000
gidNumber: 10000
userPassword: password
gecos: John Doe
loginShell: /bin/bash
homeDirectory: /home/john
shadowExpire: -1
shadowFlag: 0
shadowWarning: 7
shadowMin: 8
shadowMax: 999999
shadowLastChange: 10877
mail: john.doe@example.com
postalCode: 31000
l: Toulouse
o: Example
mobile: +33 (0)6 xx xx xx xx
homePhone: +33 (0)5 xx xx xx xx
title: System Administrator
postalAddress: 
initials: JD

dn: cn=example,ou=groups,dc=example,dc=com
objectClass: posixGroup
cn: example
gidNumber: 10000
</programlisting>

	<para>Dans cet exemple, la structure de l'annuaire, un utilisateur et un groupe ont été configurés. Dans d'autres exemples, vous risquez de voir <emphasis>objectClass: top</emphasis> ajouté dans chaque entrée, mais ceci est le comportement par défaut, vous n'avez donc pas à l'ajouter explicitement.</para>

	<para>Pour ajouter des entrées à l'annuaire LDAP, utilisez <application>ldapadd</application> :</para>


<screen>
<command>ldapadd -x -D cn=admin,dc=example,dc=com -W -f example.com.ldif</command>
</screen>

	<para>Nous pouvons vérifier que le contenu a bien été ajouté grâce aux outils fournis dans le paquet <application>ldap-utils</application>. Pour effectuer une recherche dans l'annuaire LDAP :</para>

<screen>
<command>ldapsearch -xLLL -b "dc=example,dc=com" uid=john sn givenName cn</command>
<computeroutput>
dn: uid=john,ou=people,dc=example,dc=com
cn: John Doe
sn: Doe
givenName: John
</computeroutput>
</screen>

	<para>Voici une brève explication :</para>

	<itemizedlist>
	    <listitem>
                <para><emphasis>-x :</emphasis> n'utilisera pas la méthode d'authentification SASL, qui est celle par défaut.</para>
            </listitem>
            <listitem>
                <para><emphasis>-LLL :</emphasis> désactive l'affichage du schéma d'information LDIF.</para>
            </listitem>
        </itemizedlist>
	
	</sect2>

	<sect2 id="openldap-server-replication" status="review">
		<title>Réplication LDAP</title>

	<para>LDAP peut souvent devenir un service crucial sur le réseau. Plusieurs systèmes en deviennent dépendants pour l'authentification, l'autorisation, la configuration, etc. Il est donc judicieux de mettre en place un service redondant grâce à la réplication.</para>
	
	<para>La réplication est réalisée à l'aide du moteur <emphasis>Syncrepl</emphasis>. Syncrepl permet à l'annuaire d'être synchronisé selon deux méthodes : soit <emphasis>centralisée</emphasis> (méthode « push ») soit  <emphasis>distribuée</emphasis> (méthode « pull »). Dans une configuration centralisée, un serveur <quote>primaire</quote> répercute l'actualisation de l'annuaire vers des serveurs <quote>secondaires</quote>, alors que dans une configuration distribuée, les serveurs de réplication se synchronisent entre eux à intervalle régulier.</para>

	<para>L'exemple suivant est une configuration <emphasis>multi-maître</emphasis>. Dans cette configuration, chaque serveur OpenLDAP est configuré à la fois pour la réplication <emphasis>centralisée</emphasis> et <emphasis>distribuée</emphasis>.</para>

        <procedure>
          <step>
  
            <para>Tout d'abord, configurez le serveur pour qu'il se synchronise avec la base de données <emphasis>cn=config</emphasis>. Copiez le code suivant dans un fichier nommé <filename>syncrepl_cn-config.ldif</filename> :</para>

<programlisting>
dn: cn=module{0},cn=config
changetype: modify
add: olcModuleLoad
olcModuleLoad: syncprov

dn: cn=config
changetype: modify
replace: olcServerID
olcServerID: 1 ldap://ldap01.example.com
olcServerID: 2 ldap://ldap02.example.com

dn: olcOverlay=syncprov,olcDatabase={0}config,cn=config
changetype: add
objectClass: olcOverlayConfig
objectClass: olcSyncProvConfig
olcOverlay: syncprov

dn: olcDatabase={0}config,cn=config
changetype: modify
add: olcSyncRepl
olcSyncRepl: rid=001 provider=ldap://ldap01.example.com binddn="cn=admin,cn=config" bindmethod=simple
  credentials=secret searchbase="cn=config" type=refreshAndPersist
  retry="5 5 300 5" timeout=1
olcSyncRepl: rid=002 provider=ldap://ldap02.example.com binddn="cn=admin,cn=config" bindmethod=simple
  credentials=secret searchbase="cn=config" type=refreshAndPersist
  retry="5 5 300 5" timeout=1
-
add: olcMirrorMode
olcMirrorMode: TRUE
</programlisting>

          </step>
          <step>

            <para>Remplacez dans le fichier :</para>

            <itemizedlist>
              <listitem>
                <para><emphasis>ldap://ldap01.example.com</emphasis> et <emphasis>ldap://ldap02.example.com</emphasis> par les noms d'hôtes de vos serveurs LDAP.</para>
                <note>
                  <para>Vous pouvez avoir plus de deux serveurs LDAP. Une synchronisation se chargera de mettre à jour les autres serveurs. Assurez-vous d'incrémenter le paramètre <emphasis>olcServerID</emphasis> de chaque serveur et le <emphasis>rid</emphasis> de chaque entrée <emphasis>olcSyncRepl</emphasis>.</para>
                </note>
              </listitem>
              <listitem>
                <para>Puis remplacez « secret » par votre mot de passe administrateur dans <emphasis>credentials=secret</emphasis>.</para>
              </listitem>
            </itemizedlist>

          </step>
          <step>


            <para>Injectez ensuite le fichier LDIF grâce à l'utilitaire  <application>ldapmodify</application> :</para>

<screen>
<command>ldapmodify -x -D cn=admin,cn=config -W -f syncrepl_cn-config.ldif</command>
</screen>

          </step>
          <step>

            <para>Copiez le fichier <filename>syncrepl_cn-config.ldif</filename> sur l'autre serveur et répétez la commande <application>ldapmodify</application> ci-dessus.</para>

          </step>
          <step>

            <para>Comme un nouveau module a été ajouté, il est nécessaire de redémarrer le démon <application>slapd</application> pour tous les serveurs :</para>

<screen>
<command>sudo /etc/init.d/slapd restart</command>
</screen>

          </step>
          <step>

            <para>Maintenant que la base de données de configuration est synchronisée entre tous les serveurs, la base de données <emphasis>principale</emphasis> (backend) doit être aussi synchronisée. Copiez et collez ce qui suit dans un autre fichier LDIF nommé <filename>syncrepl_backend.ldif</filename> :</para>

<programlisting>
dn: olcDatabase={1}hdb,cn=config
changetype: modify
add: olcRootDN
olcRootDN: cn=admin,dc=example,dc=com
-
add: olcSyncRepl
olcSyncRepl: rid=003 provider=ldap://ldap01.example.com binddn="cn=admin,dc=example,dc=com" 
 bindmethod=simple credentials=secret searchbase="dc=example,dc=com" type=refreshOnly 
 interval=00:00:00:10 retry="5 5 300 5" timeout=1
olcSyncRepl: rid=004 provider=ldap://ldap02.example.com binddn="cn=admin,dc=example,dc=com" 
 bindmethod=simple credentials=secret searchbase="dc=example,dc=com" type=refreshOnly 
 interval=00:00:00:10 retry="5 5 300 5" timeout=1
-
add: olcMirrorMode
olcMirrorMode: TRUE

dn: olcOverlay=syncprov,olcDatabase={1}hdb,cn=config
changetype: add
objectClass: olcOverlayConfig
objectClass: olcSyncProvConfig
olcOverlay: syncprov
</programlisting>

          </step>
          <step>

            <para>Comme pour le fichier LDIF précédent, il est nécessaire de modifier celui-ci en remplaçant :</para>

            <itemizedlist>
              <listitem>
                <para><emphasis>searchbase="dc=example,dc=com"</emphasis> par la base de recherche de votre annuaire.</para>
              </listitem>              
              <listitem>
                <para>Si votre administrateur n'est pas « admin » faites le changement adéquat dans <emphasis>binddn="cn=admin,dc=example,dc=com"</emphasis>.</para>
              </listitem>
              <listitem>
                <para>Pensez également à mettre à jour le mot de passe administrateur dans <emphasis>credentials=secret</emphasis>.</para>
              </listitem>
            </itemizedlist>

          </step>
          <step>

            <para>Injectez le fichier LDIF :</para>

<screen>
<command>ldapmodify -x -D cn=admin,cn=config -W -f syncrepl_backend.ldif</command>
</screen>

            <para>Comme la configuration des serveurs est déjà synchronisée, il n'est pas nécessaire de copier ce fichier LDIF sur les autres serveurs.</para>

          </step>
        </procedure>

        <para>Les bases de données de configuration et principale (backend) devraient maintenant se synchroniser entre tous les serveurs. Vous pouvez ajouter des serveurs supplémentaires grâce à <application>ldapmodify</application> si nécessaire. Consultez <xref linkend="openldap-configuration"/> pour de plus amples informations.</para>

        <note>
  	  <para>Par défaut, le démon <application>slapd</application> journalisera les informations dans <filename>/var/log/syslog</filename>. Donc, si tout ne fonctionne <emphasis>pas</emphasis> correctement, vérifiez les erreurs et autres informations de dépannage à cet endroit. Assurez-vous que chaque serveur à un FQDN correct dans <filename>/etc/hosts</filename>. Ce FQDN est du type : <programlisting>127.0.0.1	ldap01.example.com ldap01</programlisting>.</para>
        </note>
		
	</sect2>

	<sect2 id="openldap-server-acl" status="review">
              <title>Paramétrage des ACL</title>

	<para>L'authentification nécessite la lecture du champ « mot de passe » qui n'est pas accessible par défaut. Ainsi, pour que les utilisateurs puissent changer leur propre mot de passe à l'aide de <command>passwd</command> ou de tout autre utilitaire, <emphasis>shadowLastChange</emphasis> doit être accessible dès que l'utilisateur est authentifié.</para>

        <para>Pour afficher la liste de contrôle d'accès (ACL), utilisez l'application <application>ldapsearch</application> :</para>

<screen>
<command>ldapsearch -xLLL -b cn=config -D cn=admin,cn=config -W olcDatabase=hdb olcAccess</command>
</screen>

<screen>
<computeroutput>Enter LDAP Password: 
dn: olcDatabase={1}hdb,cn=config
olcAccess: {0}to attrs=userPassword,shadowLastChange by dn="cn=admin,dc=exampl
 e,dc=com" write by anonymous auth by self write by * none
olcAccess: {1}to dn.base="" by * read
olcAccess: {2}to * by dn="cn=admin,dc=example,dc=com" write by * read
</computeroutput>
</screen>

	</sect2>

        <sect2 id="openldap-tls" status="review">
          <title>TLS et SSL</title>

          <para>Il est préférable de s'identifier sur un serveur LDAP en utilisant une session chiffrée. Pour ce faire servez-vous de TLS (Transport Layer Security) et/ou de SSL (Secure Sockets Layer).</para>

          <para>La première étape est d'obtenir ou de créer un <emphasis>certificat</emphasis>. Consultez <xref linkend="certificates-and-security"/> et <xref linkend="certificate-authority"/> pour de plus amples informations.</para>

          <para>Une fois que le certificat, la clé et le certificat de l'AC sont installés, ajoutez les nouvelles options de configuration à l'aide de <application>ldapmodify</application> :</para>

<screen>
<command>ldapmodify -x -D cn=admin,cn=config -W</command>
</screen>

<screen>
<computeroutput>Enter LDAP Password:
<userinput>dn: cn=config
add: olcTLSCACertificateFile
olcTLSCACertificateFile: /etc/ssl/certs/cacert.pem
-
add: olcTLSCertificateFile
olcTLSCertificateFile: /etc/ssl/certs/server.crt
-
add: olcTLSCertificateKeyFile
olcTLSCertificateKeyFile: /etc/ssl/private/server.key</userinput>

modifying entry "cn=config"
</computeroutput>
</screen>

          <note>
            <para>Modifiez si besoin est les noms <filename>server.crt</filename>, <filename>server.key</filename> et <filename>cacert.pem</filename></para>
          </note>

          <para>Puis ouvrez <filename>/etc/default/slapd</filename> et dé-commentez l'option <emphasis>SLAPD_SERVICES</emphasis> :</para>

<programlisting>
SLAPD_SERVICES="ldap:/// ldapi:/// ldaps:///"
</programlisting>

          <para>L'utilisateur <emphasis>openldap</emphasis> a maintenant besoin d'accéder au certificat :</para>

<screen>
<command>sudo adduser openldap ssl-cert</command>
<command>sudo chgrp ssl-cert /etc/ssl/private/server.key</command>
</screen>

          <note>
            <para>Si <filename role="directory">/etc/ssl/private</filename> et <filename>/etc/ssl/private/server.key</filename> ont des droits d'accès différents, modifiez les commandes en conséquence.</para>
          </note>

          <para>Pour finir, redémarrez <application>slapd</application> :</para>

<screen>
<command>sudo /etc/init.d/slapd restart</command>
</screen>

          <para>Le démon <application>slapd</application> doit être à l'écoute des connexions LDAPS et être capable d'utiliser STARTTLS lors de l'authentification.</para>

          <sect3 id="openldap-tls-replication" status="review">
            <title>Réplication TLS</title>

            <para>Si vous avez mis en place <application>Syncrepl</application> sur les serveurs, il est prudent de chiffrer les échanges de données de la réplication au moyen de <emphasis>TLS (Transport Layer Security)</emphasis>. Consultez <xref linkend="openldap-server-replication"/> pour de plus amples informations au sujet de la mise en place de la réplication.</para>

            <para>Après avoir mis en place de la réplication ainsi que les instructions de <xref linkend="openldap-tls"/>, il est important de bien prendre en compte certaines conséquences :</para>

            <itemizedlist>
              <listitem>
                <para>La configuration n'a besoin d'être modifiée que sur <emphasis>un seul</emphasis> serveur.</para>
              </listitem>
              <listitem>
                <para>Les noms d'emplacements pour le <emphasis>certificat</emphasis> et la <emphasis>clé</emphasis> doivent être identiques sur tous les serveurs.</para>
              </listitem>
            </itemizedlist>

            <para>Donc sur chaque serveur répliqué : installez un certificat, modifiez <filename>/etc/default/slapd</filename> et redémarrez <application>slapd</application>.</para>

            <para>Une fois que <emphasis>TLS</emphasis> a été configuré sur chaque serveur, modifiez la réplication de <emphasis>cn=config</emphasis> en saisissant la commande suivante dans un terminal :</para>

<screen>
<command>ldapmodify -x -D cn=admin,cn=config -W</command>
</screen>

<screen>
<computeroutput>Saisissez le mot de passe LDAP : 
<userinput>dn: olcDatabase={0}config,cn=config
replace: olcSyncrepl
olcSyncrepl: {0}rid=001 provider=ldap://ldap01.example.com binddn="cn=admin,cn
 =config" bindmethod=simple credentials=secret searchbase="cn=config" type=refre
 shAndPersist retry="5 5 300 5" timeout=1 starttls=yes
olcSyncrepl: {1}rid=002 provider=ldap://ldap02.example.com binddn="cn=admin,cn
 =config" bindmethod=simple credentials=secret searchbase="cn=config" type=refre
 shAndPersist retry="5 5 300 5" timeout=1 starttls=yes</userinput>

modifying entry "olcDatabase={0}config,cn=config"
</computeroutput>
</screen>

            <para>Adaptez maintenant la réplication de la base de données <emphasis>principale</emphasis> (backend) :</para>

<screen>
<command>ldapmodify -x -D cn=admin,cn=config -W</command>
</screen>

<screen>
<computeroutput>Saisissez le mot de passe LDAP :
<userinput>dn: olcDatabase={1}hdb,cn=config
replace: olcSyncrepl
olcSyncrepl: {0}rid=003 provider=ldap://ldap01.example.com binddn="cn=admin,dc=example,dc=
 com" bindmethod=simple credentials=secret searchbase="dc=example,dc=com" type=r
 efreshOnly interval=00:00:00:10 retry="5 5 300 5" timeout=1 starttls=yes
olcSyncrepl: {1}rid=004 provider=ldap://ldap02.example.com binddn="cn=admin,dc=example,dc=
 com" bindmethod=simple credentials=secret searchbase="dc=example,dc=com" type=r
 efreshOnly interval=00:00:00:10 retry="5 5 300 5" timeout=1 starttls=yes</userinput>

modifying entry "olcDatabase={1}hdb,cn=config"</computeroutput>
</screen>

            <para>Si le nom d'hôte du serveur LDAP ne correspond pas au nom de domaine pleinement qualifié (Fully Qualified Domain Name - FQDN) du certificat, vous devrez probablement modifier <filename>/etc/ldap/ldap.conf</filename> et ajouter les options TLS suivantes :</para>

<programlisting>
TLS_CERT /etc/ssl/certs/server.crt
TLS_KEY /etc/ssl/private/server.key
TLS_CACERT /etc/ssl/certs/cacert.pem
</programlisting>


              <para>Finalement, redémarrez <application>slapd</application> sur chaque serveur :</para>

<screen>
<command>sudo /etc/init.d/slapd restart</command>
</screen>

          </sect3>

        </sect2>

        <sect2 id="openldap-auth-config" status="review">
          <title>Authentification LDAP</title>

          <para>Une fois votre serveur LDAP fonctionnel, les paquets <application>auth-client-config</application> et <application>libnss-ldap</application> vont simplifier le paramétrage d'un client Ubuntu pour son authentification avec LDAP. Pour installer ces paquets saisissez dans un terminal :</para> 

<screen>
<command>sudo apt-get install libnss-ldap</command>
</screen>

         <para>Pendant l'installation, des renseignements à propos de votre connexion au serveur LDAP vous seront demandés.</para>
       
         <para>Si vous avez fait une erreur lors de la saisie des informations, vous pouvez exécuter à nouveau l'assistant en utilisant :</para>

<screen>
<command>sudo dpkg-reconfigure ldap-auth-config</command>
</screen>

         <para>Le résultat de la configuration est visible dans <filename>/etc/ldap.conf</filename>. Si votre serveur requiert des options non couvertes par l'assistant, modifiez ce fichier en conséquence.</para>

         <para>Maintenant que <application>libnss-ldap</application> est configuré, activez le profil LDAP <application>auth-client-config</application> en saisissant :</para>

<screen>
<command>sudo auth-client-config -t nss -p lac_ldap</command>
</screen>
         
          <itemizedlist>
	    <listitem>
              <para><emphasis>-t :</emphasis> modifie seulement <filename>/etc/nsswitch.conf</filename>.</para>
            </listitem>
	    <listitem>
              <para><emphasis>-p :</emphasis> nom du profil à activer, désactiver, etc.</para>
	    </listitem>
	    <listitem>
              <para><emphasis>lac_ldap :</emphasis> le profil <application>auth-client-config</application> qui fait partie du paquet <application>ldap-auth-config</application>.</para>
	    </listitem>
          </itemizedlist>

          <para>À l'aide de <application>pam-auth-update</application>, configurez le système pour utiliser LDAP pour l'authentification :</para>

<screen>
<command>sudo pam-auth-update</command>
</screen>

          <para>Depuis le menu de <application>pam-auth-update</application>, choisissez LDAP et tout autre mécanisme d'authentification nécessaire.</para>

          <para>Vous devez être maintenant capable d'ouvrir une session en utilisant les références utilisateur stockées dans l'annuaire LDAP.</para> 

          <note>
            <para>Si vous comptez utiliser LDAP pour stocker des utilisateurs Samba, vous aurez besoin de configurer le serveur pour l'identification LDAP. Consultez <xref linkend="samba-ldap"/> pour de plus amples informations.</para>
          </note>

        </sect2>
        <sect2 id="ldap-usergroup-management" status="review">
          <title>Gestion des groupes et utilisateurs</title>

          <para>Le paquet <application>ldap-utils</application> fournit plusieurs utilitaires pour gérer l'annuaire, mais la longue liste d'options nécessaires peut rendre leur emploi un peu fastidieux. Le paquet <application>ldapscripts</application> contient des scripts configurables pour gérer aisément les groupes et utilisateurs LDAP.</para>

          <para>Pour installer le paquet, saisissez dans un terminal :</para>

<screen>
<command>sudo apt-get install ldapscripts</command>
</screen>

          <para>Ensuite, modifiez le fichier de configuration <filename>/etc/ldapscripts/ldapscripts.conf</filename> en adaptant les éléments suivants à votre environnement :</para>       

<programlisting>
SERVER=localhost
BINDDN='cn=admin,dc=example,dc=com'
BINDPWDFILE="/etc/ldapscripts/ldapscripts.passwd"
SUFFIX='dc=example,dc=com'
GSUFFIX='ou=Groups'
USUFFIX='ou=People'
MSUFFIX='ou=Computers'
GIDSTART=10000
UIDSTART=10000
MIDSTART=10000
</programlisting>

          <para>Maintenant, créez le fichier <filename>ldapscripts.passwd</filename> pour permettre l'accès à l'annuaire :</para>

<screen>
<command>sudo sh -c "echo -n 'secret' &gt; /etc/ldapscripts/ldapscripts.passwd"</command>
<command>sudo chmod 400 /etc/ldapscripts/ldapscripts.passwd</command>
</screen>

          <note>
            <para>Remplacez <quote>secret</quote> par le mot de passe effectif de votre administrateur LDAP.</para>
          </note>

          <para>Les scripts <application>ldapscripts</application> sont maintenant prêts pour vous aider dans la gestion de votre annuaire. Les exemples suivants montrent comment utiliser ces scripts :</para>

          <itemizedlist>
	    <listitem>
              <para>Créez un nouvel utilisateur :</para>
<screen>
<command>sudo ldapadduser laurence exemple</command>
</screen>
              <para>Ceci créera un utilisateur ayant pour UID <emphasis role="italic">laurence</emphasis> et pour groupe primaire (GID) <emphasis role="italic">exemple</emphasis>.</para>
	    </listitem>
	    <listitem>
              <para>Modifiez un mot de passe utilisateur :</para>
<screen>
<command>sudo ldapsetpasswd laurence</command>
<computeroutput>Modifier le mot de passe de l'utilisateur uid=laurence,ou=People,dc=example,dc=com</computeroutput>
<userinput>Nouveau mot de passe : </userinput>
<userinput>Nouveau mot de passe (vérification) : </userinput>
</screen>
	    </listitem>
	    <listitem>
              <para>Supprimer un utilisateur :</para>
<screen>
<command>sudo ldapdeleteuser laurence</command>
</screen>

	    </listitem>
	    <listitem>
              <para>Ajouter un groupe :</para>
<screen>
<command>sudo ldapaddgroup qa</command>
</screen>
	    </listitem>
	    <listitem>
              <para>Supprimer un groupe :</para>
<screen>
<command>sudo ldapdeletegroup qa</command>
</screen>
	    </listitem>
	    <listitem>
              <para>Ajouter un utilisateur à un groupe :</para>
<screen>
<command>sudo ldapaddusertogroup laurence qa</command>
</screen>
              <para>Vous devez avoir maintenant un attribut <emphasis>memberUid</emphasis> ayant pour valeur <emphasis role="italic">laurence</emphasis> pour le groupe <emphasis role="italic">qa</emphasis>.</para>
	    </listitem>
            <listitem>
              <para>Supprimer un utilisateur d'un groupe :</para>
<screen>
<command>sudo ldapdeleteuserfromgroup laurence qa</command>
</screen>
              <para>L'attribut <emphasis>memberUid</emphasis> ne doit plus apparaître dans le groupe <emphasis role="italic">qa</emphasis> group.</para>
	    </listitem>
            <listitem>
              <para>Le script <application>ldapmodifyuser</application> vous permet d'ajouter, supprimer ou modifier les attributs des utilisateurs. Il utilise la même syntaxe que <application>ldapmodify</application>. Par exemple :</para>
<screen>
<command>sudo ldapmodifyuser laurence</command>
<computeroutput># About to modify the following entry :
dn: uid=laurence,ou=People,dc=example,dc=com
objectClass: account
objectClass: posixAccount
cn: george
uid: george
uidNumber: 1001
gidNumber: 1001
homeDirectory: /home/laurence
loginShell: /bin/bash
gecos: george
description: User account
userPassword:: e1NTSEF9eXFsTFcyWlhwWkF1eGUybVdFWHZKRzJVMjFTSG9vcHk=

# Enter your modifications here, end with CTRL-D.
dn: uid=laurence,ou=People,dc=example,dc=com</computeroutput>
<userinput>replace: gecos
gecos: Laurence Bibot</userinput>
</screen>
              <para>Le <emphasis>gecos</emphasis> de l'utilisateur doit être maintenant <quote>Laurence Bibot</quote>.</para>
	    </listitem>
            <listitem>
              <para>Le système de modèle est une autre caractéristique intéressante de <application>ldapscripts</application>. Les modèles vous permettent de personnaliser les attributs d'un utilisateur, d'un groupe ou des objets machines. Par exemple, pour activer le modèle <emphasis>utilisateur</emphasis>, modifiez <filename>/etc/ldapscripts/ldapscripts.conf</filename> ainsi :</para>

<programlisting>
UTEMPLATE="/etc/ldapscripts/ldapadduser.template"
</programlisting>

              <para>Des modèles <emphasis role="italic">types</emphasis> se trouvent dans le répertoire <filename>/etc/ldapscripts</filename>. Copiez ou renommer le fichier <filename>ldapadduser.template.sample</filename> en <filename>/etc/ldapscripts/ldapadduser.template</filename> :</para>

<screen>
<command>sudo cp /etc/ldapscripts/ldapadduser.template.sample /etc/ldapscripts/ldapadduser.template</command>
</screen>

              <para>Modifiez le nouveau modèle pour ajouter les attributs désirés. L'exemple suivant créera un nouvel utilisateur avec <emphasis>inetOrgPerson</emphasis> comme <emphasis>objectClass</emphasis> :</para>

<programlisting>
dn: uid=&lt;user&gt;,&lt;usuffix&gt;,&lt;suffix&gt;
objectClass: inetOrgPerson
objectClass: posixAccount
cn: &lt;user&gt;
sn: &lt;ask&gt;
uid: &lt;user&gt;
uidNumber: &lt;uid&gt;
gidNumber: &lt;gid&gt;
homeDirectory: &lt;home&gt;
loginShell: &lt;shell&gt;
gecos: &lt;user&gt;
description: User account
title: Employee
</programlisting>

              <para>Remarquez l'option <emphasis>&lt;ask&gt;</emphasis> utilisée pour le <emphasis>cn</emphasis>. L'utilisation de &lt;ask&gt; paramétrera <application>ldapadduser</application> pour vous demander la valeur de l'attribut lors de la création de l'utilisateur.</para>

	    </listitem>
          </itemizedlist>

          <para>Il y a d'autres scripts utiles dans le paquet. Tapez ce qui suit pour en voir la liste complète : <command>dpkg -L ldapscripts | grep bin</command></para>

        </sect2>
	<sect2 id="openldap-server-resources" status="review">
	  <title>Ressources</title>
	  <itemizedlist>
	    <listitem>
              <para>Pour plus d'informations se référer à la <ulink url="http://www.openldap.org/">page d'accueil de OpenLDAP</ulink></para>
	    </listitem>
	    <listitem>
              <para>Bien qu'il commence à se faire vieux, le livre <ulink url="http://www.oreilly.com/catalog/ldapsa/">LDAP System Administration</ulink> (en anglais) chez O'Reilly reste une excellente source d'informations approfondies. Il en existe une version française : <ulink url="http://www.oreilly.fr/catalogue/2841772934">LDAP - Administration système</ulink>.</para>
	    </listitem>
	    <listitem>
              <para>L'ouvrage de Packt, <ulink url="http://www.packtpub.com/OpenLDAP-Developers-Server-Open-Source-Linux/book">Mastering OpenLDAP</ulink>, est une bonne référence pour les versions récentes de OpenLDAP.</para>
	    </listitem>
	    <listitem>
              <para>Pour de plus amples informations à propos de <application>auth-client-config</application>, consultez la page de manuel : <command>man auth-client-config</command>.</para>
	    </listitem>
	    <listitem>
              <para>Pour de plus amples informations à propos du paquet <application>ldapscripts</application>, consultez les pages de manuel : <command>man ldapscripts</command>, <command>man ldapadduser</command>, <command>man ldapaddgroup</command>, etc.</para>
	    </listitem>
	  </itemizedlist>
	 
	</sect2>
  </sect1>
  <sect1 id="samba-ldap" status="review">
    <title>Samba et LDAP</title>

    <para>Cette section explique comment configurer Samba en LDAP pour les informations sur les comptes et l'authentification des utilisateurs, groupes et machines. Nous supposerons que votre annuaire OpenLDAP est déjà fonctionnel et configuré pour permettre l'authentification. Consultez <xref linkend="openldap-server"/> et <xref linkend="openldap-auth-config"/> pour de plus amples informations à propos de la mise en place de OpenLDAP.</para>

    <sect2 id="samba-ldap-installation" status="review">
      <title>Installation</title>
  
      <para>Trois  paquets sont nécessaires à l'intégration de Samba avec LDAP : <application>samba</application>, <application>samba-doc</application> et <application>smbldap-tools</application>. Pour installer ces paquets, saisissez dans un terminal :</para>

<screen>
<command>sudo apt-get install samba samba-doc smbldap-tools</command>
</screen>

      <para><application>smbldap-tools</application> n'est pas vraiment nécessaire sauf si vous n'avez pas d'autres méthodes pour la gestion des comptes utilisateurs, groupes et machines.</para>

    </sect2>
    <sect2 id="samba-ldap-openldap-configuration" status="review">
      <title>Configuration de OpenLDAP</title>

      <para>Pour que Samba puisse utiliser OpenLDAP comme <emphasis>passdb backend</emphasis> (gestionnaire d'authentification), les objets de l'utilisateur dans l'annuaire devront avoir des attributs supplémentaires. Nous supposerons dans cette section que vous souhaitez paramétrer Samba en tant que contrôleur de domaine Windows NT. Nous ajouterons donc les objets et attributs LDAP en conséquence.</para>
      
      <itemizedlist>
        <listitem>
          <para>Les attributs Samba sont définis dans le fichier <filename>samba.schema</filename> qui fait partie du paquet <application>samba-doc</application>. Le fichier schéma doit être décompressé et copié dans <filename>/etc/ldap/schema</filename>. Saisissez dans un terminal :</para>
        
<screen>
<command>sudo cp /usr/share/doc/samba-doc/examples/LDAP/samba.schema.gz /etc/ldap/schema/</command>
<command>sudo gzip -d /etc/ldap/schema/samba.schema.gz</command>
</screen>

         </listitem> 
         <listitem>

           <para>Le schéma <emphasis>samba</emphasis> doit être ajouté à l'arborescence du <emphasis>cn=config</emphasis>. La procédure d'ajout d'un nouveau schéma à <application>slapd</application> est également expliquée dans <xref linkend="openldap-configuration"/>.</para>

           <procedure>
              <step>
                <para>Créez d'abord un fichier de configuration <filename>schema_convert.conf</filename>, ou tout autre nom vous convenant, avec les données suivantes :</para>

<programlisting>
include /etc/ldap/schema/core.schema
include /etc/ldap/schema/collective.schema
include /etc/ldap/schema/corba.schema
include /etc/ldap/schema/cosine.schema
include /etc/ldap/schema/duaconf.schema
include /etc/ldap/schema/dyngroup.schema
include /etc/ldap/schema/inetorgperson.schema
include /etc/ldap/schema/java.schema
include /etc/ldap/schema/misc.schema
include /etc/ldap/schema/nis.schema
include /etc/ldap/schema/openldap.schema
include /etc/ldap/schema/ppolicy.schema
include /etc/ldap/schema/samba.schema
</programlisting>

              </step>
              <step>

                <para>Ensuite, créez un dossier temporaire pour conserver le résultat :</para> 

<screen>
<command>mkdir /tmp/ldif_output</command>
</screen>

              </step>
              <step>

                <para>Utilisez <application>slaptest</application> pour convertir les fichiers schémas :</para>

<screen>
<command>slaptest -f schema_convert.conf -F /tmp/ldif_output</command>
</screen>

                <para>Modifiez si nécessaire le nom et l'emplacement du fichier.</para>

              </step>
              <step>

                <para>Modifiez les attributs suivants dans le fichier <filename>/tmp/ldif_output/cn=config/cn=schema/cn={12}samba.ldif</filename> qui vient d'être créé :</para> 

<programlisting>
dn: cn=samba,cn=schema,cn=config
...
cn: samba
</programlisting>

                <para>Et supprimez les lignes suivantes situées en fin de fichier :</para> 

<programlisting>
structuralObjectClass: olcSchemaConfig
entryUUID: b53b75ca-083f-102d-9fff-2f64fd123c95
creatorsName: cn=config
createTimestamp: 20080827045234Z
entryCSN: 20080827045234.341425Z#000000#000#000000
modifiersName: cn=config
modifyTimestamp: 20080827045234Z
</programlisting>

                <note>
                  <para>Les valeurs des attributs peuvent varier, assurez-vous simplement qu'ils soient supprimés.</para>
                </note>

              </step>
              <step>

                <para>Finalement, ajoutez le nouveau schéma au dossier en utilisant <application>ldapadd</application> :</para>

<screen>
<command>ldapadd -x -D cn=admin,cn=config -W -f /tmp/ldif_output/cn\=config/cn\=schema/cn\=\{12\}samba.ldif</command>
</screen>

              </step>
            </procedure>

            <para>Il doit y avoir maintenant une nouvelle entrée <emphasis>dn: cn={X}misc,cn=schema,cn=config</emphasis> (où X est le schéma séquentiel suivant) dans l'arborescence de cn=config.</para> 

          </listitem>
          <listitem>

            <para>Copiez et collez ce qui suit dans un fichier nommé <filename>samba_indexes.ldif</filename> :</para>

<programlisting>
dn: olcDatabase={1}hdb,cn=config
changetype: modify
add: olcDbIndex
olcDbIndex: uidNumber eq
olcDbIndex: gidNumber eq
olcDbIndex: loginShell eq
olcDbIndex: uid eq,pres,sub
olcDbIndex: memberUid eq,pres,sub
olcDbIndex: uniqueMember eq,pres
olcDbIndex: sambaSID eq
olcDbIndex: sambaPrimaryGroupSID eq
olcDbIndex: sambaGroupType eq
olcDbIndex: sambaSIDList eq
olcDbIndex: sambaDomainName eq
olcDbIndex: default sub
</programlisting>

            <para>Chargez le nouvel index à l'aide de <application>ldapmodify</application> :</para>

<screen>
<command>ldapmodify -x -D cn=admin,cn=config -W -f samba_indexes.ldif</command>
</screen>
            <para>Si tout s'est bien passé, vous devez maintenant voir les nouveaux index à l'aide de <application>ldapsearch</application> :</para>

<screen>
<command>ldapsearch -xLLL -D cn=admin,cn=config -x -b cn=config -W olcDatabase={1}hdb</command>
</screen>

          </listitem>
          <listitem>
 
            <para>Configurez ensuite le paquet <application>smbldap-tools</application> selon votre environnement. Un script de configuration vous posera des questions à propos des options souhaitées. Pour lancer le script, saisissez :</para>

<screen>
<command>sudo gzip -d /usr/share/doc/smbldap-tools/configure.pl.gz</command>
<command>sudo perl /usr/share/doc/smbldap-tools/configure.pl</command>
</screen>

            <para>Deux fichiers seront créés une fois les réponses données : <filename>/etc/smbldap-tools/smbldap.conf</filename> et <filename>/etc/smbldap-tools/smbldap_bind.conf</filename>. Ces fichiers sont générés par le script de configuration. Si vous commettez une erreur durant l'exécution du script, il est plus simple de modifier les fichiers après coup.</para>

          </listitem>
          <listitem>

            <para>Le script <application>smbldap-populate</application> ajoutera les utilisateurs, groupes et objets LDAP nécessaires à Samba. Il est judicieux d'effectuer une sauvegarde au format LDIF (LDAP Data Interchange Format) avec <application>slapcat</application> au préalable :</para>

<screen>
<command>sudo slapcat -l backup.ldif</command>
</screen>
          
          </listitem>
          <listitem>

            <para>Une fois la sauvegarde effectuée, lancez <application>smbldap-populate</application> en saisissant :</para>

<screen>
<command>sudo smbldap-populate</command>
</screen>

          <note>
            <para>Vous pouvez créer un fichier LDIF contenant les nouveaux objets Samba en lançant <command>sudo smbldap-populate -e samba.ldif</command>. Ceci vous permettra de vérifier les changements pour vous assurer que tout est correct.</para>
          </note>
        </listitem>
      </itemizedlist>

      <para>Votre annuaire LDAP a maintenant les informations de domaine nécessaires pour l'identification d'utilisateurs Samba.</para>

    </sect2>
    <sect2 id="samba-ldap-samba-configuration">
      <title>Configuration de Samba</title>

      <para>Il y a plusieurs moyens de configurer Samba. Pour de plus amples informations sur les configurations courantes, consultez <xref linkend="windows-networking"/>. Pour intégrer Samba à LDAP, modifiez le fichier principal de Samba <filename>/etc/samba/smb.conf</filename> en commentant l'option <emphasis>passdb backend</emphasis> et en ajoutant :</para>

<programlisting>
#   passdb backend = tdbsam

# LDAP Settings
   passdb backend = ldapsam:ldap://hostname
   ldap suffix = dc=example,dc=com
   ldap user suffix = ou=People
   ldap group suffix = ou=Groups
   ldap machine suffix = ou=Computers
   ldap idmap suffix = ou=Idmap
   ldap admin dn = cn=admin,dc=example,dc=com
   ldap ssl = start tls
   ldap passwd sync = yes
...
   add machine script = sudo /usr/sbin/smbldap-useradd -t 0 -w "%u"
</programlisting>

      <para>Redémarrez <application>samba</application> pour activer les nouveaux paramètres :</para>

<screen>
<command>sudo /etc/init.d/samba restart</command>
</screen>

      <para>Vous devez donner maintenant le mot de passe de l'administrateur LDAP à Samba :</para>

<screen>
<command>sudo smbpasswd -w secret</command>
</screen>

      <note>
        <para>Remplacez <emphasis role="italic">secret</emphasis> par le mot de passe de votre administrateur LDAP.</para>
      </note>

      <para>Si vous avez déjà des utilisateurs dans LDAP et que vous souhaitez qu'ils puissent s'authentifier en utilisant Samba, ils auront besoin d'attributs Samba définis dans le fichier <filename>samba.schema</filename>. Ajoutez ces attributs aux utilisateurs existants à l'aide de <application>smbpasswd</application> en remplaçant <emphasis role="italic">identifiant</emphasis> par le nom d'utilisateur réel.</para>

<screen>
<command>sudo smbpasswd -a identifiant</command>
</screen>

      <para>Le mot de passe de l'utilisateur vous sera alors demandé.</para>

      <para>Pour ajouter un nouvel utilisateur, groupe ou compte machine, utilisez les programmes du paquet <application>smbldap-tools</application>. Voici quelques exemples :</para> 

      <itemizedlist>
        <listitem>
          <para>Pour ajouter un nouvel utilisateur dans LDAP avec des attributs Samba (remplacez identifiant par le nom d'utilisateur réel) :</para>
<screen>
<command>sudo smbldap-useradd -a -P identifiant</command>
</screen>
          <para>L'option <emphasis>-a</emphasis> ajoute les attributs Samba et l'option <emphasis>-P</emphasis> lance l'utilitaire <application>smbldap-passwd</application> après la création de l'utilisateur et vous permet de saisir un mot de passe pour celui-ci.</para>
        </listitem>
        <listitem>
          <para>Pour supprimer un utilisateur de l'annuaire :</para>
<screen>
<command>sudo smbldap-userdel identifiant</command>
</screen>
          <para><application>smbldap-userdel</application> a aussi une option <emphasis>-r</emphasis> pour supprimer le répertoire personnel de l'utilisateur.</para>
        </listitem>
        <listitem>
          <para>Pour ajouter un groupe (remplacez nom_de_groupe par le groupe approprié) :</para>
<screen>
<command>sudo smbldap-groupadd -a nom_de_groupe</command>
</screen>
          <para>Comme pour <application>smbldap-useradd</application>, l'option <emphasis>-a</emphasis> ajoute les attributs Samba.</para>
        </listitem>
        <listitem>
          <para>Pour ajouter un utilisateur à un groupe :</para>
<screen>
<command>sudo smbldap-groupmod -m identifiant nom_de_groupe</command>
</screen>
          <para>N'oubliez pas de remplacer <emphasis>identifiant</emphasis> par un vrai nom d'utilisateur. L'option <emphasis>-m</emphasis> vous permet d'ajouter plusieurs utilisateurs à la fois en séparant chaque utilisateur par une <emphasis>virgule</emphasis>.</para>
        </listitem>
        <listitem>
          <para><application>smbldap-groupmod</application> peut aussi être utilisé pour enlever un utilisateur d'un groupe :</para>
<screen>
<command>sudo smbldap-groupmod -x identifiant nom_de_groupe</command>
</screen>
        </listitem>
        <listitem>
          <para>Vous pouvez aussi ajouter des comptes machines grâce à <application>smbldap-useradd</application> :</para>
<screen>
<command>sudo smbldap-useradd -t 0 -w nom_machine</command>
</screen>
          <para>Remplacez <emphasis>nom_machine</emphasis> par le nom d'hôte de votre client. L'option <emphasis>-t 0</emphasis> crée un compte machine immédiatement et <emphasis>-w</emphasis> indique que ce qui suit n'est pas un utilisateur mais un compte machine. Il est à noter que l'option <emphasis>add machine script</emphasis> dans <filename>/etc/samba/smb.conf</filename> a été changée de manière a utiliser <application>smbldap-useradd</application>.</para>
        </listitem>
      </itemizedlist>

      <para>D'autres programmes et options sont disponibles dans le paquet <application>smbldap-tools</application>. La page de manuel de chaque programme vous en dira plus.</para>

    </sect2>
    <sect2 id="samba-ldap-resources" status="review">
      <title>Ressources</title>

      <itemizedlist>
        <listitem>
          <para>Différentes pages de la <ulink url="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/">collectiion des guides SAMBA</ulink> (en anglais) traitent de LDAP et Samba.</para>
        </listitem>
        <listitem>
          <para>Voir plus spécialement la <ulink url="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/passdb.html">section passdb</ulink>.</para>
        </listitem>
        <listitem>
          <para>Un autre bon site est <ulink url="http://www.iallanis.info/smbldap-tools/docs/samba-ldap-howto/">Samba OpenLDAP HOWTO</ulink>.</para>
        </listitem>
        <listitem>
          <para>Pour de plus amples informations sur <application>smbldap-tools</application>, consultez les pages de manuel : <command>man smbldap-useradd</command>, <command>man smbldap-groupadd</command>, <command>man smbldap-populate</command>, etc.</para>
        </listitem>
      </itemizedlist>
    </sect2>
  </sect1>
  <sect1 id="kerberos" status="review">
    <title>Kerberos</title>
    
    <para><application>Kerberos</application> est un système d'authentification réseau basé sur le principe d'un tiers de confiance. Les deux autres parties sont l'utilisateur et le service sur lequel l'utilisateur veut s'authentifier. Tous les services et applications ne savent pas utiliser Kerberos, mais pour ceux qui en sont capables, cela rapproche l'environnement réseau d'un système à authentification unique (Single Sign On ou SSO).</para>

    <para>Cette section couvre l'installation et la configuration d'un serveur Kerberos, et propose quelques exemples de configurations de clients.</para>
    
    <sect2 id="kerberos-overview" status="review">
      <title>Aperçu</title>

      <para>Si vous débutez avec Kerberos, il y a quelques termes qu'il est bon de comprendre avant de paramétrer un serveur Kerberos. La plupart des termes sont proches d'éléments qui peuvent vous être familiers dans d'autres environnements.</para>

      <itemizedlist>
        <listitem>
          <para><emphasis>Principal :</emphasis> tous les utilisateurs, ordinateurs et services fournis par des serveurs doivent être définis comme « principals » Kerberos. (NdT : un « principal » Kerberos est une chaîne de caractères constituant une identité unique à laquelle Kerberos peut assigner des tickets.)</para>
        </listitem>
        <listitem>
          <para>
          <emphasis>Instances:</emphasis> are used for service principals and special administrative principals.
          </para>
        </listitem>
        <listitem>
          <para>
          <emphasis>Realms:</emphasis> the unique realm of control provided by the Kerberos installation.  Usually the DNS domain converted to 
          uppercase (EXAMPLE.COM).
          </para>
        </listitem>
        <listitem>
          <para>
          <emphasis>Key Distribution Center:</emphasis> (KDC) consist of three parts, a database of all principals, the authentication server,
          and the ticket granting server.  For each realm there must be at least one KDC.
          </para>
        </listitem>
        <listitem>
          <para><emphasis>Ticket d'octroi de ticket :</emphasis> émis par le serveur d'authentification (AS), le ticket d'octroi du ticket (TGT) est chiffré avec le mot de passe utilisateur qui n'est connu que par l'utilisateur et le KDC.</para>
        </listitem>
        <listitem>
          <para><emphasis>Serveur d'octroi de ticket :</emphasis> (TGS) génère sur demande des tickets de service aux clients.</para>
        </listitem>
        <listitem>
          <para>
          <emphasis>Tickets:</emphasis> confirm the identity of the two principals.  One principal being a user and the other a service requested by 
          the user.  Tickets establish an encryption key used for secure communication during the authenticated session.
          </para>
        </listitem>
        <listitem>
          <para><emphasis>Fichiers Keytab :</emphasis> ce sont des fichiers extraits de la base de données KDC des « principals » et qui contiennent la clé de chiffrement pour un service ou un hôte.</para>
        </listitem>
      </itemizedlist>

      <para>
      To put the pieces together, a Realm has at least one KDC, preferably two for redundancy, which contains a database of Principals.  When a 
      user principal logs into a workstation, configured for Kerberos authentication, the KDC issues a Ticket Granting Ticket (TGT).  If the user
      supplied credentials match, the user is authenticated and can then request tickets for Kerberized services from the Ticket Granting Server
      (TGS).  The service tickets allow the user to authenticate to the service without entering another username and password.
      </para>
   
    </sect2>
    <sect2 id="kerberos-server" status="review">
      <title>Serveur Kerberos</title>    
      <sect3 id="kerberos-server-installation" status="review">
        <title>Installation</title>

        <para> 
        Before installing the Kerberos server a properly configured DNS server is needed for your domain.  Since the Kerberos Realm by 
        convention matches the domain name, this section uses the <emphasis>example.com</emphasis> domain configured in 
        <xref linkend="dns-primarymaster-configuration"/>.  
        </para>

        <para>
        Also, Kerberos is a time sensitive protocol.  So if the local system time between a client machine and the server differs by
        more than five minutes (by default), the workstation will not be able to authenticate.  To correct the problem all hosts 
        should have their time synchronized using the <emphasis>Network Time Protocol (NTP)</emphasis>.  For details
        on setting up NTP see <xref linkend="NTP"/>.
        </para>

        <para>
        The first step in installing a Kerberos Realm is to install the <application>krb5-kdc</application>  and 
        <application>krb5-admin-server</application> packages.  From a terminal enter:
        </para>

<screen>
<command>sudo apt-get install krb5-kdc krb5-admin-server</command>
</screen>

        <para>
        You will be asked at the end of the install to supply a name for the Kerberos and Admin servers, which may or may not be the 
        same server, for the realm.
        </para>

        <para>
        Next, create the new realm with the <application>kdb5_newrealm</application> utility:
        </para>

<screen>
<command>sudo krb5_newrealm</command>
</screen>

      </sect3>
      <sect3 id="kerberos-server-configuration" status="review">
        <title>Configuration</title>
      
        <para>
        The questions asked during installation are used to configure the <filename>/etc/krb5.conf</filename> file.  If you need to adjust 
        the Key Distribution Center (KDC) settings simply edit the file and restart the <application>krb5-kdc</application> daemon.
        </para>

        <procedure>
          <step>

            <para>
            Now that the KDC running an admin user is needed.  It is recommended to use a different username from your everyday username.  
            Using the <application>kadmin.local</application> utility in a terminal prompt enter:
            </para>

<screen>
<command>sudo kadmin.local</command>
<computeroutput>Authenticating as principal root/admin@EXAMPLE.COM with password.
kadmin.local:</computeroutput><userinput> addprinc steve/admin</userinput>
<computeroutput>WARNING: no policy specified for steve/admin@EXAMPLE.COM; defaulting to no policy
Enter password for principal "steve/admin@EXAMPLE.COM": 
Re-enter password for principal "steve/admin@EXAMPLE.COM": 
Principal "steve/admin@EXAMPLE.COM" created.
kadmin.local:</computeroutput><userinput> quit</userinput>
</screen>

            <para>
            In the the above example <emphasis role="italic">steve</emphasis> is the <emphasis>Principal</emphasis>, 
            <emphasis role="italic">/admin</emphasis> is an <emphasis>Instance</emphasis>, and 
            <emphasis role="italic">@EXAMPLE.COM</emphasis> signifies the realm.  The <emphasis role="italic">"every day"</emphasis>
            Principal would be <emphasis>steve@EXAMPLE.COM</emphasis>, and should have only normal user rights.            
            </para>

            <note>
              <para>
              Replace <emphasis>EXAMPLE.COM</emphasis> and <emphasis>steve</emphasis> with your Realm and admin username.
              </para>
            </note>

          </step>
          <step>
 
            <para>
            Next, the new admin user needs to have the appropriate Access Control List (ACL) permissions.
            The permissions are configured in the <filename>/etc/krb5kdc/kadm5.acl</filename> file:
            </para>

<programlisting>
steve/admin@EXAMPLE.COM        *
</programlisting>

            <para>
            This entry grants <emphasis>steve/admin</emphasis> the ability to perform any operation on all principals in the realm.
            </para>

          </step>
          <step>

            <para>Redémarrez maintenant <application>krb5-admin-server</application> pour que les nouvelles ACL soient prises en compte :</para>

<screen>
<command>sudo /etc/init.d/krb5-admin-server restart</command>
</screen>

          </step>
          <step>

            <para>Le nouveau « principal » d'utilisateur peut être testé en utilisant <application>kinit utility</application> :</para>

<screen>
<command>kinit steve/admin</command>
<computeroutput>Mot de passe de steve/admin@EXAMPLE.COM :</computeroutput>
</screen>          

            <para>Après avoir saisi le mot de passe, utilisez <application>klist</application> pour afficher les informations du TGT (Ticket Granting Ticket, ticket d'octroi de tickets) :</para>

<screen>
<command>klist</command>
<computeroutput>Credentials cache: FILE:/tmp/krb5cc_1000
        Principal: steve/admin@EXAMPLE.COM

  Issued           Expires          Principal
Jul 13 17:53:34  Jul 14 03:53:34  krbtgt/EXAMPLE.COM@EXAMPLE.COM</computeroutput>
</screen>

            <para>Vous aurez peut-être besoin d'ajouter une entrée dans <filename>/etc/hosts</filename> pour le KDC. Par exemple :</para>
            
<programlisting>
192.168.0.1   kdc01.example.com       kdc01
</programlisting>

            <para>En remplaçant <emphasis>192.168.0.1</emphasis> par l'adresse IP de votre KDC.</para>

          </step>
          <step>
          
            <para>Pour que les clients puissent déterminer le KDC pour le domaine (realm), des entrées DNS SRV sont requises. Ajoutez ce qui suit à <filename>/etc/named/db.example.com</filename> :</para>

<programlisting>
_kerberos._udp.EXAMPLE.COM.     IN SRV 1  0 88  kdc01.example.com.
_kerberos._tcp.EXAMPLE.COM.     IN SRV 1  0 88  kdc01.example.com.
_kerberos._udp.EXAMPLE.COM.     IN SRV 10 0 88  kdc02.example.com. 
_kerberos._tcp.EXAMPLE.COM.     IN SRV 10 0 88  kdc02.example.com. 
_kerberos-adm._tcp.EXAMPLE.COM. IN SRV 1  0 749 kdc01.example.com.
_kpasswd._udp.EXAMPLE.COM.      IN SRV 1  0 464 kdc01.example.com.
</programlisting>

            <note>
              <para>Remplacez <emphasis>EXAMPLE.COM</emphasis>, <emphasis>kdc01</emphasis>, et <emphasis>kdc02</emphasis> par vos noms de domaine, de serveur KDC primaire et secondaire.</para>
            </note>

            <para>Consultez <xref linkend="dns"/> pour des instructions détaillées sur le paramétrage des DNS.</para>

          </step>
        </procedure>
       
        <para>Votre nouveau domaine (realm) Kerberos est maintenant prêt à authentifier des clients.</para>

      </sect3>
    </sect2>
    <sect2 id="kerberos-secondary-kdc" status="review">
      <title>KDC secondaire</title>

      <para>Une fois que vous avez un KDC (Key Distribution Center, centre de distribution de clés) opérationnel sur votre réseau, il est habituel de créer un KDC secondaire au cas où le premier deviendrait indisponible.</para> 
      
      <procedure>
        <step>
        
        <para>Tou d'abord, installez les paquets, et lors de la demande des noms de serveurs Kerberos et Admin, saisiissez le nom du serveur KDC primaire :</para>

<screen>
<command>sudo apt-get install krb5-kdc krb5-admin-server</command>
</screen>

        </step>
        <step>

        <para>Une fois les paquets installés, créez un « principal » du KDC secondaire. Dans un terminal, saisissez :</para>

<screen>
<command>kadmin -q "addprinc -randkey host/kdc02.example.com"</command>
</screen>
    
        <note>
          <para>Ensuite, l'exécution de n'importe quelle commande <application>kadmin</application> nécessitera l'introduction du mot de passe du « principal » <emphasis>username/admin@EXAMPLE.COM</emphasis>.</para>
        </note>
      
        </step>
        <step>

          <para>Extrayez le fichier <emphasis>keytab</emphasis> :</para>

<screen>
<command>kadmin -q "ktadd -k keytab.kdc02 host/kdc02.example.com"</command>
</screen>

        </step>
        <step>

          <para>Il devrait y avoir un fichier <filename>keytab.kdc02</filename> dans le dossier actuel. Déplacez le vers <filename>/etc/krb5.keytab</filename> :</para>

<screen>
<command>sudo mv keytab.kdc02 /etc/krb5.keytab</command>
</screen>

          <note>
            <para>Si l'emplacement du fichier <filename>keytab.kdc02</filename> est différent, adaptez le en conséquence.</para>
          </note>

          <para>Vous pouvez également lister les « principals » d'un fichier Keytab à l'aide de <application>klist</application>, ce qui peut être utile au dépannage :</para>

<screen>
<command>sudo klist -k /etc/krb5.keytab</command>
</screen>

        </step>
        <step>

          <para>Ensuite, il doit exister un fichier <filename>kpropd.acl</filename> sur chaque KDC qui liste tous les KDC du domaine. Par exemple, sur les serveurs primaire et secondaire, créez le fichier <filename>/etc/krb5kdc/kpropd.acl</filename> :</para>

<programlisting>
host/kdc01.example.com@EXAMPLE.COM
host/kdc02.example.com@EXAMPLE.COM
</programlisting>

        </step>
        <step>

          <para>Créez une base de données vide sur le <emphasis>KDC secondaire</emphasis> :</para>

<screen>
<command>sudo kdb5_util -s create</command>
</screen>

        </step>
        <step>

          <para>Lancez maintenant le démon <application>kpropd</application>, qui écoute les connexions depuis l'utilitaire <application>kprop</application>. <application>kprop</application> est utilisé pour transférer des fichiers de sauvegarde :</para>

<screen>
<command>sudo kpropd -S</command>
</screen>
      
        </step>
        <step>

          <para>Depuis un terminal sur le <emphasis>KDC primaire</emphasis>, créez un fichier de sauvegarde de la base de données des « principals » :</para>

<screen>
<command>sudo kdb5_util dump /var/lib/krb5kdc/dump</command>
</screen>

        </step>
        <step>

          <para>Décompressez le fichier <emphasis>keytab</emphasis> du KDC primaire et copiez le dans <filename>/etc/krb5.keytab</filename> :</para>

<screen>
<command>kadmin -q "ktadd -k keytab.kdc01 host/kdc01.example.com"</command>
<command>sudo mv keytab.kdc01 /etc/kr5b.keytab</command>
</screen>

          <note>
            <para>Assurez-vous qu'il y ait un <emphasis>hôte</emphasis> pour <emphasis>kdc01.example.com</emphasis> avant d'extraire le Keytab.</para>
          </note>

        </step>
        <step>

          <para>L'utilitaire <application>kprop</application> envoie la base de données vers le serveur KDC secondaire :</para>

<screen>
<command>sudo kprop -r EXAMPLE.COM -f /var/lib/krb5kdc/dump kdc02.example.com</command>
</screen>

          <note>
            <para>Il devrait y avoir un message de <emphasis>succès</emphasis> si le transfert s'est bien passé. S'il y a un message d'erreur, vérifiez <filename>/var/log/syslog</filename> sur le KDC secondaire pour plus d'informations.</para>
          </note>
      
          <para>Vous pouvez également créer une tâche <application>cron</application> pour mettre à jour la base de données périodiquement sur le KDC secondaire. Par exemple, ceci va transférer la base de données toutes les heures :</para>

<programlisting>
# m h  dom mon dow   command
0 * * * * /usr/sbin/kdb5_util dump /var/lib/krb5kdc/dump &amp;&amp; /usr/sbin/kprop -r EXAMPLE.COM -f /var/lib/krb5kdc/dump kdc02.example.com
</programlisting>
  
        </step>
        <step>

          <para>De retour sur le <emphasis>KDC secondaire</emphasis>, créez un fichier <emphasis>stash</emphasis> qui contiendra la clé maître de Kerberos :</para>

<screen>
<command>sudo kdb5_util stash</command>
</screen>

        </step>
        <step>

          <para>Finalement, démarrez le service <application>krb5-kdc</application> sur le KDC secondaire :</para>

<screen>
<command>sudo /etc/init.d/krb5-kdc start</command>
</screen>

        </step>
      </procedure>

      <para>Le <emphasis>KDC secondaire</emphasis> devrait maintenant être capable d'émettre des tickets pour le domaine. Vous pouvez tester ceci en stoppant le service <application>krb5-kdc</application> sur le KDC primaire, puis en utilisant <application>kinit</application> pour demander un ticket. Si tout va bien, vous devriez recevoir un ticket du KDC secondaire.</para>

    </sect2>
    <sect2 id="kerberos-linux-client" status="review">
      <title>Client Kerberos Linux</title>    

      <para>Cette section couvre la configuration d'un système Linux comme un client <application>Kerberos</application>. Ceci va autoriser l'accès à n'importe quel service gérant Kerberos une fois l'utilisateur correctement connecté au système.</para>

      <sect3 id="kerberos-client-installation" status="review">
        <title>Installation</title>

        <para>Pour pouvoir s'authentifier sur un domaine Kerberos, les paquets <application>krb5-user</application> et <application>libpam-krb5</application> sont nécessaires, ainsi que quelques autres qui ne sont pas obligatoires mais vous faciliteront la tâche. Pour installer ces paquets tapez la commande suivante dans un terminal :</para>

<screen>
<command>sudo apt-get install krb5-user libpam-krb5 libpam-ccreds auth-client-config</command>
</screen>

        <para>Le paquet <application>auth-client-config</application> permet une configuration simple de PAM pour l'authentification depuis plusieurs sources. <application>libpam-ccreds</application> va mettre en cache les références de l'authentification pour vous permettre de vous connecter si le KDC (Key Distribution Center) n'est pas disponible. Ce paquet est également utile pour les portables qui s'identifient via Kerberos sur leur réseau professionnel, mais doivent également rester accessibles en dehors ce réseau.</para>

      </sect3>
      <sect3 id="kerberos-client-configuration" status="review">
        <title>Configuration</title>

        <para>Pour configurer le client, tapez dans un terminal :</para>

<screen>
<command>sudo dpkg-reconfigure krb5-config</command>
</screen>

        <para>Il vous sera alors demandé de donner le nom du domaine Kerberos. Si vous n'avez pas de DNS configuré avec des enregistrements <emphasis>SRV</emphasis> Kerberos, le menu vous demandera le nom de l'hôte KDC et du serveur d'administration du domaine.</para>

        <para><application>dpkg-reconfigure</application> ajoute des entrées au fichier <filename>/etc/krb5.conf</filename> pour votre domaine. Vous devriez avoir des entrées similaires à :</para>

<programlisting>
[libdefaults]
        default_realm = EXAMPLE.COM
...
[realms]
        EXAMPLE.COM = }                
                kdc = 192.168.0.1               
                admin_server = 192.168.0.1
        }
</programlisting>

        <para>Vous pouvez tester la configuration en demandant un ticket à l'aide de <application>kinit</application>. Par exemple :</para>

<screen>
<command>kinit steve@EXAMPLE.COM</command>
<computeroutput>Mot de passe pour steve@EXAMPLE.COM :</computeroutput>
</screen>

        <para>Lorsqu'un ticket a été accordé, les détails peuvent être affichés avec <application>klist</application> :</para>

<screen>
<command>klist</command>
<computeroutput>Ticket cache: FILE:/tmp/krb5cc_1000
Default principal: steve@EXAMPLE.COM

Valid starting     Expires            Service principal
07/24/08 05:18:56  07/24/08 15:18:56  krbtgt/EXAMPLE.COM@EXAMPLE.COM
        renew until 07/25/08 05:18:57


Kerberos 4 ticket cache: /tmp/tkt1000
klist: You have no tickets cached</computeroutput>
</screen>

        <para>Ensuite, utilisez <application>auth-client-config</application> pour configurer le module <application>libpam-krb5</application> pour demander un ticket lors de l'ouverture de session :</para>

<screen>
<command>sudo auth-client-config -a -p kerberos_example</command>
</screen>

        <para>Vous devriez maintenant recevoir un ticket dès qu'une ouverture de session avec authentification est réussie.</para>

      </sect3>
    </sect2>
    <sect2 id="kerberos-resources" status="review">
      <title>Ressources</title>

      <itemizedlist>
        <listitem>
          <para>Pour plus d'information sur Kerberos, consultez le site web <ulink url="http://web.mit.edu/Kerberos/">MIT Kerberos</ulink> (en anglais).</para>
        </listitem>
        <listitem>
          <para>Le guide d'O'Reilly <ulink url="http://oreilly.com/catalog/9780596004033/">Kerberos: The Definitive Guide</ulink> est une bonne référence pour mettre en place Kerberos.</para>
        </listitem>
        <listitem>
          <para>Vous êtes également le bienvenu sur le canal IRC anglophone <emphasis>#ubuntu-server</emphasis> sur <ulink url="http://freenode.net/">Freenode</ulink> si vous avez des questions au sujet de Kerberos.</para>
        </listitem>
      </itemizedlist>

    </sect2>
  </sect1>
  <sect1 id="kerberos-ldap" status="review">
    <title>Kerberos et LDAP</title>

    <para>Répliquer une bases de données de « principals » Kerberos entre deux serveurs peut être compliqué, et cela ajoute une base de données supplémentaire d'utilisateurs à votre réseau. Heureusement, MIT Kerberos peut être configuré pour utiliser un annuaire <application>LDAP</application> comme base de données de « principals ». Ce section couvre la configuration de serveurs Kerberos primaire et secondaire pour utiliser <application>OpenLDAP</application> pour cette base de données.</para>

    <sect2 id="kerberos-ldap-openldap" status="review">
      <title>Configuration OpenLDAP</title>

      <para>
      First, the necessary <emphasis>schema</emphasis> needs to be loaded on an <application>OpenLDAP</application> server that has
      network connectivity to the Primary and Secondary KDCs.  The rest of this section assumes that you also have LDAP replication
      configured between at least two servers.  For information on setting up OpenLDAP see <xref linkend="openldap-server"/>.
      </para>

      
      <para>
      It is also required to configure OpenLDAP for TLS and SSL connections, so that traffic between the KDC and LDAP server is encrypted.
      See <xref linkend="openldap-tls"/> for details.
      </para>
      
      <itemizedlist>
        <listitem>
          <para>Pour charger le schéma dans  LDAP, installez le paquet <application>krb5-kdc-ldap</application> sur le serveur LDAP. Saisissez dans un terminal :</para>

<screen>
<command>sudo apt-get install krb5-kdc-ldap</command>
</screen>

        </listitem>
        <listitem>
          <para>Ensuite, décompressez le fichier <filename>kerberos.schema.gz</filename> :</para>

<screen>
<command>sudo gzip -d /usr/share/doc/krb5-kdc-ldap/kerberos.schema.gz</command>
<command>sudo cp /usr/share/doc/krb5-kdc-ldap/kerberos.schema /etc/ldap/schema/</command>
</screen>

        </listitem>
        <listitem>

           <para>Le schéma <emphasis>Kerberos</emphasis> doit être ajouté à l'arborescence <emphasis>cn=config</emphasis>. La procédure pour ajouter un nouveau schéma à <application>slapd</application> est également expliquée dans <xref linkend="openldap-configuration"/>.</para>

           <procedure>
              <step>
                <para>Créez d'abord un fichier de configuration <filename>schema_convert.conf</filename>, ou tout autre nom vous convenant, avec les données suivantes :</para>

<programlisting>
include /etc/ldap/schema/core.schema
include /etc/ldap/schema/collective.schema
include /etc/ldap/schema/corba.schema
include /etc/ldap/schema/cosine.schema
include /etc/ldap/schema/duaconf.schema
include /etc/ldap/schema/dyngroup.schema
include /etc/ldap/schema/inetorgperson.schema
include /etc/ldap/schema/java.schema
include /etc/ldap/schema/misc.schema
include /etc/ldap/schema/nis.schema
include /etc/ldap/schema/openldap.schema
include /etc/ldap/schema/ppolicy.schema
include /etc/ldap/schema/kerberos.schema
</programlisting>


                </step>
                <step>

                  <para>Créez un dossier temporaire pour recevoir les fichiers LDIF :</para>
<screen>
<command>mkdir /tmp/ldif_output</command>
</screen>

                </step>
                <step>

                  <para>Utilisez <application>slaptest</application> pour convertir les fichiers schémas :</para>

<screen>
<command>slaptest -f schema_convert.conf -F /tmp/ldif_output</command>
</screen>

                  <para>Modifiez si nécessaire le nom et l'emplacement du fichier.</para>
                
                </step>
                <step>

                  <para>Modifiez le fichier <filename>/tmp/ldif_output/cn=config/cn=schema/cn={12}kerberos.ldif</filename> généré, en adaptant les attributs suivants :</para>

<programlisting>
dn: cn=kerberos,cn=schema,cn=config
...
cn: kerberos
</programlisting>

                  <para>Et supprimez les lignes suivantes à la fin du fichier :</para>

<programlisting>
structuralObjectClass: olcSchemaConfig
entryUUID: 18ccd010-746b-102d-9fbe-3760cca765dc
creatorsName: cn=config
createTimestamp: 20090111203515Z
entryCSN: 20090111203515.326445Z#000000#000#000000
modifiersName: cn=config
modifyTimestamp: 20090111203515Z
</programlisting>

                  <note>
                    <para>Les valeurs des attributs peuvent varier, assurez-vous simplement qu'ils soient supprimés.</para>
                  </note>

                </step>
                <step>

                  <para>
                  Load the new schema with <application>ldapadd</application>:
                  </para>

<screen>
<command>ldapadd -x -D cn=admin,cn=config -W -f /tmp/ldif_output/cn\=config/cn\=schema/cn\=\{12\}kerberos.ldif</command>
</screen>

                </step>
                <step>
        
                  <para>
                  Add an index for the <emphasis>krb5principalname</emphasis> attribute:
                  </para>

<screen>
<command>ldapmodify -x -D cn=admin,cn=config -W</command>
<computeroutput>Saisissez le mot de passe LDAP :
<userinput>dn: olcDatabase={1}hdb,cn=config
add: olcDbIndex
olcDbIndex: krbPrincipalName eq,pres,sub</userinput>

modifying entry "olcDatabase={1}hdb,cn=config"</computeroutput>
</screen>
      
                </step>
                <step>
        
                  <para>Enfin, mettez à jour la liste de contrôle d'accès (ACL) :</para>

<screen>
<command>ldapmodify -x -D cn=admin,cn=config -W</command>
<computeroutput>Enter LDAP Password: 
<userinput>dn: olcDatabase={1}hdb,cn=config
replace: olcAccess
olcAccess: to attrs=userPassword,shadowLastChange,krbPrincipalKey by dn="cn=admin,dc=exampl
 e,dc=com" write by anonymous auth by self write by * none
-
add: olcAccess
olcAccess: to dn.base="" by * read
-
add: olcAccess
olcAccess: to * by dn="cn=admin,dc=example,dc=com" write by * read</userinput>

modifying entry "olcDatabase={1}hdb,cn=config"
</computeroutput>
</screen>
      
                </step>
           </procedure>    
        </listitem>
      </itemizedlist>

      <para>Voila, votre annuaire LDAP est maintenant prêt à servir de base de données de « principals » Kerberos.</para>

    </sect2>
    <sect2 id="kerberos-ldap-primary-kdc" status="review">
      <title>Configuration du KDC primaire</title>

      <para>Avec <application>OpenLDAP</application> opérationnel, il est temps de configurer le KDC.</para>

      <itemizedlist>
        <listitem>
          <para>Tout d'abord, installez les paquets nécessaires. Saisissez dans un terminal :</para>

<screen>
<command>sudo apt-get install krb5-kdc krb5-admin-server krb5-kdc-ldap</command>
</screen>

        </listitem>
        <listitem>

          <para>Maintenant, modifiez <filename>/etc/krb5.conf</filename> en ajoutant les options suivantes dans les sections appropriées :</para>

<programlisting>
[libdefaults]
        default_realm = EXAMPLE.COM

...

[realms]
        EXAMPLE.COM = {
                kdc = kdc01.example.com
                kdc = kdc02.example.com
                admin_server = kdc01.example.com
                admin_server = kdc02.example.com
                default_domain = example.com
                database_module = openldap_ldapconf
        }

...

[domain_realm]
        .example.com = EXAMPLE.COM


...

[dbdefaults]
        ldap_kerberos_container_dn = dc=example,dc=com

[dbmodules]
        openldap_ldapconf = {
                db_library = kldap
                ldap_kdc_dn = "cn=admin,dc=example,dc=com"

                # this object needs to have read rights on
                # the realm container, principal container and realm sub-trees
                ldap_kadmind_dn = "cn=admin,dc=example,dc=com"

                # this object needs to have read and write rights on
                # the realm container, principal container and realm sub-trees
                ldap_service_password_file = /etc/krb5kdc/service.keyfile
                ldap_servers = ldaps://ldap01.example.com ldaps://ldap02.example.com
                ldap_conns_per_server = 5
        }
</programlisting>

          <note>
            <para>Remplacez <emphasis>example.com</emphasis>, <emphasis>dc=example,dc=com</emphasis>, <emphasis>cn=admin,dc=example,dc=com</emphasis>, et <emphasis>ldap01.example.com</emphasis> par votre domaine, objet LDAP et serveur LDAP de votre réseau, respectivement.</para>
          </note>

        </listitem>
        <listitem>
        
          <para>Ensuite, utilisez <application>kdb5_ldap_util</application> pour créer le domaine :</para>

<screen>
<command>sudo kdb5_ldap_util -D cn=admin,dc=example,dc=com create -subtrees dc=example,dc=com -r EXAMPLE.COM -s -H ldap://ldap01.example.com</command>
</screen>
      
        </listitem>
        <listitem>
        
          <para>
          Create a stash of the password used to bind to the LDAP server.  This password is used by the <emphasis>ldap_kdc_dn</emphasis> and        
          <emphasis>ldap_kadmin_dn</emphasis> options in <filename>/etc/krb5.conf</filename>:
          </para>

<screen>
<command>sudo kdb5_ldap_util -D cn=admin,dc=example,dc=com stashsrvpw -f /etc/krb5kdc/service.keyfile cn=admin,dc=example,dc=com</command>
</screen>
      
        </listitem>
        <listitem>
        
          <para>Copiez le certificat de l'AC depuis le serveur LDAP :</para>

<screen>
<command>scp ldap01:/etc/ssl/certs/cacert.pem .</command>
<command>sudo cp cacert.pem /etc/ssl/certs</command>
</screen>

          <para>Et modifiez <filename>/etc/ldap/ldap.conf</filename> pour utiliser le certificat:</para>

<programlisting>
TLS_CACERT /etc/ssl/certs/cacert.pem
</programlisting>

          <note>
            <para>
            The certificate will also need to be copied to the Secondary KDC, to allow the connection to the LDAP servers using
            LDAPS.
            </para>
          </note>
      
        </listitem>
      </itemizedlist>

      <para>
      You can now add Kerberos principals to the LDAP database, and they will be copied to any other LDAP servers configured for replication.
      To add a principal using the <application>kadmin.local</application> utility enter:
      </para>

<screen>
<command>sudo kadmin.local</command>
<computeroutput>Authenticating as principal root/admin@EXAMPLE.COM with password.
kadmin.local:  <userinput>addprinc -x dn="uid=steve,ou=people,dc=example,dc=com" steve</userinput>
WARNING: no policy specified for steve@EXAMPLE.COM; defaulting to no policy
Enter password for principal "steve@EXAMPLE.COM": 
Re-enter password for principal "steve@EXAMPLE.COM": 
Principal "steve@EXAMPLE.COM" created.</computeroutput>
</screen>

      <para>Les attributs krbPrincipalName, krbPrincipalKey, krbLastPwdChange, et krbExtraData devraient maintenant être ajoutés à l'objet utilisateur <emphasis>uid=steve,ou=people,dc=example,dc=com</emphasis>. Utilisez <application>kinit</application> et <application>klist</application> pour tester si l'utilisateur reçoit effectivement un ticket.</para>

      <note>
        <para>
        If the user object is already created the <emphasis>-x dn="..."</emphasis> option is needed to add the Kerberos attributes.
        Otherwise a new <emphasis>principal</emphasis> object will be created in the realm subtree.
        </para>
      </note>

    </sect2>
    <sect2 id="kerberos-ldap-secondary-kdc" status="review">
      <title>Secondary KDC Configuration</title>

      <para>
      Configuring a Secondary KDC using the LDAP backend is similar to configuring one using the normal Kerberos database.
      </para>

      <itemizedlist>
        <listitem>
          <para>Tout d'abord, installez les paquets nécessaires. Saisissez dans un terminalrez :</para>

<screen>
<command>sudo apt-get install krb5-kdc krb5-admin-server krb5-kdc-ldap</command>
</screen>

        </listitem>
        <listitem>

          <para>
          Next, edit <filename>/etc/krb5.conf</filename> to use the LDAP backend:
          </para>

<programlisting>
[libdefaults]
        default_realm = EXAMPLE.COM

...

[realms]
        EXAMPLE.COM = {
                kdc = kdc01.example.com
                kdc = kdc02.example.com
                admin_server = kdc01.example.com
                admin_server = kdc02.example.com
                default_domain = example.com
                database_module = openldap_ldapconf
        }

...

[domain_realm]
        .example.com = EXAMPLE.COM

...

[dbdefaults]
        ldap_kerberos_container_dn = dc=example,dc=com

[dbmodules]
        openldap_ldapconf = {
                db_library = kldap
                ldap_kdc_dn = "cn=admin,dc=example,dc=com"

                # this object needs to have read rights on
                # the realm container, principal container and realm sub-trees
                ldap_kadmind_dn = "cn=admin,dc=example,dc=com"

                # this object needs to have read and write rights on
                # the realm container, principal container and realm sub-trees
                ldap_service_password_file = /etc/krb5kdc/service.keyfile
                ldap_servers = ldaps://ldap01.example.com ldaps://ldap02.example.com
                ldap_conns_per_server = 5
        }
</programlisting>


        </listitem>
        <listitem>
        
      <para>
      Create the stash for the LDAP bind password:
      </para>

<screen>
<command>sudo kdb5_ldap_util -D cn=admin,dc=example,dc=com stashsrvpw -f /etc/krb5kdc/service.keyfile cn=admin,dc=example,dc=com</command>
</screen>
      
        </listitem>
        <listitem>

          <para>
          Now, on the <emphasis>Primary KDC</emphasis> copy the <filename>/etc/krb5kdc/.k5.EXAMPLE.COM</filename> 
          <emphasis>Master Key</emphasis> stash to the Secondary KDC.  Be sure to copy the file over an encrypted 
          connection such as <application>scp</application>, or on physical media.
          </para>

<screen>
<command>sudo scp /etc/krb5kdc/.k5.EXAMPLE.COM steve@kdc02.example.com:~</command>
<command>sudo mv .k5.EXAMPLE.COM /etc/krb5kdc/</command>
</screen>

        <note>
          <para>De nouveau, remplacez <emphasis>EXAMPLE.COM</emphasis> par votre domaine réel.</para>
        </note>

        </listitem>
        <listitem>

          <para>Enfin, démarrez le démon <application>krb5-kdc</application>:</para>

<screen>
<command>sudo /etc/init.d/krb5-kdc start</command>
</screen>

        </listitem>
      </itemizedlist>

      <para>Vous avez maintenant des KDCs redondants sur votre réseau, et avec des serveurs LDAP redondants, vous devriez être en mesure de continuer à authentifier les utilisateurs si un serveur LDAP, un serveur Kerberos, ou un serveur LDAP et un serveur Kerberos deviennent indisponibles.</para>

    </sect2>
    <sect2 id="kerberos-ldap-resources" status="review">
      <title>Ressources</title>

      <itemizedlist>
        <listitem>
          <para><ulink url="http://web.mit.edu/Kerberos/krb5-1.6/krb5-1.6.3/doc/krb5-admin.html#Configuring-Kerberos-with-OpenLDAP-back_002dend">Le Guide d'administration de Kerberos</ulink> contient des détails supplémentaires.</para>
        </listitem>
        <listitem>
          <para>Pour plus d'informations sur <application>kdb5_ldap_util</application>, voir la <ulink url="http://web.mit.edu/Kerberos/krb5-1.6/krb5-1.6.3/doc/krb5-admin.html#Global-Operations-on-the-Kerberos-LDAP-Database"> Rubrique 5.6 </ulink> et la <ulink url="http://manpages.ubuntu.com/manpages/jaunty/fr/man8/kdb5_ldap_util.8.html">page de manuel kdb5_ldap_util</ulink>.</para>
        </listitem>
        <listitem>
          <para>Un autre lien utile est la <ulink url="http://manpages.ubuntu.com/manpages/jaunty/fr/man5/krb5.conf.5.html">page de manuel de krb5.conf</ulink>.</para>
        </listitem>
      </itemizedlist>

    </sect2>
  </sect1>
</chapter>
