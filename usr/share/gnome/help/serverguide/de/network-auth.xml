<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN" "http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd" [
<!ENTITY % globalent SYSTEM "../../libs/global.ent">
<!-- NAMES --><!ENTITY canonical-name "Canonical Ltd.">
<!ENTITY project-name "Ubuntu Documentation Project">
<!ENTITY ubuntu "<phrase>Ubuntu</phrase>">
<!ENTITY sg-title "Server Guide">
<!-- VERSIONS --><!ENTITY distro-version "Jaunty Jackalope">
<!ENTITY distro-rev "9.04">
<!ENTITY distro-release-date "April 2009">
<!ENTITY distro-short-codename "jaunty">
<!ENTITY distro-apt-cd-name "Ubuntu 9.04_Jaunty_Jackalope">
<!ENTITY linux-kernel-version "2.6.27">
<!ENTITY gcc-version "4.3.1">
<!ENTITY glibc-version "2.8">
<!ENTITY python-version "2.5">
<!ENTITY glossary SYSTEM "../common/C/glossary.xml">
<!-- LEGAL URLs --><!ENTITY legalnotice SYSTEM "../libs/C/legalnotice.xml">
<!ENTITY gpl-url '<ulink url="http://www.gnu.org/licenses/gpl.html">GNU General Public License</ulink>'>
<!ENTITY cc "http://creativecommons.org/">
<!ENTITY cc-attrib '<ulink url="http://creativecommons.org/licenses/by-sa/2.5/">Attribution-ShareAlike 2.5</ulink>'>
<!ENTITY cc-fulldeed-url "http://creativecommons.org/licenses/by-sa/2.5/legalcode/">
<!ENTITY fdl-url '<ulink url="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License</ulink>'>
<!ENTITY cc-disclaimer-url "http://creativecommons.org/licenses/disclaimer-popup?lang=en">
<!-- CANONICAL URL RESOURCES --><!ENTITY canonical-url "http://www.canonical.com">
<!-- OTHER UBUNTU RELATED RESOURCES --><!ENTITY upstart-url "http://upstart.ubuntu.com">
<!-- UBUNTU IRC INFORMATION --><!ENTITY irc-network "Freenode">
<!ENTITY irc-server "irc.ubuntu.com">
<!ENTITY ubuntu-irc "irc.ubuntu.com channel #ubuntu">
<!ENTITY kubuntu-irc "irc.ubuntu.com channel #kubuntu">
<!ENTITY xubuntu-irc "irc.ubuntu.com channel #xubuntu">
<!ENTITY edubuntu-irc "irc.ubuntu.com channel #edubuntu">
<!-- UBUNTU URL RESOURCES --><!ENTITY ubuntu-packages "http://packages.ubuntu.com">
<!ENTITY ubuntu-web "http://www.ubuntu.com">
<!ENTITY ubuntu-main "http://www.ubuntu.com">
<!ENTITY ubuntu-download "http://www.ubuntu.com/download">
<!ENTITY ubuntu-forums "http://www.ubuntu.com/community/forums">
<!ENTITY ubuntu-components "http://www.ubuntu.com/ubuntu/components">
<!ENTITY ubuntu-lists "http://lists.ubuntu.com">
<!ENTITY ubuntu-wiki "http://wiki.ubuntu.com">
<!ENTITY ubuntu-bugzilla "https://launchpad.net/distros/ubuntu/+bugs">
<!ENTITY ubuntu-doc-bugs "https://launchpad.net/products/ubuntu-doc/+bugs">
<!ENTITY ubuntu-support "http://www.ubuntu.com/support">
<!ENTITY ubuntu-paidsupport "http://www.ubuntu.com/support/paid">
<!ENTITY ubuntu-freesupport "http://www.ubuntu.com/support/free">
<!ENTITY ubuntu-comments "http://www.ubuntuforums.org/showthread.php?p=21787">
<!ENTITY ubuntu-documentation "http://help.ubuntu.com">
<!ENTITY ubuntu-documentation-repos "https://docteam.ubuntu.com/repos/trunk">
<!ENTITY ubuntu-doc-team "https://wiki.ubuntu.com/DocumentationTeam">
<!ENTITY ubuntu-doc-list "http://lists.ubuntu.com/mailman/listinfo/ubuntu-doc">
<!ENTITY ubuntu-shipit "http://shipit.ubuntu.com">
<!ENTITY ubuntu-launchpad "https://launchpad.ubuntu.com">
<!ENTITY ubuntu-rosetta "https://launchpad.ubuntu.com/rosetta">
<!ENTITY ubuntu-planet "http://planet.ubuntu.com">
<!ENTITY ubuntu-philosophy "http://www.ubuntu.com/ubuntu/philosophy">
<!ENTITY ubuntu-participate "http://www.ubuntu.com/community/participate/">
<!ENTITY ubuntu-marketplace "http://www.ubuntu.com/support/marketplace">
<!ENTITY ubuntu-hwdb "http://hwdb.ubuntu.com">
<!-- UBUNTU WIKI RESOURCES --><!ENTITY wiki-UserDocumentation "https://help.ubuntu.com/community/UserDocumentation">
<!ENTITY restricted-formats "https://help.ubuntu.com/community/RestrictedFormats">
<!ENTITY wiki-RestrictedFormats "https://help.ubuntu.com/community/RestrictedFormats">
<!ENTITY wiki-XChatHowto "https://help.ubuntu.com/community/XChatHowto">
<!ENTITY wiki-RootSudo "https://help.ubuntu.com/community/RootSudo">
<!ENTITY wiki-HowToGetHelp "https://help.ubuntu.com/community/HowToGetHelp">
<!ENTITY transcode "https://help.ubuntu.com/community/DVDRippingandEncoding">
<!ENTITY wiki-Wine "https://help.ubuntu.com/community/Wine">
<!ENTITY wiki-Cedega "https://help.ubuntu.com/community/Cedega">
<!ENTITY wiki-Nano "https://help.ubuntu.com/community/NanoHowto">
<!ENTITY wiki-locoteams "https://wiki.ubuntu.com/LoCoTeamList">
<!ENTITY wiki-BasicCommands "https://help.ubuntu.com/community/BasicCommands">
<!ENTITY wiki-filepermissions "https://help.ubuntu.com/community/FilePermissions">
<!-- KUBUNTU URL RESOURCES --><!ENTITY kubuntu-web "http://www.kubuntu.org">
<!ENTITY kubuntu-main "http://www.kubuntu.org">
<!ENTITY kubuntu-download "http://releases.ubuntu.com/kubuntu/">
<!ENTITY kubuntu-packages "http://packages.ubuntu.com/edgy/">
<!ENTITY kubuntu-cdpackages-nodefault "http://people.ubuntu.com/~cjwatson/seeds/kubuntu-edgy/ship">
<!ENTITY kubuntu-lists "http://lists.ubuntu.com/archives/kubuntu-users/">
<!ENTITY kubuntu-lists-users "http://lists.ubuntu.com/mailman/listinfo/kubuntu-users/">
<!ENTITY kubuntu-lists-devel "http://lists.ubuntu.com/mailman/listinfo/kubuntu-devel/">
<!ENTITY kubuntu-mirrors "http://distrowatch.com/kubuntu">
<!ENTITY kubuntu-forums "http://kubuntuforums.net">
<!ENTITY kubuntu-wiki "https://wiki.kubuntu.org">
<!ENTITY kubuntu-documentation-site "http://www.kubuntu.org/documentation.php">
<!ENTITY kubuntu-wiki-UserDocumentation "https://help.ubuntu.com/community/UserDocumentation">
<!ENTITY kubuntu-support "http://www.kubuntu.org/support.php">
<!-- XUBUNTU URL RESOURCES --><!ENTITY xubuntu-web "http://www.xubuntu.org">
<!ENTITY xubuntu-main "http://www.xubuntu.org">
<!ENTITY xubuntu-web-help "http://www.xubuntu.org/help">
<!-- DEBIAN RESOURCES --><!ENTITY debian-apt "http://www.debian.org/doc/user-manuals#apt-howto">
<!-- EXTERNAL URL RESOURCES --><!ENTITY linmodem "http://www.linmodems.org/">
<!ENTITY gnome "http://www.gnome.org/">
<!ENTITY linuxorg "http://www.linux.org/">
<!ENTITY ooo "http://www.openoffice.org/">
<!ENTITY kde "http://www.kde.org/">
<!ENTITY lugww "http://lugww.counter.li.org/">
<!ENTITY ubuntu-watch "http://distrowatch.com/ubuntu/">
<!ENTITY realplayer-download "http://www.real.com/linux/">
<!ENTITY nvu-download "http://www.nvu.com/download.html">
<!ENTITY sunjava-download "http://java.sun.com/j2se/1.5.0/download.jsp">
<!ENTITY xorg "http://www.x.org">
<!ENTITY dyndns "http://www.dyndns.org">
<!ENTITY shoutcast "http://www.shoutcast.com/">
<!ENTITY freedomtoaster "http://www.freedomtoaster.org/">
<!ENTITY xfce "http://www.xfce.org/">
<!-- ubuntu-screenshots TODO --><!ENTITY kubuntu-screenshots "http://shots.osdir.com/">
<!ENTITY mozilla "http://www.mozilla.org/">
<!ENTITY mozilla-firefox "http://www.mozilla.org/products/firefox/">
<!ENTITY gnu "http://www.gnu.org/">
<!ENTITY gnu-philosophy "http://www.gnu.org/philosophy/">
<!ENTITY win4lin "http://www.win4lin.com">
<!ENTITY codeweavers "http://www.codeweavers.com">
<!ENTITY kernel "http://www.kernel.org">
<!ENTITY google "http://www.google.com">
<!ENTITY kdelook " http://www.kde-look.org">
<!ENTITY lulu-store "http://www.lulu.com/ubuntu-doc">
<!-- this entity controls the url for addons--><!ENTITY java-download "http://java.sun.com/j2se/1.5.0/download.jsp">
<!ENTITY skype-deb "skype_1.2.0.17-1_i386.deb">
<!ENTITY skype-download "http://www.skype.com/go/getskype-linux-deb">
<!ENTITY scanmodem-gz "scanModem.gz">
<!ENTITY scanmodem-url "http://linmodems.technion.ac.il/packages/scanModem.gz">
<!ENTITY ext2fs-url "http://www.fs-driver.org/index.html">
<!ENTITY mvb-tar "mvb_1.6.tgz">
<!ENTITY mvb-url "http://www.xscd.com/pub/mvb/&mvb-tar;">
<!-- TLDP --><!ENTITY ldp-pre-install-check "http://tldp.org/HOWTO/Pre-Installation-Checklist/">
<!-- LANGUAGES (sorted by two letter code)--><!ENTITY Afar "aa">
<!ENTITY Abkhazian "ab">
<!ENTITY Afrikaans "af">
<!ENTITY Amharic "af">
<!ENTITY Arabic "ar">
<!ENTITY Assamese "as">
<!ENTITY Aymara "ay">
<!ENTITY Azerbaijani "az">
<!ENTITY Bashkir "ba">
<!ENTITY Byelorussian "be">
<!ENTITY Bulgarian "bg">
<!ENTITY Bihari "bh">
<!ENTITY Bislama "bi">
<!ENTITY Bangla "bn">
<!ENTITY Bengali "bn">
<!ENTITY Tibetan "bo">
<!ENTITY Breton "br">
<!ENTITY Catalan "ca">
<!ENTITY Corsican "co">
<!ENTITY Czech "cs">
<!ENTITY Welsh "cy">
<!ENTITY Danish "da">
<!ENTITY German "de">
<!ENTITY Bhutani "dz">
<!ENTITY Greek "el">
<!-- <!ENTITY EnglishAmerican 'en'> --><!ENTITY EnglishAmerican "C">
<!ENTITY Esperanto "eo">
<!ENTITY Spanish "es">
<!ENTITY Estonian "et">
<!ENTITY Basque "eu">
<!ENTITY Persian "fa">
<!ENTITY Finnish "fi">
<!ENTITY Fiji "fj">
<!ENTITY Faeroese "fo">
<!ENTITY French "fr">
<!ENTITY Frisian "fy">
<!ENTITY Irish "ga">
<!ENTITY Gaelic "gd">
<!ENTITY ScotsGaelic "gd">
<!ENTITY Galician "gl">
<!ENTITY Guarani "gn">
<!ENTITY Gujarati "gu">
<!ENTITY Hausa "ha">
<!ENTITY Hindi "hi">
<!ENTITY Croatian "hr">
<!ENTITY Hungarian "hu">
<!ENTITY Armenian "hy">
<!ENTITY Interlingua "ia">
<!ENTITY Interlingue "ie">
<!ENTITY Inupiak "ik">
<!ENTITY Indonesian "in">
<!ENTITY Icelandic "is">
<!ENTITY Italian "it">
<!ENTITY Hebrew "iw">
<!ENTITY Japanese "ja">
<!ENTITY Yiddish "ji">
<!ENTITY Javanese "jw">
<!ENTITY Georgian "ka">
<!ENTITY Kazakh "kk">
<!ENTITY Greenlandic "kl">
<!ENTITY Cambodian "km">
<!ENTITY Kannada "kn">
<!ENTITY Korean "ko">
<!ENTITY Kashmiri "ks">
<!ENTITY Kurdish "ku">
<!ENTITY Kirghiz "ky">
<!ENTITY Latin "la">
<!ENTITY Lingala "ln">
<!ENTITY Laothian "lo">
<!ENTITY Lithuanian "lt">
<!ENTITY Latvian "lv">
<!ENTITY Lettish "lv">
<!ENTITY Malagasy "mg">
<!ENTITY Maori "mi">
<!ENTITY Macedonian "mk">
<!ENTITY Malayalam "ml">
<!ENTITY Mongolian "mn">
<!ENTITY Moldavian "mo">
<!ENTITY Marathi "mr">
<!ENTITY Malay "ms">
<!ENTITY Maltese "mt">
<!ENTITY Burmese "my">
<!ENTITY Nauru "na">
<!ENTITY Nepali "ne">
<!ENTITY Dutch "nl">
<!ENTITY Norwegian "no">
<!ENTITY Occitan "oc">
<!ENTITY Afan "om">
<!ENTITY Oromo "om">
<!ENTITY Oriya "or">
<!ENTITY Punjabi "pa">
<!ENTITY Polish "pl">
<!ENTITY Pushto "ps">
<!ENTITY Pashto "ps">
<!ENTITY Portuguese "pt">
<!ENTITY Quechua "qu">
<!ENTITY Rhaeto-Romance "rm">
<!ENTITY Kirundi "rn">
<!ENTITY Romanian "ro">
<!ENTITY Russian "ru">
<!ENTITY Kinyarwanda "rw">
<!ENTITY Sanskrit "sa">
<!ENTITY Sindhi "sd">
<!ENTITY Sangro "sg">
<!ENTITY Serbo-Croatian "sh">
<!ENTITY Singhalese "si">
<!ENTITY Slovak "sk">
<!ENTITY Slovenian "sl">
<!ENTITY Samoan "sm">
<!ENTITY Shona "sn">
<!ENTITY Somali "so">
<!ENTITY Albanian "sq">
<!ENTITY Serbian "sr">
<!ENTITY Siswati "ss">
<!ENTITY Sesotho "st">
<!ENTITY Sudanese "su">
<!ENTITY Swedish "sv">
<!ENTITY Swahili "sw">
<!ENTITY Tamil "ta">
<!ENTITY Tegulu "te">
<!ENTITY Tajik "tg">
<!ENTITY Thai "th">
<!ENTITY Tigrinya "ti">
<!ENTITY Turkmen "tk">
<!ENTITY Tagalog "tl">
<!ENTITY Setswana "tn">
<!ENTITY Tonga "to">
<!ENTITY Turkish "tr">
<!ENTITY Tsonga "ts">
<!ENTITY Tatar "tt">
<!ENTITY Twi "tw">
<!ENTITY Ukrainian "uk">
<!ENTITY Urdu "ur">
<!ENTITY Uzbek "uz">
<!ENTITY Vietnamese "vi">
<!ENTITY Volapuk "vo">
<!ENTITY Wolof "wo">
<!ENTITY Xhosa "xh">
<!ENTITY Yoruba "yo">
<!ENTITY Chinese "zh">
<!ENTITY Zulu "zu">
<!ENTITY % gnome-menus-C SYSTEM "../../libs/gnome-menus-C.ent">
<!-- MENUS --><!-- Please keep entries alphabetical, it makes them much easier to find & use --><!ENTITY about-me "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>About-me</guimenuitem></menuchoice>">
<!ENTITY accessories "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Accessories</guimenuitem></menuchoice>">
<!ENTITY acro-read "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Graphics</guimenuitem><guimenuitem>Acrobat Reader</guimenuitem></menuchoice>">
<!ENTITY administration "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem></menuchoice>">
<!ENTITY aisleriot "<menuchoice><guimenuitem>Applications</guimenuitem><guimenuitem>Games</guimenuitem><guimenuitem>AisleRiot Solitaire</guimenuitem></menuchoice>">
<!ENTITY amule "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>aMule</guimenuitem></menuchoice>">
<!ENTITY anjuta-ide "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Programming</guimenuitem><guimenuitem>Anjuta IDE</guimenuitem></menuchoice>">
<!ENTITY archive-man "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Accessories</guimenuitem><guimenuitem>Archive Manager</guimenuitem></menuchoice>">
<!ENTITY assistive-technology-preferences "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Assistive Technology Support</guimenuitem></menuchoice>">
<!ENTITY audacity "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Sound &amp; Video</guisubmenu><guimenuitem>Audacity</guimenuitem></menuchoice>">
<!ENTITY azureus "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Azureus</guimenuitem></menuchoice>">
<!ENTITY baobab "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Accessories</guimenuitem><guimenuitem>Disk Usage Analyzer</guimenuitem></menuchoice>">
<!ENTITY bittorrent "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Bittorrent</guimenuitem></menuchoice>">
<!ENTITY blender3d "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Graphics</guimenuitem><guimenuitem>Blender 3d modeller</guimenuitem></menuchoice>">
<!ENTITY bluefish "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Programming</guimenuitem><guimenuitem>Bluefish Editor</guimenuitem></menuchoice>">
<!ENTITY boot "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Boot</guimenuitem></menuchoice>">
<!ENTITY brasero "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem><guimenuitem>Brasero Disc Burning</guimenuitem></menuchoice>">
<!ENTITY bum "<menuchoice><guimenu>System</guimenu><guisubmenu>Administration</guisubmenu><guimenuitem>Boot-up Manager</guimenuitem></menuchoice>">
<!ENTITY bzrgtk "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Programming</guisubmenu><guimenuitem>Olive bazaar Branch Manager</guimenuitem></menuchoice>">
<!ENTITY calculator "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Accessories</guimenuitem><guimenuitem>Calculator</guimenuitem></menuchoice>">
<!ENTITY character-map "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Accessories</guimenuitem><guimenuitem>Character Map</guimenuitem></menuchoice>">
<!ENTITY compizconfig "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>CompizConfig Settings Manager</guimenuitem></menuchoice>">
<!ENTITY computer "<menuchoice><guimenu>Places</guimenu><guimenuitem>Computer</guimenuitem></menuchoice>">
<!ENTITY connecttoserver "<menuchoice><guimenu>Places</guimenu><guimenuitem>Connect to Server...</guimenuitem></menuchoice>">
<!ENTITY cowbell "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Sound &amp; Video</guisubmenu><guimenuitem>Cowbell Music Organizer</guimenuitem>	</menuchoice>">
<!ENTITY chromium "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Games</guisubmenu><guisubmenu>Chromium</guisubmenu></menuchoice>">
<!ENTITY computer-janitor "<menuchoice><guimenu>System</guimenu><guisubmenu>Administration</guisubmenu><guisubmenu>System Janitor</guisubmenu></menuchoice>">
<!ENTITY desktop-background "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Desktop Background</guimenuitem></menuchoice>">
<!ENTITY desktop-effects "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Appearance</guimenuitem><guimenuitem>Visual Effects</guimenuitem></menuchoice>">
<!ENTITY desktop-preferences "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem></menuchoice>">
<!ENTITY devhelp "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Programming</guisubmenu><guimenuitem>Devhelp</guimenuitem></menuchoice>">
<!ENTITY device-manager "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Hardware Information</guimenuitem></menuchoice>">
<!ENTITY dictionary "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Accessories</guimenuitem><guimenuitem>Dictionary</guimenuitem></menuchoice>">
<!ENTITY disks "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Disks</guimenuitem></menuchoice>">
<!ENTITY downloader-x "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Downloader for X</guimenuitem></menuchoice>">
<!ENTITY eclipse-ide "<menuchoice><guimenuitem>Applications</guimenuitem><guimenuitem>Programming</guimenuitem><guimenuitem>Eclipse IDE</guimenuitem></menuchoice>">
<!ENTITY ekiga "<menuchoice><guimenuitem>Applications</guimenuitem><guimenuitem>Internet</guimenuitem><guimenuitem>Ekiga Softphone</guimenuitem></menuchoice>">
<!ENTITY efax-gtk "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Office</guisubmenu><guimenuitem>Efax-gtk</guimenuitem></menuchoice>">
<!ENTITY etherape "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Etherape</guimenuitem></menuchoice>">
<!ENTITY evolution-mail "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Evolution Mail</guimenuitem></menuchoice>">
<!ENTITY file-management "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>File Management</guimenuitem></menuchoice>">
<!ENTITY firefox "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Internet</guisubmenu><guimenuitem>Firefox Web Browser</guimenuitem></menuchoice>">
<!ENTITY firestarter-firewall-tool "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Firestarter</guimenuitem></menuchoice>">
<!ENTITY five-or-more "<menuchoice><guimenuitem>Applications</guimenuitem><guimenuitem>Games</guimenuitem><guimenuitem>Five or More</guimenuitem></menuchoice>">
<!ENTITY font "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Font</guimenuitem></menuchoice>">
<!ENTITY f-spot "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Graphics</guimenuitem><guimenuitem>F-Spot Photo Manager</guimenuitem></menuchoice>">
<!ENTITY frozen-bubble "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Games</guisubmenu><guisubmenu>Frozen Bubble</guisubmenu></menuchoice> to play <application>Frozen Bubble</application>">
<!ENTITY gambas "<menuchoice><guimenuitem>Applications</guimenuitem><guimenuitem>Programming</guimenuitem><guimenuitem>Gambas</guimenuitem></menuchoice>">
<!ENTITY games "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Games</guimenuitem></menuchoice>">
<!ENTITY gdesklets "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Accessories</guisubmenu><guimenuitem>gDesklets</guimenuitem></menuchoice>">
<!ENTITY gftp "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>gFTP</guimenuitem></menuchoice>">
<!ENTITY gimp "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Graphics</guimenuitem><guimenuitem>GIMP Image Editor</guimenuitem></menuchoice>">
<!ENTITY gnome-app-install "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Add/Remove...</guimenuitem></menuchoice>">
<!ENTITY gnome-config-editor "<screen><command>gconf-editor</command></screen>">
<!ENTITY gnome-sound-recorder "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem><guimenuitem>Sound Recorder</guimenuitem></menuchoice>">
<!ENTITY gparted "<menuchoice><guimenu>System</guimenu><guisubmenu>Administration </guisubmenu><guimenuitem>Gnome Partition Editor</guimenuitem></menuchoice>">
<!ENTITY graphics "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Graphics</guimenuitem></menuchoice>">
<!ENTITY gthumb "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Graphics</guimenuitem><guimenuitem>gThumb Image Viewer</guimenuitem></menuchoice>">
<!ENTITY gtkpod "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Sound &amp; Video</guisubmenu><guimenuitem>gtkpod</guimenuitem></menuchoice>">
<!ENTITY gnucash "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Office</guimenuitem><guimenuitem>GnuCash Finance Management</guimenuitem></menuchoice>">
<!ENTITY gxine "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem><guimenuitem>gxine</guimenuitem></menuchoice>">
<!ENTITY home-folder "<menuchoice><guimenu>Places</guimenu><guimenuitem>Home Folder</guimenuitem></menuchoice>">
<!ENTITY homebank "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Office</guimenuitem><guimenuitem>HomeBank</guimenuitem></menuchoice>">
<!ENTITY hubackup "<menuchoice><guimenu>System</guimenu><guisubmenu>Administration</guisubmenu><guimenuitem>Home User Backup</guimenuitem></menuchoice>">
<!ENTITY hurestore "<menuchoice><guimenu>System</guimenu><guisubmenu>Administration</guisubmenu><guimenuitem>Home User Restore</guimenuitem></menuchoice>">
<!ENTITY inkscape "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Graphics</guimenuitem><guimenuitem>Inkscape SVG Vector Illustrator</guimenuitem></menuchoice>">
<!ENTITY internet "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem></menuchoice>">
<!ENTITY kdevelop "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Programming</guisubmenu><guimenuitem>KDevelop</guimenuitem></menuchoice>">
<!ENTITY keyboard "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Keyboard</guimenuitem></menuchoice>">
<!ENTITY keyboard-shortcuts "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Keyboard Shortcuts</guimenuitem></menuchoice>">
<!ENTITY language-support "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Language Support</guimenuitem></menuchoice>">
<!ENTITY liferea "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Liferea Feed Reader</guimenuitem></menuchoice>">
<!ENTITY limewire "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>LimeWire</guimenuitem></menuchoice>">
<!ENTITY lockscreen "<menuchoice><guimenu>System</guimenu><guimenuitem>Lock Screen</guimenuitem></menuchoice>">
<!ENTITY login-screen-setup "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Login Window</guimenuitem></menuchoice>">
<!ENTITY mahjongg "<menuchoice><guimenuitem>Applications</guimenuitem><guimenuitem>Games</guimenuitem><guimenuitem>Mahjongg</guimenuitem></menuchoice>">
<!ENTITY menu-editor "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Accessories</guisubmenu><guimenuitem>Applications Menu Editor</guimenuitem></menuchoice>">
<!ENTITY menus-and-toolbars "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Menus &amp; Toolbars</guimenuitem></menuchoice>">
<!ENTITY monodevelop "<menuchoice><guimenuitem>Applications</guimenuitem><guimenuitem>Programming</guimenuitem><guimenuitem>MonoDevelop</guimenuitem></menuchoice>">
<!ENTITY monodoc "<menuchoice><guimenuitem>Applications</guimenuitem><guimenuitem>Programming</guimenuitem><guimenuitem>MonoDoc</guimenuitem></menuchoice>">
<!ENTITY mouse "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Mouse</guimenuitem></menuchoice>">
<!ENTITY mtink "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Accessories</guimenuitem><guimenuitem>mtink</guimenuitem></menuchoice>">
<!ENTITY music "<menuchoice><guimenu>Places</guimenu><guimenuitem>Music</guimenuitem></menuchoice>">
<!ENTITY multimedia-systems-selector "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Multimedia Systems Selector</guimenuitem></menuchoice>">
<!ENTITY ndisgtk "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Windows Wireless Drivers</guimenuitem></menuchoice>">
<!ENTITY network-proxy "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Network Proxy</guimenuitem></menuchoice>">
<!ENTITY network-tools "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Network Tools</guimenuitem></menuchoice>">
<!ENTITY networking "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Network</guimenuitem></menuchoice>">
<!ENTITY network-servers "<menuchoice><guimenu>Places</guimenu><guimenuitem>Network</guimenuitem></menuchoice>">
<!ENTITY neverball "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Games</guisubmenu><guisubmenu>Neverball</guisubmenu></menuchoice>">
<!ENTITY neverputt "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Games</guisubmenu><guisubmenu>Neverputt</guisubmenu></menuchoice>">
<!ENTITY nexuiz "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Games</guisubmenu><guisubmenu>Nexuiz</guisubmenu></menuchoice>">
<!ENTITY open-office "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Office</guimenuitem></menuchoice>">
<!ENTITY openoffice-base "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Office</guimenuitem><guimenuitem>OpenOffice.org Database</guimenuitem></menuchoice>">
<!ENTITY openoffice-draw "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Graphics</guimenuitem><guimenuitem>OpenOffice.org Draw</guimenuitem></menuchoice>">
<!ENTITY openoffice-presentation "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Office</guimenuitem><guimenuitem>OpenOffice.org Presentation</guimenuitem></menuchoice>">
<!ENTITY openoffice-spreadsheet "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Office</guimenuitem><guimenuitem>OpenOffice.org Spreadsheet</guimenuitem></menuchoice>">
<!ENTITY openoffice-writer "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Office</guimenuitem><guimenuitem>OpenOffice.org Word Processor</guimenuitem></menuchoice>">
<!ENTITY palmos-devices "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>PalmOS Devices</guimenuitem></menuchoice>">
<!ENTITY pan "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Pan Newsreader</guimenuitem></menuchoice>">
<!ENTITY photoprint "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Graphics</guimenuitem><guimenuitem>PhotoPrint</guimenuitem></menuchoice>">
<!ENTITY pidgin "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Pidgin Internet Messenger</guimenuitem></menuchoice>">
<!ENTITY power-management "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Power Management</guimenuitem></menuchoice>">
<!ENTITY ppracer "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Games</guisubmenu><guisubmenu>Planet Penguin Racer</guisubmenu></menuchoice>">
<!ENTITY preferences "<menuchoice><guimenu>System</guimenu><guisubmenu>Preferences</guisubmenu></menuchoice>">
<!ENTITY preferred-applications "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Preferred Applications</guimenuitem></menuchoice>">
<!ENTITY print "<menuchoice><guimenu>File</guimenu><guimenuitem>Print</guimenuitem></menuchoice>">
<!ENTITY printing "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Printing</guimenuitem></menuchoice>">
<!ENTITY qtparted "<menuchoice><guimenu>Applications</guimenu><guimenuitem>System Tools</guimenuitem><guimenuitem>QTParted</guimenuitem></menuchoice>">
<!ENTITY remote-desktop "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Remote Desktop</guimenuitem></menuchoice>">
<!ENTITY removable-drives-and-media "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Removable Drives and Media</guimenuitem></menuchoice>">
<!ENTITY realplayer "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem><guimenuitem>RealPlayer 11</guimenuitem></menuchoice>">
<!ENTITY restricted-manager "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Hardware Drivers</guimenuitem></menuchoice>">
<!ENTITY rhythmbox "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem><guimenuitem>Rhythmbox Music Player</guimenuitem></menuchoice>">
<!ENTITY route-planner "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>aMule</guimenuitem></menuchoice>">
<!ENTITY scorched3d "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Games</guisubmenu><guimenuitem>Scorched 3D</guimenuitem></menuchoice>">
<!ENTITY screen-resolution "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Screen Resolution</guimenuitem></menuchoice>">
<!ENTITY screensaver "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Screensaver</guimenuitem></menuchoice>">
<!ENTITY scribus "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Office</guimenuitem><guimenuitem>Scribus</guimenuitem></menuchoice>">
<!ENTITY serpentine "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem><guimenuitem>Serpentine Audio CD Creator</guimenuitem></menuchoice>">
<!ENTITY services "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Services</guimenuitem></menuchoice>">
<!ENTITY sessions "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Sessions</guimenuitem></menuchoice>">
<!ENTITY shared-folders "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Shared Folders</guimenuitem></menuchoice>">
<!ENTITY skype "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Skype</guimenuitem></menuchoice>">
<!ENTITY software-properties "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Software Sources</guimenuitem></menuchoice>">
<!ENTITY software-sources "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Software Sources</guimenuitem></menuchoice>">
<!ENTITY sound "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Sound</guimenuitem></menuchoice>">
<!ENTITY soundandvideo "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem></menuchoice>">
<!ENTITY soundjuicer "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem><guimenuitem>Audio CD Extractor</guimenuitem></menuchoice>">
<!ENTITY supertux "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Games</guisubmenu><guisubmenu>SuperTux</guisubmenu></menuchoice>">
<!ENTITY shutdown "<menuchoice><guimenu>System</guimenu><guimenuitem>Shut Down...</guimenuitem></menuchoice>">
<!ENTITY synaptic "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Synaptic Package Manager</guimenuitem></menuchoice>">
<!ENTITY system-monitor "<menuchoice><guimenu>System</guimenu><guisubmenu>Administration</guisubmenu><guimenuitem>System Monitor</guimenuitem></menuchoice>">
<!ENTITY systemtools "<menuchoice><guimenu>Applications</guimenu><guimenuitem>System Tools</guimenuitem></menuchoice>">
<!ENTITY terminal "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Accessories</guimenuitem><guimenuitem>Terminal</guimenuitem></menuchoice>">
<!ENTITY text-editor "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Accessories</guimenuitem><guimenuitem>Text Editor</guimenuitem></menuchoice>">
<!ENTITY theme "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Theme</guimenuitem></menuchoice>">
<!ENTITY thunderbird "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Mozilla Thunderbird Mail/News</guimenuitem></menuchoice>">
<!ENTITY time-date "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Time and Date</guimenuitem></menuchoice>">
<!ENTITY totem "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem><guimenuitem>Movie Player</guimenuitem></menuchoice>">
<!ENTITY touchpad "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Touchpad</guimenuitem></menuchoice>">
<!ENTITY tremulous "<menuchoice><guimenu>Applications</guimenu><guisubmenu>Games</guisubmenu><guisubmenu>Tremulous</guisubmenu></menuchoice>">
<!ENTITY ubuntu-update-manager "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Ubuntu Update Manager</guimenuitem></menuchoice>">
<!ENTITY update-manager "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Update Manager</guimenuitem></menuchoice>">
<!ENTITY users "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Users and Groups</guimenuitem></menuchoice>">
<!ENTITY users-groups "<menuchoice><guimenu>System</guimenu><guimenuitem>Administration</guimenuitem><guimenuitem>Users and Groups</guimenuitem></menuchoice>">
<!ENTITY windows "<menuchoice><guimenu>System</guimenu><guimenuitem>Preferences</guimenuitem><guimenuitem>Windows</guimenuitem></menuchoice>">
<!ENTITY wireshark "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Wireshark</guimenuitem></menuchoice>">
<!ENTITY xchat-gnome "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Internet</guimenuitem><guimenuitem>Xchat-GNOME IRC Chat</guimenuitem></menuchoice>">
<!ENTITY xine "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem><guimenuitem>xine</guimenuitem></menuchoice>">
<!ENTITY xmms "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Sound &amp; Video</guimenuitem><guimenuitem>XMMS</guimenuitem></menuchoice>">
<!ENTITY xsane "<menuchoice><guimenu>Applications</guimenu><guimenuitem>Graphics</guimenuitem><guimenuitem>XSane Image Scanner</guimenuitem></menuchoice>">
<!ENTITY % xinclude SYSTEM "../../libs/xinclude.mod">
<!ELEMENT xi:include (xi:fallback)?>
<!ATTLIST xi:include xmlns:xi CDATA #FIXED "http://www.w3.org/2001/XInclude">
<!ATTLIST xi:include href CDATA #REQUIRED>
<!ATTLIST xi:include parse (xml | text) "xml">
<!ATTLIST xi:include xpointer CDATA #IMPLIED>
<!ATTLIST xi:include encoding CDATA #IMPLIED>
<!ATTLIST xi:include accept CDATA #IMPLIED>
<!ATTLIST xi:include accept-charset CDATA #IMPLIED>
<!ATTLIST xi:include accept-language CDATA #IMPLIED>
<!ELEMENT xi:fallback ANY>
<!ATTLIST xi:fallback xmlns:xi CDATA #FIXED "http://www.w3.org/2001/XInclude">
<!ENTITY % local.preface.class "| xi:include">
<!ENTITY % local.part.class "| xi:include">
<!ENTITY % local.chapter.class "| xi:include">
<!ENTITY % local.divcomponent.mix "| xi:include">
<!ENTITY % local.para.char.mix "| xi:include">
<!ENTITY % local.info.class "| xi:include">
<!ENTITY % local.common.attrib "xmlns:xi            CDATA       #FIXED       'http://www.w3.org/2001/XInclude'">
<!ENTITY language "&EnglishAmerican;">
]>
<chapter id="network-authentication" status="review">
	<title>Netzwerk-Legitimation</title>

         <para>Dieser Abschnitt erläutert verschiedene Protokolle zur Netzwerk-Legitimation.</para>
	<sect1 id="openldap-server" status="review">
		<title>OpenLDAP-Server</title>
         <para>LDAP ist ein Akronym für »Lightweight Directory Access Protocol« (englischsprachig für »leicht gewichtiges Zugriffsprotokoll für Verzeichnisdienste«); es ist eine vereinfachte Version des X.500-Protokolls. Das Verzeichnis, dessen Einrichtung in diesem Abschnitt beschrieben wird, dient der Legitimation. Nichtsdestotrotz kann LDAP auf zahlreiche Arten genutzt werden: zur Legitimation, freigegebene Verzeichnisse (für Mail-Clients), Adressbücher etc.</para>

         <para>Kurz gefasst kann man sagen, dass LDAP alle Informationen in einer Baumstruktur speichert. Mit <application>OpenLDAP</application> haben Sie die Freiheit, den Umfang des Verzeichnisbaumes zur Verwaltung der Informationen selbst festzulegen. Wir werden mit einer grundlegenden Baumstruktur beginnen, die unterhalb der Wurzel zwei Knoten umfasst:</para>

	 <itemizedlist>
           <listitem>
               <para>der Knoten »Personen«, in dem Ihre Benutzer gespeichert werden</para>
           </listitem>
           <listitem>
               <para>der Knoten »Gruppen«, in dem Ihre Gruppen gespeichert werden</para>
           </listitem>
         </itemizedlist>

	 <para>Bevor Sie beginnen, sollten Sie festlegen, welches die Wurzel Ihres LDAP-Verzeichnisses sein wird. Per Vorgabe wird Ihr Baum anhand Ihres vollständig qualifizierten Domänennamens (FQDN). Wenn Ihre Domäne etwa beispiel.de lautet (dieses Beispiel werden wir im Folgenden verwenden), ist Ihr Wurzelknoten dc=beispiel,dc=de.</para>

	<sect2 id="openldap-server-installation" status="review">
		<title>Installation</title>

   	<para>Installieren Sie zuerst den <application>OpenLDAP</application>-Server-Dienst <application>slapd</application> und das Soiftware-Paket <application>ldap-utils</application>, das Verwaltungswerkzeuge für LDAP beinhaltet:</para>
<screen>
<command>sudo apt-get install slapd ldap-utils</command>
</screen>
	
	<para>Der Installationsprozess wird Sie zu einer Angabe des Systemverwaltungspasswortes für das LDAP-Verzeichnis und eine Bestätigung auffordern.</para>

	<para>Per Vorgabe wird das Verzeichnis-Suffix dem Domänennamen des Servers entsprechen. Wenn also beispielsweise der vollqualifizierte Domainenname Ihrer Maschine ldap.beispiel.de lautet, wird das vorgegebene Suffix <emphasis>dc=beispiel,dc=de</emphasis>. Wenn Sie ein anderes Suffix verwenden möchten, können Sie mit <application>dpkg-reconfigure</application> den Verzeichnisdienst neu einrichten. Geben Sie das Folgende in einer Befehlszeile ein:</para>

<screen>
<command>sudo dpkg-reconfigure slapd</command>
</screen>

	<para>Sie werden dann durch einen menübasierten Konfigurationsdialog geführt, der es erlaubt, verschiedene <application>slapd</application>-Optionen zu konfigurieren.</para>
	
	</sect2>
        <sect2 id="openldap-configuration" status="review">
          <title>Konfiguration</title>

          <para><application>OpenLDAP</application> verwendet eine eigene Datenbank, welche den <emphasis>cn=config</emphasis>-»Directory Information Tree (DIT)« (engl. für »Verzeichnisinformationsbaum«) beinhaltet. Der <emphasis>cn=config</emphasis>-DIT wird verwendet, um den <application>slapd</application>-Dienst dynamisch zu konfigurieren un erlaubt das Verändern von Schemadefinitionen, Indizes, ACLs, usw., ohne dass der Dienst gestoppt werden muss.</para>

          <para>Der <emphasis>cn=config</emphasis>-Baum kann mit den Werkzeugen im Software-Paket <application>ldap-utils</application> geändert werden. Zum Beispiel:</para>

          <itemizedlist>
            <listitem>

              <para>Verwenden Sie <application>ldapsearch</application>, um den Baum zu betrachten. Hierbei muss das Systemverwaltungspasswort eingegeben werden, dass während der Installation oder dem Neukonfigurieren festgelegt wurde:</para>

<screen>
<command>ldapsearch -xLLL -b cn=config -D cn=admin,cn=config -W olcDatabase={1}hdb</command>
</screen>

<screen>
<computeroutput>Enter LDAP Password: 
dn: olcDatabase={1}hdb,cn=config
objectClass: olcDatabaseConfig
objectClass: olcHdbConfig
olcDatabase: {1}hdb
olcDbDirectory: /var/lib/ldap
olcSuffix: dc=beispiel,dc=de
olcAccess: {0}to attrs=userPassword,shadowLastChange by dn="cn=admin,dc=exampl
 e,dc=com" write by anonymous auth by self write by * none
olcAccess: {1}to dn.base="" by * read
olcAccess: {2}to * by dn="cn=admin,dc=example,dc=com" write by * read
olcLastMod: TRUE
olcDbCheckpoint: 512 30
olcDbConfig: {0}set_cachesize 0 2097152 0
olcDbConfig: {1}set_lk_max_objects 1500
olcDbConfig: {2}set_lk_max_locks 1500
olcDbConfig: {3}set_lk_max_lockers 1500
olcDbIndex: objectClass eq
</computeroutput>
</screen>

              <para>Die oben angegebene Ausgabe beinhaltet die aktuellen Konfigurationsoptionen für die <emphasis>hdb</emphasis>-Datenbank des Backends, die in diesem Fall das <emphasis>dc=beispiel,dc=de</emphasis>-Suffix beinhaltet.</para>

            </listitem>
            <listitem>

              <para>Ändert man die Suche durch Angabe eines <emphasis role="italic">Filters</emphasis>, so werden in diesem Fall nur die indizierten Attribute ausgegeben:</para>

<screen>
<command>ldapsearch -xLLL -b cn=config -D cn=admin,cn=config -W olcDatabase={1}hdb olcDbIndex</command>
</screen>

<screen>
<computeroutput>Enter LDAP Password: 
dn: olcDatabase={1}hdb,cn=config
olcDbIndex: objectClass eq
</computeroutput>
</screen>

            </listitem>
            <listitem>

              <para>Als Beispiel für das Verändern des <emphasis>cn=config</emphasis>-Baums können Sie mit <application>ldapmodify</application> ein weiteres Attribut zur Indexliste hinzufügen:</para>

<screen>
<command>ldapmodify -x -D cn=admin,cn=config -W</command>
</screen>

<screen>
<computeroutput>Enter LDAP Password:<userinput>
dn: olcDatabase={1}hdb,cn=config
add: olcDbIndex
olcDbIndex: entryUUID eq</userinput>

modifying entry "olcDatabase={1}hdb,cn=config"
</computeroutput>
</screen>

              <para>Wenn die Änderung abgeschlossen ist, drücken Sie <emphasis>Ctrl+D</emphasis>, um das Werkzeug zu verlassen.</para>

            </listitem>
            <listitem>

              <para><application>ldapmodify</application> kann die Änderungen auch aus einer Datei lesen. Kopieren Sie das Folgende in die Zwischenablage und fügen Sie es in eine Datei mit dem Namen <filename>uid_index.ldif</filename> ein:</para>

<programlisting>
dn: olcDatabase={1}hdb,cn=config
add: olcDbIndex
olcDbIndex: uid eq,pres,sub
</programlisting>

              <para>Dann führen Sie <application>ldapmodify</application> aus:</para> 

<screen>
<command>ldapmodify -x -D cn=admin,cn=config -W -f uid_index.ldif</command>
</screen>

<screen>
<computeroutput>Enter LDAP Password: 
modifying entry "olcDatabase={1}hdb,cn=config"
</computeroutput>
</screen>

              <para>Die dateibasierte Methode ist bei größeren Änderungen sehr nützlich.</para>

            </listitem>
            <listitem>

              <para>Das Hinzufügen weiterer <emphasis>Schemata</emphasis> zu <application>slapd</application> erfordert, dass das Schema ins LDIF-Format umgewandelt wird. Glücklicherweise kann das <application>slapd</application>-Programm genutzt werden, um diese Umwandlung zu automatisieren. Das folgende Beispiel wird das Schema <emphasis>misc.schema</emphasis> hinzufügen:</para>

              <procedure>
                <step>
                  <para>Erstellen Sie zuerst die Umwandlungsdatei <filename>schema_convert.conf</filename> mit den folgenden Zeilen:</para>

<programlisting>
include /etc/ldap/schema/core.schema
include /etc/ldap/schema/collective.schema
include /etc/ldap/schema/corba.schema
include /etc/ldap/schema/cosine.schema
include /etc/ldap/schema/duaconf.schema
include /etc/ldap/schema/dyngroup.schema
include /etc/ldap/schema/inetorgperson.schema
include /etc/ldap/schema/java.schema
include /etc/ldap/schema/misc.schema
include /etc/ldap/schema/nis.schema
include /etc/ldap/schema/openldap.schema
include /etc/ldap/schema/ppolicy.schema
</programlisting>

                </step>
                <step>

                  <para>Erzeugen Sie als Nächstes einen temporären Ordner, der dann die Ausgabe speichert:</para> 

<screen>
<command>mkdir /tmp/ldif_output</command>
</screen>

                </step>
                <step>

                  <para>Verwenden Sie nun <application>slaptest</application>, um die Schemadateien in LDIF umzuwandeln:</para>

<screen>
<command>slaptest -f schema_convert.conf -F /tmp/ldif_output</command>
</screen>

                  <para>Passen Sie den Namen der Konfigurationsdatei oder des temporären Ordners an, wenn diese bei Ihnen anders heißen sollen. Weiterhin kann es sinnvoll sein, den Ordner <filename>ldif_output</filename> für den Fall aufzubewahren, dass Sie in der Zukunft weitere Schemata hinzufügen möchten.</para>

                </step>
                <step>

                  <para>Bearbeiten Sie die Datei <filename>/tmp/ldif_output/cn=config/cn=schema/cn={8}misc.ldif</filename> und ändern Sie folgende Attribute:</para> 

<programlisting>
dn: cn=misc,cn=schema,cn=config
...
cn: misc
</programlisting>

                  <para>Und entfernen Sie folgende Zeilen am Ende der Datei:</para> 

<programlisting>
structuralObjectClass: olcSchemaConfig
entryUUID: 10dae0ea-0760-102d-80d3-f9366b7f7757
creatorsName: cn=config
createTimestamp: 20080826021140Z
entryCSN: 20080826021140.791425Z#000000#000#000000
modifiersName: cn=config
modifyTimestamp: 20080826021140Z
</programlisting>

                  <note>
                    <para>Die Attributwerte können variieren; stellen Sie einfach sicher, dass die Attribute entfernt werden.</para>
                  </note>

                </step>
                <step>

                  <para>Verwenden Sie abschließend das Werkzeug <application>ldapadd</application>, um das neue Schema zum Verzeichnis hinzuzufügen:</para>

<screen>
<command>ldapadd -x -D cn=admin,cn=config -W -f /tmp/ldif_output/cn\=config/cn\=schema/cn\=\{8\}misc.ldif</command>
</screen>

                </step>
              </procedure>

              <para>Es sollte nun einen Eintrag <emphasis>dn: cn={4}misc,cn=schema,cn=config</emphasis> im cn=Konfigurationsbaum geben.</para> 

            </listitem>
          </itemizedlist>

        </sect2>
	<sect2 id="openldap-server-populate" status="review">
		<title>LDAP bestücken</title>

	<para>Das Verzeichnis ist während der Installation und der Neukonfiguration angelegt worden und nun ist es Zeit, es zu befüllen. Es wird mit einem »klassischen« Schema befüllt, dass mit Adressbuch-Anwendungen und Unix-Posix-Benutzerkonten kompatibel ist. Posix-Benutzerkonten erlauben eine Legitimation für verschiedene Anwendungen wie Web-Anwendungen, E-Mail-Anwendungen, usw.</para>
	
	<note>
	  <para>Damit sich externe Anwendungen über ein LDAP legitimieren können, muss jede davon speziell dafür konfiguriert werden. In der Dokumentation der jeweiligen Anwendung werden Sie Details dazu finden.</para>
	</note>

	<para>LDAP-Verzeichnisse können über LDIF-Dateien (LDAP Directory Interchange Format, engl. für LDAP-Verzeichnis-Austauschformat) befüllt werden. Kopieren Sie folgende LDIF-Datei mit dem Namen <filename>beispiel.de.ldif</filename> irgendwo auf Ihr System:</para>

<programlisting>
dn: ou=personen,dc=beispiel,dc=de
objectClass: organizationalUnit
ou: personen

dn: ou=gruppen,dc=beispiel,dc=de
objectClass: organizationalUnit
ou: gruppen

dn: uid=max,ou=personen,dc=beispiel,dc=de
objectClass: inetOrgPerson
objectClass: posixAccount
objectClass: shadowAccount
uid: max
sn: Mustermann
givenName: Max
cn: Max Mustermann
displayName: Max Mustermann
uidNumber: 1000
gidNumber: 10000
userPassword: password
gecos: Max Mustermann
oginShell: /bin/bash
homeDirectory: /home/max
shadowExpire: -1
shadowFlag: 0
shadowWarning: 7
shadowMin: 8
shadowMax: 999999
shadowLastChange: 10877
mail: max.mustermann@beispiel.de
postalCode: 31000
l: Toulouse
o: Beispiel
mobile: +33 (0)6 xx xx xx xx
homePhone: +33 (0)5 xx xx xx xx
title: System Administrator
postalAddress: 
initials: MM

dn: cn=beispiel,ou=gruppen,dc=beispiel,dc=de
objectClass: posixGroup
cn: beispiel
gidNumber: 10000
</programlisting>

	<para>In diesem Beispiel wird die Verzeichnisstruktur, ein Benutzer und eine Gruppe eingerichtet. In anderen Beispiel werden Sie möglicherweise sehen, dass <emphasis>objectClass: top</emphasis> zu jedem Eintrag hinzugefügt wird. Dieses ist das vorgegebene Verhalten und so müssen Sie dieses nicht explizit angeben.</para>

	<para>Um Einträge in ein LDAP-Verzeichnis hinzuzufügen, können Sie das Werkzeug <application>ldapadd</application> verwenden:</para>


<screen>
<command>ldapadd -x -D cn=admin,dc=beispiel,dc=de -W -f beispiel.de.ldif</command>
</screen>

	<para>Wir können prüfen, ob der Inhalt korrekt hinzugefügt worden ist, indem wir die Werkzeuge aus dem Software-Paket <application>ldap-utils</application> verwenden. Um eine Suche im LDAP-Verzeichnis auszuführen:</para>

<screen>
<command>ldapsearch -xLLL -b "dc=beispiel,dc=de" uid=max sn givenName cn</command>
<computeroutput>
dn: uid=max,ou=personen,dc=beispiel,dc=de
cn: Max Mustermann
sn: Mustermann
givenName: Max
</computeroutput>
</screen>

	<para>Zur kurzen Erläuterung:</para>

	<itemizedlist>
	    <listitem>
                <para><emphasis>-x:</emphasis> verhindert, dass die SASL-Authentifizierungsmethode verwendet wird, was ansonsten standardmäßig erfolgt.</para>
            </listitem>
            <listitem>
                <para><emphasis>-LLL:</emphasis> unterdrückt die Ausgabe von LDIF-Schemainformationen.</para>
            </listitem>
        </itemizedlist>
	
	</sect2>

	<sect2 id="openldap-server-replication" status="review">
		<title>LDAP-Replikation</title>

	<para>LDAP wird schnell zu einem sehr entscheidenden Dienst für ein Netzwerk. Verschiedene Systeme werden von LDAP abhängen, da sie dieses zur Authentifizierung, Legitimation, Konfiguration usw. benötigen. Es ist daher eine gute Idee, über Replikation ein redundantes System bereitzustellen.</para>
	
	<para>Replication wird über die <emphasis>Syncrepl</emphasis>-Engine erreicht. Syncrepl erlaubt es, ein Verzeichnis entweder über ein <emphasis>Push</emphasis>- oder <emphasis>Pull</emphasis>-basiertes System zu synchronisieren. Bei einer Push-basierten Konfiguration schiebt (engl. push) der <quote>primäre</quote> Server die Verzeichnisse auf einen <quote>sekundären</quote> Server, während bei eine Push-basierten Konfiguration es erlaubt, dass sich replizierte Server in einem zeitbasierten Intervall synchronisieren.</para>

	<para>Im Folgenden wird das Beispiel einer <emphasis>Multi-Master</emphasis>-Konfiguration. In dieser Konfiguration wird jeder OpenLDAP-Server sowohl für <emphasis>Push</emphasis>- als auch für <emphasis>Pull</emphasis>-Konfiguration konfiguriert.</para>

        <procedure>
          <step>
  
            <para>Konfigurieren Sie zuerst den Server für die Synchronisation der <emphasis>cn=config</emphasis>-Datenbank. Kopieren Sie das Folgende in eine Datei mit dem Namen <filename>syncrepl_cn-config.ldif</filename>:
Current German:</para>

<programlisting>
dn: cn=module{0},cn=config
changetype: modify
add: olcModuleLoad
olcModuleLoad: syncprov

dn: cn=config
changetype: modify
replace: olcServerID
olcServerID: 1 ldap://ldap01.beispiel.de
olcServerID: 2 ldap://ldap02.beispiel.de

dn: olcOverlay=syncprov,olcDatabase={0}config,cn=config
changetype: add
objectClass: olcOverlayConfig
objectClass: olcSyncProvConfig
olcOverlay: syncprov

dn: olcDatabase={0}config,cn=config
changetype: modify
add: olcSyncRepl
olcSyncRepl: rid=001 provider=ldap://ldap01.beispiel.de binddn="cn=admin,cn=config" bindmethod=simple
  credentials=secret searchbase="cn=config" type=refreshAndPersist
  retry="5 5 300 5" timeout=1
olcSyncRepl: rid=002 provider=ldap://ldap02.beispiel.de binddn="cn=admin,cn=config" bindmethod=simple
  credentials=secret searchbase="cn=config" type=refreshAndPersist
  retry="5 5 300 5" timeout=1
-
add: olcMirrorMode
olcMirrorMode: TRUE
</programlisting>

          </step>
          <step>

            <para>Bearbeiten Sie die Datei und ändern Sie:</para>

            <itemizedlist>
              <listitem>
                <para><emphasis>ldap://ldap01.beispiel.de</emphasis> and <emphasis>ldap://ldap02.beispiel.de</emphasis> in die Rechnernamen Ihrer LDAP-Server.</para>
                <note>
                  <para>Sie können mehr als zwei LDAP-Server einsetzen, sodass eine Änderung, die an einem vorgenommen wird, mit allen synchronisiert wird. Stellen Sie sicher <emphasis>olcServerID</emphasis> für jeden Server zu erhöhen und die <emphasis>rid</emphasis> für jeden <emphasis>olcSyncRepl</emphasis>-Eintrag zu erhöhen.</para>
                </note>
              </listitem>
              <listitem>
                <para>Und passen Sie <emphasis>credentials=secret</emphasis> so an, dass es Ihrem Administrationspasswort entspricht.</para>
              </listitem>
            </itemizedlist>

          </step>
          <step>


            <para>Als nächstes  fügen Sie die LDIF-Datei mit dem Werkzeug <application>ldapmodify</application> hinzu:</para>

<screen>
<command>ldapmodify -x -D cn=admin,cn=config -W -f syncrepl_cn-config.ldif</command>
</screen>

          </step>
          <step>

            <para>Kopieren Sie die Datei <filename>syncrepl_cn-config.ldif</filename> auf den nächsten LDAP-Server und wiederholen Sie den Befehl <application>ldapmodify</application> wie oben beschrieben.</para>

          </step>
          <step>

            <para>Da neuje Module hinzugefügt worden sind, miss der <application>slapd</application>-Dienst auf allen Servern neu gestartet werden:</para>

<screen>
<command>sudo /etc/init.d/slapd restart</command>
</screen>

          </step>
          <step>

            <para>Nun, da die Konfigurationsdatenbank zur Synchronisation zwischen Serven konfiguriert ist, muss auch die <emphasis>Backend</emphasis>Datenbank synchronisiert werden. Kopieren Sie das folgende und fügen Sie es in eine Datei mit dem Namen <filename>syncrepl_backend.ldif</filename> ein:</para>

<programlisting>
dn: olcDatabase={1}hdb,cn=config
changetype: modify
add: olcRootDN
olcRootDN: cn=admin,dc=beispiel,dc=de
-
add: olcSyncRepl
olcSyncRepl: rid=003 provider=ldap://ldap01.beispiel.de binddn="cn=admin,dc=beispiel,dc=de" 
 bindmethod=simple credentials=secret searchbase="dc=beispiel,dc=de" type=refreshOnly 
 interval=00:00:00:10 retry="5 5 300 5" timeout=1
olcSyncRepl: rid=004 provider=ldap://ldap02.beispiel.de binddn="cn=admin,dc=beispiel,dc=de" 
 bindmethod=simple credentials=secret searchbase="dc=beispiel,dc=de" type=refreshOnly 
 interval=00:00:00:10 retry="5 5 300 5" timeout=1
-
add: olcMirrorMode
olcMirrorMode: TRUE

dn: olcOverlay=syncprov,olcDatabase={1}hdb,cn=config
changetype: add
objectClass: olcOverlayConfig
objectClass: olcSyncProvConfig
olcOverlay: syncprov
</programlisting>

          </step>
          <step>

            <para>Wie die vorangegangene Datei bearbeiten Sie auch diese und ändern folgendes:</para>

            <itemizedlist>
              <listitem>
                <para>Ändern Sie <emphasis>searchbase="dc=beispiel,dc=de"</emphasis> in die Searchbase Ihres Verzeichnisses.</para>
              </listitem>              
              <listitem>
                <para>Wenn Sie einen anderen Administrationsbenutzer verwenden, ändern Sie <emphasis>binddn="cn=admin,dc=beispiel,dc=de"</emphasis>.</para>
              </listitem>
              <listitem>
                <para>Ersetzen Sie auch <emphasis>credentials=secret</emphasis> durch Ihr Administratorpasswort.</para>
              </listitem>
            </itemizedlist>

          </step>
          <step>

            <para>Fügen Sie die LDIF-Datei hinzu:</para>

<screen>
<command>ldapmodify -x -D cn=admin,cn=config -W -f syncrepl_backend.ldif</command>
</screen>

            <para>Weil die Konfiguration des Servers bereits synchronisiert wird, besteht keine Notwendigkeit, die LDIF-Datei auf andere Server zu kopieren.</para>

          </step>
        </procedure>

        <para>Die Konfiguration und Backend-Datenbanken sollten nun synchron mit den anderen Servern sein. Sie können weitere Sever mit dem Werkzeug <application>ldapmodify</application> hinzufügen, wenn dafür Bedarf entsteht. Weitere Details finden Sie unter <xref linkend="openldap-configuration"/>.</para>

        <note>
  	  <para>Der <application>slapd</application>-Dienst wird Protokolldaten standardmäßig an <filename>/var/log/syslog</filename> senden. Wenn also <emphasis>nicht</emphasis> alles richtig funktioniert, prüfen Sie dort, ob es Fehler oder andere Informationen zur Problembehandlung gibt. Stellen Sie auch sicher, dass jedem Server dessen vollständig qualifizierter Domänenname (FQDN) bekannt ist. Dieser ist in <filename>/etc/hosts</filename> konfigurriert und enthält eine ähnliche Zeile wie: <programlisting>127.0.0.1	ldap01.beispiel.de ldap01</programlisting>.</para>
        </note>
		
	</sect2>

	<sect2 id="openldap-server-acl" status="review">
              <title>ACL einrichten</title>

	<para>Legitimationen erfordern Zugriff auf das Passwortfeld, das standardmäßig nicht zugreifbar ist. Weiterhin muss, um Benutzern das Ändern ihres Passwortes mit <command>passwd</command> oder einem anderen Werkzeug zu erlauben, <emphasis>shadowLastChange</emphasis> zugreifbar sein, wenn sich der Benutzer legitimiert hat</para>

        <para>Um die Access Control List (ACL) zu betrachten, verwendet Sie das Werkzeug <application>ldapsearch</application>:</para>

<screen>
<command>ldapsearch -xLLL -b cn=config -D cn=admin,cn=config -W olcDatabase=hdb olcAccess</command>
</screen>

<screen>
<computeroutput>Enter LDAP Password: 
dn: olcDatabase={1}hdb,cn=config
olcAccess: {0}to attrs=userPassword,shadowLastChange by dn="cn=admin,dc=beispi
 el,dc=de" write by anonymous auth by self write by * none
olcAccess: {1}to dn.base="" by * read
olcAccess: {2}to * by dn="cn=admin,dc=example,dc=com" write by * read
</computeroutput>
</screen>

	</sect2>

        <sect2 id="openldap-tls" status="review">
          <title>TLD und SSL</title>

          <para>Bei der Legitimation gegen einen OpenLDAP-Server ist es das Beste, eine verschlüsselte Sitzung zu verwenden. Dies kann durch Verwendung von ransport Layer Security (TLS) bzw. Secure Sockets Layer (SSL) erreicht werden.</para>

          <para>Der erste Schritt bei einem solchen Vorgehen besteht darin, sich ein Zertifikat zu beschaffen oder zu erzeugen. Details dazu finden Sie in <xref linkend="certificates-and-security"/> und <xref linkend="certificate-authority"/>.</para>

          <para>Wenn Sie einen Zertifikatsschlüssel besitzen und CA Cert installiert haben, verwenden Sie <application>ldapmodify</application>, um neue Konfigurationsoptionen hinzuzufügen:</para>

<screen>
<command>ldapmodify -x -D cn=admin,cn=config -W</command>
</screen>

<screen>
<computeroutput>Enter LDAP Password:
<userinput>dn: cn=config
add: olcTLSCACertificateFile
olcTLSCACertificateFile: /etc/ssl/certs/cacert.pem
-
add: olcTLSCertificateFile
olcTLSCertificateFile: /etc/ssl/certs/server.crt
-
add: olcTLSCertificateKeyFile
olcTLSCertificateKeyFile: /etc/ssl/private/server.key</userinput>

modifying entry "cn=config"
</computeroutput>
</screen>

          <note>
            <para>Passen Sie die Namen <filename>server.crt</filename>, <filename>server.key</filename>, und <filename>cacert.pem</filename> an, wenn diese bei Ihnen anders lauten.</para>
          </note>

          <para>Als nächstes bearbeiten Sie die Datei <filename>/etc/default/slapd</filename> und entfernen die Kommentarzeichen bei der Option <emphasis>SLAPD_SERVICES</emphasis>:</para>

<programlisting>
SLAPD_SERVICES="ldap:/// ldapi:/// ldaps:///"
</programlisting>

          <para>Nun benötigt der Benutzer <emphasis>openldap</emphasis> Zugriff auf das Zertifikat:</para>

<screen>
<command>sudo adduser openldap ssl-cert</command>
<command>sudo chgrp ssl-cert /etc/ssl/private/server.key</command>
</screen>

          <note>
            <para>Wenn für <filename role="directory">/etc/ssl/private</filename> und <filename>/etc/ssl/private/server.key</filename> andere Zugriffsrechte bestehen, passen Sie die Befehle entsprechend an.</para>
          </note>

          <para>Schließlich starten Sie <application>slapd</application> neu:</para>

<screen>
<command>sudo /etc/init.d/slapd restart</command>
</screen>

          <para>Der <application>slapd</application>-Dienst sollte nun LDAPS-Verbindungen berücksichtigen und in der Lage sein, bei der Legitimation STARTTLS zu verwenden.</para>

          <sect3 id="openldap-tls-replication" status="review">
            <title>TLS-Replikation</title>

            <para>Wenn Sie <application>Syncrepl</application> zur Replikation zwischen Servern eingerichtet haben, ist es umsichtig, herbei den Netzverkehr zur Replikaten mit <emphasis>Transport Layer Security (TLS)</emphasis> zu verschlüsseln. Details zum Einrichten einer Replikation finden sich in <xref linkend="openldap-server-replication"/>.</para>

            <para>Nachdem Sie eine Replikation eingerichtet haben und die Anweisungen in <xref linkend="openldap-tls"/> befolgt haben, ergeben sich eine Reihe von Konsequenzen, die Sie berücksichtigen sollten:</para>

            <itemizedlist>
              <listitem>
                <para>Die Konfiguration muss nur auf <emphasis>einem</emphasis> Server angepasst werden.</para>
              </listitem>
              <listitem>
                <para>Die Pfadangaben für <emphasis>certificate</emphasis> und <emphasis>key</emphasis> müssen auf allen Servern gleich sein.</para>
              </listitem>
            </itemizedlist>

            <para>Daher müssen Sie auf jedem  Replikationsserver ein Zertifikat installieren, die Datei <filename>/etc/default/slapd</filename> bearbeiten und <application>slapd</application> neu starten.</para>

            <para>Nachdem <emphasis>TLS</emphasis> auf jedem Server eingerichtet ist, ändern Sie die <emphasis>cn=config</emphasis>-Replikation, indem Sie folgendes auf der Befehlszeile eingeben:</para>

<screen>
<command>ldapmodify -x -D cn=admin,cn=config -W</command>
</screen>

<screen>
<computeroutput>Enter LDAP Password: 
<userinput>dn: olcDatabase={0}config,cn=config
replace: olcSyncrepl
olcSyncrepl: {0}rid=001 provider=ldap://ldap01.beispiel.de binddn="cn=admin,cn
 =config" bindmethod=simple credentials=secret searchbase="cn=config" type=refre
 shAndPersist retry="5 5 300 5" timeout=1 starttls=yes
olcSyncrepl: {1}rid=002 provider=ldap://ldap02.beispiel.de binddn="cn=admin,cn
 =config" bindmethod=simple credentials=secret searchbase="cn=config" type=refre
 shAndPersist retry="5 5 300 5" timeout=1 starttls=yes</userinput>

modifying entry "olcDatabase={0}config,cn=config"
</computeroutput>
</screen>

            <para>Nun passen Sie die Replikation der <emphasis>Backend</emphasis>-Datenbank an:</para>

<screen>
<command>ldapmodify -x -D cn=admin,cn=config -W</command>
</screen>

<screen>
<computeroutput>Enter LDAP Password:
<userinput>dn: olcDatabase={1}hdb,cn=config
replace: olcSyncrepl
olcSyncrepl: {0}rid=003 provider=ldap://ldap01.beispiel.de binddn="cn=admin,dc=beispiel,dc=
 de" bindmethod=simple credentials=secret searchbase="dc=beispiel,dc=de" type=r
 efreshOnly interval=00:00:00:10 retry="5 5 300 5" timeout=1 starttls=yes
olcSyncrepl: {1}rid=004 provider=ldap://ldap02.beispiel.de binddn="cn=admin,dc=beispiel,dc=
 de" bindmethod=simple credentials=secret searchbase="dc=beispiel,dc=de" type=r
 efreshOnly interval=00:00:00:10 retry="5 5 300 5" timeout=1 starttls=yes</userinput>

modifying entry "olcDatabase={1}hdb,cn=config"</computeroutput>
</screen>

            <para>Wenn der Rechnername des LDAP-Servers nicht dem vollständig qualifizierten Domänennamen (FQDN) im Zertifikat entspricht, können Sie <filename>/etc/ldap/ldap.conf</filename> bearbeiten und die folgenden TLS-Optionen hinzufügen:</para>

<programlisting>
TLS_CERT /etc/ssl/certs/server.crt
TLS_KEY /etc/ssl/private/server.key
TLS_CACERT /etc/ssl/certs/cacert.pem
</programlisting>


              <para>Starten Sie schließlich <application>slapd</application> auf jedem Server neu:</para>

<screen>
<command>sudo /etc/init.d/slapd restart</command>
</screen>

          </sect3>

        </sect2>

        <sect2 id="openldap-auth-config" status="review">
          <title>LDAP-Legitimation</title>

          <para>Nachdem Sie über einen funktionierenden LDAP-Server verfügen, helfen Ihnen die Software-Pakete <application>auth-client-config</application> und <application>libnss-ldap</application> dabei, auf einem Ubuntu-Client die Legitimation über LDAP einzurichten. Um diese Software-Pakete zu installieren, geben Sie in der Befehlszeile ein:</para> 

<screen>
<command>sudo apt-get install libnss-ldap</command>
</screen>

         <para>Während der Installation wird ein Menü-Dialog Details über Ihren LDAP-Server von Ihnen erfragen.</para>
       
         <para>Wenn Ihnen bei der Eingabe ein Fehler unterläuft, können Sie den Dialog durch folgende Eingabe erneut ausführen:</para>

<screen>
<command>sudo dpkg-reconfigure ldap-auth-config</command>
</screen>

         <para>Die Ergebnisse des Dialog können in <filename>/etc/ldap.conf</filename> eingesehen werden. Wenn Ihr Server eine Option erfordert, die im Menü nicht angeboten wird, können Sie diese Datei entsprechend bearbeiten.</para>

         <para>Nachdem nun <application>libnss-ldap</application> konfiguriert ist, aktivieren Sid das LDAP-Profil <application>auth-client-config</application>, indem Sie folgendes eingeben:</para>

<screen>
<command>sudo auth-client-config -t nss -p lac_ldap</command>
</screen>
         
          <itemizedlist>
	    <listitem>
              <para><emphasis>-t:</emphasis> ändert nur <filename>/etc/nsswitch.conf</filename>.</para>
            </listitem>
	    <listitem>
              <para><emphasis>-p:</emphasis> legt den Namen des Profils fest, das aktiviert, deaktiviert usw. wird.</para>
	    </listitem>
	    <listitem>
              <para><emphasis>lac_ldap:</emphasis> das <application>auth-client-config</application>-Profil, das Teil des Software-Paketes <application>ldap-auth-config</application> ist.</para>
	    </listitem>
          </itemizedlist>

          <para>Verwenden Sie das Werkzeug <application>pam-auth-update</application>, um das System für die Verwendung von LDAP bei der Legitimation zu konfigurieren:</para>

<screen>
<command>sudo pam-auth-update</command>
</screen>

          <para>Im <application>pam-auth-update</application>-Menü wählen Sie LDAP oder eine anderen Legitimationsmechanismus, den Sie verwenden möchten, aus.</para>

          <para>Sie sollten jetzt in der Lage sein, sich mit den im LDAP-Server gespeicherten Benutzerdaten anzumelden.</para> 

          <note>
            <para>Wenn Sie LDAP dazu verwenden möchten, Samba-Benutzer zu speichern, müssen Sie den Server so konfigurieren, dass die Legitimation über LDAP erfolgt. Weitere Details dazu finden Sie unter <xref linkend="samba-ldap"/>.</para>
          </note>

        </sect2>
        <sect2 id="ldap-usergroup-management" status="review">
          <title>Verwaltung von Benutzern und Gruppen</title>

          <para>Das Software-Paket <application>ldap-utils</application> beinhaltet mehrere Werkzeuge zur Verwaltung des Verzeichnisses. Allerdings kann die erforderliche Eingabe der langen Zeichenketten mit den Optionen die Verwendiung sehr erschweren. Das Software-Paket <application>ldapscripts</application> beinhaltet konfigurierbare Skripte, die die Verwaltung von Benutzern und Gruppen in LDAP vereinfacht.</para>

          <para>Um das Software-Paket zu installieren, geben Sie auf der Befehlszeile ein:</para>

<screen>
<command>sudo apt-get install ldapscripts</command>
</screen>

          <para>Im nächsten Schritt bearbeiten Sie die Konfigurationsdatei <filename>/etc/ldapscripts/ldapscripts.conf</filename>. Entfernen Sie wie folgt die Kommentarzeichen und nehmen Sie entsprechend Ihrer Umgebung folgende Änderungen vor:</para>       

<programlisting>
SERVER=localhost
BINDDN='cn=admin,dc=beispiel,dc=de'
BINDPWDFILE="/etc/ldapscripts/ldapscripts.passwd"
SUFFIX='dc=beispiel,dc=de'
GSUFFIX='ou=Gruppen'
USUFFIX='ou=Personen'
MSUFFIX='ou=Rechner'
GIDSTART=10000
UIDSTART=10000
MIDSTART=10000
</programlisting>

          <para>Nun erzeugen Sie die Datei <filename>ldapscripts.passwd</filename>, um einen legitimierten Zugriff auf das Verzeichnis zu erlauben:</para>

<screen>
<command>sudo sh -c "echo -n 'geheim' &gt; /etc/ldapscripts/ldapscripts.passwd"</command>
<command>sudo chmod 400 /etc/ldapscripts/ldapscripts.passwd</command>
</screen>

          <note>
            <para>Ersetzen Sie <quote>geheim</quote> mit dem tatsächlichen Passworts des Benutzers für die LDAP-Administration.</para>
          </note>

          <para>Die <application>ldapscripts</application> stehen nun bereit, um Sie bei der Verwaltung Ihres Verzeichnisses zu unterstützen. Im Folgenden werden einige Beispiele zur Verwendung der Skripte dargestellt:</para>

          <itemizedlist>
	    <listitem>
              <para>Einen neuen Benutzer anlegen:</para>
<screen>
<command>sudo ldapadduser georg beispiel</command>
</screen>
              <para>Dieses erzeugt ein Benutzer mit der Kennung (uid) <emphasis role="italic">georg</emphasis> und legt die primäre Gruppe des Benuters (gid) auf <emphasis role="italic">example</emphasis> fest</para>
	    </listitem>
	    <listitem>
              <para>Passwort eines Benutzers ändern</para>
<screen>
<command>sudo ldapsetpasswd georg</command>
<computeroutput>Ändert das Passwort für den Benutzers uid=georg,ou=Personen,dc=beispiel,dc=de</computeroutput>
<userinput>New Password: </userinput>
<userinput>New Password (verify): </userinput>
</screen>
	    </listitem>
	    <listitem>
              <para>Einen Benutzer löschen:</para>
<screen>
<command>sudo ldapdeleteuser georg</command>
</screen>

	    </listitem>
	    <listitem>
              <para>Eine Gruppe hinzufügen:</para>
<screen>
<command>sudo ldapaddgroup qa</command>
</screen>
	    </listitem>
	    <listitem>
              <para>Eine Gruppe löschen:</para>
<screen>
<command>sudo ldapdeletegroup qa</command>
</screen>
	    </listitem>
	    <listitem>
              <para>Einen Benutzer zu einer Gruppe hinzufügen:</para>
<screen>
<command>sudo ldapaddusertogroup georg qa</command>
</screen>
              <para>Sie sollten nun ein <emphasis>memberUid</emphasis>-Attribut für die Gruppe <emphasis role="italic">qa</emphasis> mit einem Wert von <emphasis role="italic">georg</emphasis> sehen.</para>
	    </listitem>
            <listitem>
              <para>Einen Benutzer aus einer Gruppe entfernen</para>
<screen>
<command>sudo ldapdeleteuserfromgroup georg qa</command>
</screen>
              <para>Das <emphasis>memberUid</emphasis>-Attribute sollte nun aus der Gruppe <emphasis role="italic">qa</emphasis> entfernt worden sein.</para>
	    </listitem>
            <listitem>
              <para>Das Skript <application>ldapmodifyuser</application> erlaubt Ihnen, Attribute eines Benutzers hinzuzufügen, zu entfernen oder auszutauschen. Das Skript verwendet dieselbe Syntax wie das Werkzeug <application>ldapmodify</application>. Zum Beispiel:</para>
<screen>
<command>sudo ldapmodifyuser georg</command>
<computeroutput># About to modify the following entry :
dn: uid=georg,ou=Personen,dc=beispiel,dc=de
objectClass: account
objectClass: posixAccount
cn: georg
uid: georg
uidNumber: 1001
gidNumber: 1001
homeDirectory: /home/georg
loginShell: /bin/bash
gecos: georg
description: User account
userPassword:: e1NTSEF9eXFsTFcyWlhwWkF1eGUybVdFWHZKRzJVMjFTSG9vcHk=

# Enter your modifications here, end with CTRL-D.
dn: uid=georg,ou=Personen,dc=beispiel,dc=de</computeroutput>
<userinput>replace: gecos
gecos: Georg Carlin</userinput>
</screen>
              <para>Das <emphasis>gecos-Feld</emphasis> des Benutzers sollte nun mit <quote>George Carlin</quote> belegt sein.</para>
	    </listitem>
            <listitem>
              <para>Ein weitere großartige Eigenschaft von <application>ldapscripts</application> ist das Vorlagansystem. Vorlagen (engl. templates) erlauben es Ihnen, die Attribute von Benutzer-, Gruppen-, und Rehnerobjekten benutzerdefiniert anzupassen. Um beispielsweise die <emphasis>User</emphasis>-Vorlage zu aktivieren, bearbeiten Sie <filename>/etc/ldapscripts/ldapscripts.conf</filename> und ändern Sie:</para>

<programlisting>
UTEMPLATE="/etc/ldapscripts/ldapadduser.template"
</programlisting>

              <para>Es gibt <emphasis role="italic">Beispiel</emphasis>-Vorlagen in dem Ordner <filename>/etc/ldapscripts</filename>. Kopieren Sie die Datei <filename>ldapadduser.template.sample</filename> oder benennen Sie sie um <filename>/etc/ldapscripts/ldapadduser.template</filename> in:</para>

<screen>
<command>sudo cp /etc/ldapscripts/ldapadduser.template.sample /etc/ldapscripts/ldapadduser.template</command>
</screen>

              <para>Bearbeiten Sie die neue Vorlage und fügen Sie die gewünschten Attribute hinzu. Im Folgenden wird ein neuer Benutzer erstellt mit der <emphasis>objectClass</emphasis> <emphasis>inetOrgPerson</emphasis>:</para>

<programlisting>
dn: uid=&lt;user&gt;,&lt;usuffix&gt;,&lt;suffix&gt;
objectClass: inetOrgPerson
objectClass: posixAccount
cn: &lt;user&gt;
sn: &lt;ask&gt;
uid: &lt;user&gt;
uidNumber: &lt;uid&gt;
gidNumber: &lt;gid&gt;
homeDirectory: &lt;home&gt;
loginShell: &lt;shell&gt;
gecos: &lt;user&gt;
description: User account
title: Employee
</programlisting>

              <para>Beachten Sie die <emphasis>&lt;ask&gt;</emphasis>-Option, welche für den <emphasis>cn</emphasis> Wert verwendet wird. Wenn &lt;ask&gt; benutzt wird, wird <application>ldapadduser</application> so eingerichtet, dass der Wert für das Attribut während der Benutzereinrichtung abgefragt wird.</para>

	    </listitem>
          </itemizedlist>

          <para>Es gibt noch mehr nützliche Skripte in dem Paket. Um die vollständige Liste zu sehen, geben Sie <command>dpkg -L ldapscripts | grep bin</command> ein</para>

        </sect2>
	<sect2 id="openldap-server-resources" status="review">
	  <title>Quellen</title>
	  <itemizedlist>
	    <listitem>
              <para>Für mehr Informationen besuchen Sie die <ulink url="http://www.openldap.org/">OpenLDAP-Webseite</ulink></para>
	    </listitem>
	    <listitem>
              <para>Obwohl es schon in die Jahre kommt, ist O'Reilly's <ulink url="http://www.oreilly.com/catalog/ldapsa/">LDAP System Administration</ulink> eine großartige Quelle für tiefer gehende LDAP-Informationen.</para>
	    </listitem>
	    <listitem>
              <para>Packt's <ulink url="http://www.packtpub.com/OpenLDAP-Developers-Server-Open-Source-Linux/book">Mastering OpenLDAP</ulink> ist eine großartige Referenz, die auch neuere OpenLDAP-Versionen betrachtet.</para>
	    </listitem>
	    <listitem>
              <para>Weitere Informationen über <application>auth-client-config</application> finden Sie auf der Handbuch-Seite (Man-Page): <command>man auth-client-config</command>.</para>
	    </listitem>
	    <listitem>
              <para>Weitere Informationen zum Software-Paket <application>ldapscripts</application> finden Sie auf den Handbuch-Seiten (Man-Page): <command>man ldapscripts</command>, <command>man ldapadduser</command>, <command>man ldapaddgroup</command> usw.</para>
	    </listitem>
	  </itemizedlist>
	 
	</sect2>
  </sect1>
  <sect1 id="samba-ldap" status="review">
    <title>Samba und LDAP</title>

    <para>Dieser Abschnitt behandelt die Konfiguration von Samba um LDAP für die Benutzer-, Gruppen- und Rechner-Account-Informationen und Legitimierung. Die Annahme ist, dass Sie bereits ein funktionierendes OpenLDAP-Verzeichnis haben und der Server ist so eingerichtet, dass er für die Legimitation genutzt werden kann. Sehen Sie auch <xref linkend="openldap-server"/> und <xref linkend="openldap-auth-config"/> für Details über die Einrichtung von OpenLDAP.</para>

    <sect2 id="samba-ldap-installation" status="review">
      <title>Installation</title>
  
      <para>Es werden drei Software-Pakete benötigt, um Samba mit LDAP zu integrieren, <application>samba</application>, <application>samba-doc</application> und <application>smbldap-tools</application>-Pakete. Um die Software-Pakete von einem Terminal aus zu installieren, geben Sie ein:</para>

<screen>
<command>sudo apt-get install samba samba-doc smbldap-tools</command>
</screen>

      <para>Streng genommen wird das Software-Paket <application>smbldap-tools</application> nicht benötigt, aber solange Sie kein anderes Software-Paket oder eigene Skripte haben, brauchen Sie eine Möglichkeit um Benutzer, Gruppen und Rechner-Accounts zu verwalten.</para>

    </sect2>
    <sect2 id="samba-ldap-openldap-configuration" status="review">
      <title>OpenLDAP-Konfiguration</title>

      <para>Damit OpenLDAP in Samba als <emphasis>passdb backend</emphasis> zu nutzen, benötigen die Benutzerobjekte in dem Verzeichnis zusätzliche Attribute. Dieser Abschnitt geht davon aus, dass Sie Samba als Windows NT Domänencontroller konfigurieren möchten und wird die notwendigen LDAP Objekte und Attribute hinzufügen.</para>
      
      <itemizedlist>
        <listitem>
          <para>Die Sambaattribute sind in der <filename>samba.schema</filename>-Datei definiert, welche Teil des Software-Paketes <application>samba-doc</application>-Paketes ist. Die Schemadatei muss entpackt und kopiert werden nach <filename>/etc/ldap/schema</filename>. Auf der Befehlszeile geben Sie ein:</para>
        
<screen>
<command>sudo cp /usr/share/doc/samba-doc/examples/LDAP/samba.schema.gz /etc/ldap/schema/</command>
<command>sudo gzip -d /etc/ldap/schema/samba.schema.gz</command>
</screen>

         </listitem> 
         <listitem>

           <para>Das <emphasis>samba</emphasis>-Schema muss zu dem <emphasis>cn=config</emphasis>-Baum hinzugefügt werden. Die Vorgehensweise, um ein neues Schema zu <application>slapd</application> hinzuzufügen, findet sich ebenfalls detailliert unter <xref linkend="openldap-configuration"/>.</para>

           <procedure>
              <step>
                <para>Zuerst erstellen Sie eine Konfigurationsdatei mit dem Namen <filename>schema_convert.conf</filename> oder einem ähnlich sprechenden Namen, welche die folgenden Zeilen beinhaltet:</para>

<programlisting>
include /etc/ldap/schema/core.schema
include /etc/ldap/schema/collective.schema
include /etc/ldap/schema/corba.schema
include /etc/ldap/schema/cosine.schema
include /etc/ldap/schema/duaconf.schema
include /etc/ldap/schema/dyngroup.schema
include /etc/ldap/schema/inetorgperson.schema
include /etc/ldap/schema/java.schema
include /etc/ldap/schema/misc.schema
include /etc/ldap/schema/nis.schema
include /etc/ldap/schema/openldap.schema
include /etc/ldap/schema/ppolicy.schema
include /etc/ldap/schema/samba.schema
</programlisting>

              </step>
              <step>

                <para>Erzeugen Sie als Nächstes einen temporären Ordner, der dann die Ausgabe speichert:</para> 

<screen>
<command>mkdir /tmp/ldif_output</command>
</screen>

              </step>
              <step>

                <para>Benutzen Sie jetzt <application>slaptest</application>, um die Schemadateien zu konvertieren:</para>

<screen>
<command>slaptest -f schema_convert.conf -F /tmp/ldif_output</command>
</screen>

                <para>Passen Sie obige Datei- und Pfadnamen auf ihre eigenen an, falls Sie sich unterscheiden sollten.</para>

              </step>
              <step>

                <para>Passen Sie die erstellte <filename>/tmp/ldif_output/cn=config/cn=schema/cn={12}samba.ldif</filename>-Datei durch Änderung der folgenden Attribute an:</para> 

<programlisting>
dn: cn=samba,cn=schema,cn=config
...
cn: samba
</programlisting>

                <para>Und entfernen Sie folgende Zeilen am Ende der Datei:</para> 

<programlisting>
structuralObjectClass: olcSchemaConfig
entryUUID: b53b75ca-083f-102d-9fff-2f64fd123c95
creatorsName: cn=config
createTimestamp: 20080827045234Z
entryCSN: 20080827045234.341425Z#000000#000#000000
modifiersName: cn=config
modifyTimestamp: 20080827045234Z
</programlisting>

                <note>
                  <para>Die Attributwerte können variieren; stellen Sie einfach sicher, dass die Attribute entfernt werden.</para>
                </note>

              </step>
              <step>

                <para>Verwenden Sie abschließend das Werkzeug <application>ldapadd</application>, um das neue Schema zum Verzeichnis hinzuzufügen:</para>

<screen>
<command>ldapadd -x -D cn=admin,cn=config -W -f /tmp/ldif_output/cn\=config/cn\=schema/cn\=\{12\}samba.ldif</command>
</screen>

              </step>
            </procedure>

            <para>Es sollte ein Eintrag <emphasis>dn: cn={X}misc,cn=schema,cn=config</emphasis> geben, wobei »X« der sequentiell nächste Eintrag im  cn=config Baum ist.</para> 

          </listitem>
          <listitem>

            <para>Kopieren Sie das Folgende und fügen es in einer Datei Namens <filename>samba_indexes.ldif</filename> ein:</para>

<programlisting>
dn: olcDatabase={1}hdb,cn=config
changetype: modify
add: olcDbIndex
olcDbIndex: uidNumber eq
olcDbIndex: gidNumber eq
olcDbIndex: loginShell eq
olcDbIndex: uid eq,pres,sub
olcDbIndex: memberUid eq,pres,sub
olcDbIndex: uniqueMember eq,pres
olcDbIndex: sambaSID eq
olcDbIndex: sambaPrimaryGroupSID eq
olcDbIndex: sambaGroupType eq
olcDbIndex: sambaSIDList eq
olcDbIndex: sambaDomainName eq
olcDbIndex: default sub
</programlisting>

            <para>Benutzen Sie das <application>ldapmodify</application>-Programm, um die neuen Indices zu laden.</para>

<screen>
<command>ldapmodify -x -D cn=admin,cn=config -W -f samba_indexes.ldif</command>
</screen>
            <para>Wenn alles klappt, sollte man die neuen Indices durch Benutzung von <application>ldapsearch</application> sehen:</para>

<screen>
<command>ldapsearch -xLLL -D cn=admin,cn=config -x -b cn=config -W olcDatabase={1}hdb</command>
</screen>

          </listitem>
          <listitem>
 
            <para>Als nächstes, konfigurieren Sie das Software-Paket <application>smbldap-tools</application>, um es auf Ihre Umgebung anzupassen. Das Paket kommt mit einem Konfigurationsskript, welches Fragen zu den benötigten Optionen stellt. Um das Skript zu starten, geben Sie ein:</para>

<screen>
<command>sudo gzip -d /usr/share/doc/smbldap-tools/configure.pl.gz</command>
<command>sudo perl /usr/share/doc/smbldap-tools/configure.pl</command>
</screen>

            <para>Wenn Sie die Fragen beantwortet haben, sollten die Dateien <filename>/etc/smbldap-tools/smbldap.conf</filename> und <filename>/etc/smbldap-tools/smbldap_bind.conf</filename> vorhanden sein. Diese Dateien werden durch das Konfigurationsskript generiert. Wenn Sie bei der Ausführung des Skripts einen Fehler gemacht haben, kann es einfacher sein, direkt die Datei richtig anzupassen.</para>

          </listitem>
          <listitem>

            <para>Das <application>smbldap-populate</application>-Skript wird die notwendigen Benutzer, Gruppen und LDAP Objekte anlegen, die für Samba benötigt werden. Es ist eine gute Idee, eine LDAP Data Interchange Format (LDIF) Sicherungsdatei mit  <application>slapcat</application> anzulegen, bevor Sie den Befehl ausführen:</para>

<screen>
<command>sudo slapcat -l backup.ldif</command>
</screen>
          
          </listitem>
          <listitem>

            <para>Wenn Sie eine aktuelle Sicherung haben, führen Sie <application>smbldap-populate</application> aus durch :</para>

<screen>
<command>sudo smbldap-populate</command>
</screen>

          <note>
            <para>Sie können mit <command>sudo smbldap-populate -e samba.ldif</command> eine LDIF-Datei erstellen, die die neuen Sambaobjekte enthält. Dies bietet die Möglichkeit, sich die Änderungen anzusehen und so sicherzustellen, dass alles korrekt ist.</para>
          </note>
        </listitem>
      </itemizedlist>

      <para>Das LDAP-Verzeichnis enthält jetzt die notwendigen Domäneninformationen, um Samba-Benutzer zu authentifizieren.</para>

    </sect2>
    <sect2 id="samba-ldap-samba-configuration">
      <title>Samba-Konfiguration</title>

      <para>Es gibt verschiedene Wege, um Samba zu konfigurieren. Für Details über die üblichen Konfigurationen finden Sie in <xref linkend="windows-networking"/>. Um Samba zur LDAP Benutzung zu konfigurieren, bearbeiten Sie die Samba-Hauptkonfigurationsdatei <filename>/etc/samba/smb.conf</filename> durch Auskommentieren von der <emphasis>passdb backend</emphasis>-Option und hinzufügen der folgenden Zeilen:</para>

<programlisting>
#   passdb backend = tdbsam

# LDAP Settings
   passdb backend = ldapsam:ldap://hostname
   ldap suffix = dc=example,dc=com
   ldap user suffix = ou=People
   ldap group suffix = ou=Groups
   ldap machine suffix = ou=Computers
   ldap idmap suffix = ou=Idmap
   ldap admin dn = cn=admin,dc=example,dc=com
   ldap ssl = start tls
   ldap passwd sync = yes
...
   add machine script = sudo /usr/sbin/smbldap-useradd -t 0 -w "%u"
</programlisting>

      <para>Starten Sie <application>samba</application> neu, um die neuen Einstellungen zu aktivieren.</para>

<screen>
<command>sudo /etc/init.d/samba restart</command>
</screen>

      <para>Jetzt muss Samba das LDAP-Administratorkennwort kennen. Auf der Befehlszeile geben Sie ein:</para>

<screen>
<command>sudo smbpasswd -w secret</command>
</screen>

      <note>
        <para>Ersetzen Sie <emphasis role="italic">secret</emphasis> mit Ihrem LDAP-Administratorkennwort.</para>
      </note>

      <para>Wenn Sie schon Benutzer im LDAP haben und sie wollen diese mit Samba authentifizieren, dann müssen Sie einige Samba-Attribute, welche in der <filename>samba.schema</filename>-Datei definiert sind, hinzufügen. Die Samba-Attribute fügen Sie zu vorhandenen Benutzer über das <application>smbpasswd</application> Programm hinzu. Ersetzen Sie <emphasis role="italic">username</emphasis> mit einem richtigen Benutzer:</para>

<screen>
<command>sudo smbpasswd -a username</command>
</screen>

      <para>Sie werden gebeten, dass Benutzerkennwort einzugeben.</para>

      <para>Um einen neuen Benutzer, eine neue Gruppe und Maschinenkonten anzulegen, benutzen Sie die Programme aus dem <application>smbldap-tools</application>-Paket. Hier einige Beispiele:</para> 

      <itemizedlist>
        <listitem>
          <para>Um einen neuen Benutzer im LDAP mit Sambaattributen hinzuzufügen, geben Sie das Folgende ein und ersetzen dabei username mit einem richigen Benutzernamen:</para>
<screen>
<command>sudo smbldap-useradd -a -P username</command>
</screen>
          <para>Die <emphasis>-a</emphasis>-Option fügt die Sambaattribute hinzu und die <emphasis>-P</emphasis>-Option gibt dem <application>smbldap-passwd</application>-Programm vor, dass nach dem Anlegen des Benutzers das Kennwort eingegeben werden kann.</para>
        </listitem>
        <listitem>
          <para>Um Benutzer aus dem Verzeichnis zu entfernen:</para>
<screen>
<command>sudo smbldap-userdel username</command>
</screen>
          <para>Das <application>smbldap-userdel</application>-Programm hat ebenfalls eine <emphasis>-r</emphasis>-Option um den persönlichen Ordners des Benutzers zu löschen.</para>
        </listitem>
        <listitem>
          <para>Nutzen Sie <application>smbldap-groupadd</application>, um eine Gruppe hinzuzufügen. Ersetzen sie groupname mit einer passenden Gruppe.</para>
<screen>
<command>sudo smbldap-groupadd -a groupname</command>
</screen>
          <para>Genau wie bei <application>smbldap-useradd</application> fügt <emphasis>-a</emphasis> die Samba-Attribute hinzu.</para>
        </listitem>
        <listitem>
          <para>Um einen Benutzer zu einer Gruppe hinzuzufügen benutzen, Sie <application>smbldap-groupmod</application>:</para>
<screen>
<command>sudo smbldap-groupmod -m username groupname</command>
</screen>
          <para>Passen Sie auf, dass sie <emphasis>username</emphasis> durch einen realen Benutzer ersetzen. Außerdem kann die <emphasis>-m</emphasis>-Option mehrere Benutzer auf einmal hinzufügen, wenn sie in einem  <emphasis>Komma separiertem</emphasis>-Format vorliegen.</para>
        </listitem>
        <listitem>
          <para><application>smbldap-groupmod</application> kann auch genutzt werden, um einen Benutzer aus einer Gruppe zu entfernen.</para>
<screen>
<command>sudo smbldap-groupmod -x username groupname</command>
</screen>
        </listitem>
        <listitem>
          <para>Zusätzlich kann das <application>smbldap-useradd</application>-Programm auch Samba-Maschinenkonten anlegen:</para>
<screen>
<command>sudo smbldap-useradd -t 0 -w username</command>
</screen>
          <para>Ersetzen Sie <emphasis>username</emphasis> mit dem Namen des Arbeitsplatzes. Die <emphasis>-t 0</emphasis> Option erstellt das Maschinenkonto ohne Verzögerung, während die <emphasis>-w</emphasis> Option angibt, dass es sich bei dem  Benutzer um ein Maschinenkonto handelt. Beachten Sie außerdem, dass die <emphasis>add machine script</emphasis> Option in <filename>/etc/samba/smb.conf</filename> geändert wurde um <application>smbldap-useradd</application> zu benutzen.</para>
        </listitem>
      </itemizedlist>

      <para>Es gibt noch mehr hilfreiche Programme und Optionen im <application>smbldap-tools</application>-Paket. Die Handbuchseite (Man-Page) zu jeden Programm bringen mehr Details.</para>

    </sect2>
    <sect2 id="samba-ldap-resources" status="review">
      <title>Quellen</title>

      <itemizedlist>
        <listitem>
          <para>Es gibt verschiedene Stellen in der <ulink url="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/">Samba HOWTO Collection</ulink>, an denen LDAP und Samba dokumentiert sind .</para>
        </listitem>
        <listitem>
          <para>Speziell sehen Sie sich die <ulink url="http://samba.org/samba/docs/man/Samba-HOWTO-Collection/passdb.html">passdb Sektion</ulink> an.</para>
        </listitem>
        <listitem>
          <para>Eine weitere gute Seite ist das <ulink url="http://www.iallanis.info/smbldap-tools/docs/samba-ldap-howto/">Samba OpenLDAP HOWTO</ulink>.</para>
        </listitem>
        <listitem>
          <para>Nocheinmal, weitere Informationen erfahren Sie <application>smbldap-tools</application>, wenn Sie sich die  Handbuchseiten (Man-Pages) ansehen: <command>man smbldap-useradd</command>, <command>man smbldap-groupadd</command>, <command>man smbldap-populate</command>, etc.</para>
        </listitem>
      </itemizedlist>
    </sect2>
  </sect1>
  <sect1 id="kerberos" status="review">
    <title>Kerberos</title>
    
    <para><application>Kerberos</application> ist ein Netzwerk-Authentifizierungssystem, das auf dem Prinzip einer vertrauten dritten Stelle basiert. Die beiden anderen Stellen sind der Benutzer und nutzen den Dienst, an dem sich der Benutzer authentisieren möchte. Nicht alle Dienste und Anwendungen können Kerberos nutzen, aber die, die es können, bringen die Netzwerkumgebung einen Schritt näher an ein Single Sign On (SSO).</para>

    <para>Dieser Abschnitt behandelt die Installation und Konfiguration eines Kerberos Servers und einige Client-Konfiguratonen.</para>
    
    <sect2 id="kerberos-overview" status="review">
      <title>Überblick</title>

      <para>Wenn Kerberos neu für Sie ist, gibt es einige Ausdrücke die für das Verständnis erforderlich sind, bevor Sie einen Kerberos-Server einrichten. Viele der Ausdrücke werden sich auf Dinge beziehen, die Sie vielleicht aus anderen Umgebungen kennen:</para>

      <itemizedlist>
        <listitem>
          <para><emphasis>Principal:</emphasis> jeder Benutzer, Rechner und Dienst, der von einem Server angeboten wird, muss als Kerberos-Principal definiert werden.</para>
        </listitem>
        <listitem>
          <para><emphasis>Instanzen:</emphasis> werden für Principals von Diensten und speziellen administrativen Principals genutzt.</para>
        </listitem>
        <listitem>
          <para><emphasis>Realms:</emphasis> ist den  Bereich, der von einer Kerberos-Installation kontrolliert wird. typischerweise wird er mit dem Domänenname in Großbuchstaben bezeichnet (BEISPIEL.DE).</para>
        </listitem>
        <listitem>
          <para>
          <emphasis>Key Distribution Center:</emphasis> (KDC) consist of three parts, a database of all principals, the authentication server,
          and the ticket granting server.  For each realm there must be at least one KDC.
          </para>
        </listitem>
        <listitem>
          <para>
          <emphasis>Ticket Granting Ticket:</emphasis> issued by the Authentication Server (AS), the Ticket Granting Ticket (TGT) is encrypted in 
          the user's password which is known only to the user and the KDC.
          </para>
        </listitem>
        <listitem>
          <para>
          <emphasis>Ticket Granting Server:</emphasis> (TGS) issues service tickets to clients upon request.
          </para>
        </listitem>
        <listitem>
          <para>
          <emphasis>Tickets:</emphasis> confirm the identity of the two principals.  One principal being a user and the other a service requested by 
          the user.  Tickets establish an encryption key used for secure communication during the authenticated session.
          </para>
        </listitem>
        <listitem>
          <para>
          <emphasis>Keytab Files:</emphasis> are files extracted from the KDC principal database and contain the encryption key for a service or
          host.
          </para>
        </listitem>
      </itemizedlist>

      <para>
      To put the pieces together, a Realm has at least one KDC, preferably two for redundancy, which contains a database of Principals.  When a 
      user principal logs into a workstation, configured for Kerberos authentication, the KDC issues a Ticket Granting Ticket (TGT).  If the user
      supplied credentials match, the user is authenticated and can then request tickets for Kerberized services from the Ticket Granting Server
      (TGS).  The service tickets allow the user to authenticate to the service without entering another username and password.
      </para>
   
    </sect2>
    <sect2 id="kerberos-server" status="review">
      <title>Kerberos Server</title>    
      <sect3 id="kerberos-server-installation" status="review">
        <title>Installation</title>

        <para> 
        Before installing the Kerberos server a properly configured DNS server is needed for your domain.  Since the Kerberos Realm by 
        convention matches the domain name, this section uses the <emphasis>example.com</emphasis> domain configured in 
        <xref linkend="dns-primarymaster-configuration"/>.  
        </para>

        <para>
        Also, Kerberos is a time sensitive protocol.  So if the local system time between a client machine and the server differs by
        more than five minutes (by default), the workstation will not be able to authenticate.  To correct the problem all hosts 
        should have their time synchronized using the <emphasis>Network Time Protocol (NTP)</emphasis>.  For details
        on setting up NTP see <xref linkend="NTP"/>.
        </para>

        <para>
        The first step in installing a Kerberos Realm is to install the <application>krb5-kdc</application>  and 
        <application>krb5-admin-server</application> packages.  From a terminal enter:
        </para>

<screen>
<command>sudo apt-get install krb5-kdc krb5-admin-server</command>
</screen>

        <para>
        You will be asked at the end of the install to supply a name for the Kerberos and Admin servers, which may or may not be the 
        same server, for the realm.
        </para>

        <para>
        Next, create the new realm with the <application>kdb5_newrealm</application> utility:
        </para>

<screen>
<command>sudo krb5_newrealm</command>
</screen>

      </sect3>
      <sect3 id="kerberos-server-configuration" status="review">
        <title>Konfiguration</title>
      
        <para>
        The questions asked during installation are used to configure the <filename>/etc/krb5.conf</filename> file.  If you need to adjust 
        the Key Distribution Center (KDC) settings simply edit the file and restart the <application>krb5-kdc</application> daemon.
        </para>

        <procedure>
          <step>

            <para>
            Now that the KDC running an admin user is needed.  It is recommended to use a different username from your everyday username.  
            Using the <application>kadmin.local</application> utility in a terminal prompt enter:
            </para>

<screen>
<command>sudo kadmin.local</command>
<computeroutput>Authenticating as principal root/admin@EXAMPLE.COM with password.
kadmin.local:</computeroutput><userinput> addprinc steve/admin</userinput>
<computeroutput>WARNING: no policy specified for steve/admin@EXAMPLE.COM; defaulting to no policy
Enter password for principal "steve/admin@EXAMPLE.COM": 
Re-enter password for principal "steve/admin@EXAMPLE.COM": 
Principal "steve/admin@EXAMPLE.COM" created.
kadmin.local:</computeroutput><userinput> quit</userinput>
</screen>

            <para>
            In the the above example <emphasis role="italic">steve</emphasis> is the <emphasis>Principal</emphasis>, 
            <emphasis role="italic">/admin</emphasis> is an <emphasis>Instance</emphasis>, and 
            <emphasis role="italic">@EXAMPLE.COM</emphasis> signifies the realm.  The <emphasis role="italic">"every day"</emphasis>
            Principal would be <emphasis>steve@EXAMPLE.COM</emphasis>, and should have only normal user rights.            
            </para>

            <note>
              <para>
              Replace <emphasis>EXAMPLE.COM</emphasis> and <emphasis>steve</emphasis> with your Realm and admin username.
              </para>
            </note>

          </step>
          <step>
 
            <para>Als nächstes muss der neue Administrator Benutzer die richtigen Access Control List (ACL) Berechtigungen haben. Die Berechtigungen werden in der Datei <filename>/etc/krb5kdc/kadm5.acl</filename> konfiguriert:</para>

<programlisting>
steve/admin@EXAMPLE.COM        *
</programlisting>

            <para>Dieser Eintrag überträgt <emphasis>steve/admin</emphasis> die Möglichkeit jede Operation auf alle Mandanten des Realms durchzuführen.</para>

          </step>
          <step>

            <para>Jetzt starten Sie den <application>krb5-admin-server</application> neu damit die ACL übernommen wird:</para>

<screen>
<command>sudo /etc/init.d/krb5-admin-server restart</command>
</screen>

          </step>
          <step>

            <para>Der neue Benutzer Mandant kann getestet werden mit dem <application>kinit Programm</application>:</para>

<screen>
<command>kinit steve/admin</command>
<computeroutput>steve/admin@EXAMPLE.COM's Password:</computeroutput>
</screen>          

            <para>
            After entering the password, use the <application>klist</application> utility to view information about the 
            Ticket Granting Ticket (TGT):
            </para>

<screen>
<command>klist</command>
<computeroutput>Credentials cache: FILE:/tmp/krb5cc_1000
        Principal: steve/admin@EXAMPLE.COM

  Issued           Expires          Principal
Jul 13 17:53:34  Jul 14 03:53:34  krbtgt/EXAMPLE.COM@EXAMPLE.COM</computeroutput>
</screen>

            <para>Sie müssen für den KDC einen Eintrag in der Datei <filename>/etc/hosts</filename> hinzufügen.</para>
            
<programlisting>
192.168.0.1   kdc01.example.com       kdc01
</programlisting>

            <para>Ersetzen Sie <emphasis>192.168.0.1</emphasis> mit der IP-Adresse Ihres KDC.</para>

          </step>
          <step>
          
            <para>
            In order for clients to determine the KDC for the Realm some DNS SRV records are needed.  Add the following to 
            <filename>/etc/named/db.example.com</filename>:
            </para>

<programlisting>
_kerberos._udp.EXAMPLE.COM.     IN SRV 1  0 88  kdc01.example.com.
_kerberos._tcp.EXAMPLE.COM.     IN SRV 1  0 88  kdc01.example.com.
_kerberos._udp.EXAMPLE.COM.     IN SRV 10 0 88  kdc02.example.com. 
_kerberos._tcp.EXAMPLE.COM.     IN SRV 10 0 88  kdc02.example.com. 
_kerberos-adm._tcp.EXAMPLE.COM. IN SRV 1  0 749 kdc01.example.com.
_kpasswd._udp.EXAMPLE.COM.      IN SRV 1  0 464 kdc01.example.com.
</programlisting>

            <note>
              <para>
              Replace <emphasis>EXAMPLE.COM</emphasis>, <emphasis>kdc01</emphasis>, and <emphasis>kdc02</emphasis> with your 
              domain name, primary KDC, and secondary KDC.
              </para>
            </note>

            <para>
            See <xref linkend="dns"/> for detailed instructions on setting up DNS.
            </para>

          </step>
        </procedure>
       
        <para>
        Your new Kerberos Realm is now ready to authenticate clients.
        </para>

      </sect3>
    </sect2>
    <sect2 id="kerberos-secondary-kdc" status="review">
      <title>Sekundärer KDC</title>

      <para>Wenn Sie ein Key Distribution Center (KDC) in Ihrem Netzwerk haben, ist es eine gute Praxis, einen sekundären KDC zu haben, falls der primäre unerreichbar wird.</para> 
      
      <procedure>
        <step>
        
        <para>Zuerst installieren Sie die Pakete und wenn Sie nach dem Kerberos- und Administratorserver Namen geben Sie den Namen des primären KDCs an:</para>

<screen>
<command>sudo apt-get install krb5-kdc krb5-admin-server</command>
</screen>

        </step>
        <step>

        <para>
        Once you have the packages installed, create the Secondary KDC's host principal.  From a terminal prompt, enter:
        </para>

<screen>
<command>kadmin -q "addprinc -randkey host/kdc02.example.com"</command>
</screen>
    
        <note>
          <para>
          After, issuing any <application>kadmin</application> commands you will be prompted for your 
          <emphasis>username/admin@EXAMPLE.COM</emphasis> principal password.
          </para>
        </note>
      
        </step>
        <step>

          <para>Entpacken Sie die <emphasis>keytab</emphasis>-Datei:</para>

<screen>
<command>kadmin -q "ktadd -k keytab.kdc02 host/kdc02.example.com"</command>
</screen>

        </step>
        <step>

          <para>
          There should now be a <filename>keytab.kdc02</filename> in the current directory, move the file to 
          <filename>/etc/krb5.keytab</filename>:
          </para>

<screen>
<command>sudo mv keytab.kdc02 /etc/krb5.keytab</command>
</screen>

          <note>
            <para>
            If the path to the <filename>keytab.kdc02</filename> file is different adjust accordingly. 
            </para>
          </note>

          <para>
          Also, you can list the principals in a Keytab file, which can be useful when troubleshooting, using the 
          <application>klist</application> utility:
          </para>

<screen>
<command>sudo klist -k /etc/krb5.keytab</command>
</screen>

        </step>
        <step>

          <para>
          Next, there needs to be a <filename>kpropd.acl</filename> file on each KDC that lists all KDCs for the Realm.  For example, 
          on both primary and secondary KDC, create <filename>/etc/krb5kdc/kpropd.acl</filename>:
          </para>

<programlisting>
host/kdc01.example.com@EXAMPLE.COM
host/kdc02.example.com@EXAMPLE.COM
</programlisting>

        </step>
        <step>

          <para>
          Create an empty database on the <emphasis>Secondary KDC</emphasis>:
          </para>

<screen>
<command>sudo kdb5_util -s create</command>
</screen>

        </step>
        <step>

          <para>
          Now start the <application>kpropd</application> daemon, which listens for connections from the 
          <application>kprop</application> utility.  <application>kprop</application> is used to transfer 
          dump files:
          </para>

<screen>
<command>sudo kpropd -S</command>
</screen>
      
        </step>
        <step>

          <para>
          From a terminal on the <emphasis>Primary KDC</emphasis>, create a dump file of the principal database:
          </para>

<screen>
<command>sudo kdb5_util dump /var/lib/krb5kdc/dump</command>
</screen>

        </step>
        <step>

          <para>
          Extract the Primary KDC's <emphasis>keytab</emphasis> file and copy it to <filename>/etc/krb5.keytab</filename>:
          </para>

<screen>
<command>kadmin -q "ktadd -k keytab.kdc01 host/kdc01.example.com"</command>
<command>sudo mv keytab.kdc01 /etc/kr5b.keytab</command>
</screen>

          <note>
            <para>
            Make sure there is a <emphasis>host</emphasis> for <emphasis>kdc01.example.com</emphasis> before extracting the Keytab.
            </para>
          </note>

        </step>
        <step>

          <para>
          Using the <application>kprop</application> utility push the database to the Secondary KDC:
          </para>

<screen>
<command>sudo kprop -r EXAMPLE.COM -f /var/lib/krb5kdc/dump kdc02.example.com</command>
</screen>

          <note>
            <para>
            There should be a <emphasis>SUCCEEDED</emphasis> message if the propagation worked.  If there is an error 
            message check <filename>/var/log/syslog</filename> on the secondary KDC for more information.
            </para>
          </note>
      
          <para>
          You may also want to create a <application>cron</application> job to periodically update the database on the Secondary KDC.  For 
          example, the following will push the database every hour:
          </para>

<programlisting>
# m h  dom mon dow   command
0 * * * * /usr/sbin/kdb5_util dump /var/lib/krb5kdc/dump &amp;&amp; /usr/sbin/kprop -r EXAMPLE.COM -f /var/lib/krb5kdc/dump kdc02.example.com
</programlisting>
  
        </step>
        <step>

          <para>
          Back on the <emphasis>Secondary KDC</emphasis>, create a <emphasis>stash</emphasis> file to hold the Kerberos 
          master key:
          </para>

<screen>
<command>sudo kdb5_util stash</command>
</screen>

        </step>
        <step>

          <para>
          Finally, start the <application>krb5-kdc</application> daemon on the Secondary KDC:
          </para>

<screen>
<command>sudo /etc/init.d/krb5-kdc start</command>
</screen>

        </step>
      </procedure>

      <para>
      The <emphasis>Secondary KDC</emphasis> should now be able to issue tickets for the Realm.  You can test this by stopping 
      the <application>krb5-kdc</application> daemon on the Primary KDC, then use <application>kinit</application> to request a ticket.
      If all goes well you should receive a ticket from the Secondary KDC.
      </para>

    </sect2>
    <sect2 id="kerberos-linux-client" status="review">
      <title>Kerberos Linux Client</title>    

      <para>
      This section covers configuring a Linux system as a <application>Kerberos</application> client.  This will allow access
      to any kerberized services once a user has successfully logged into the system.
      </para>

      <sect3 id="kerberos-client-installation" status="review">
        <title>Installation</title>

        <para>
        In order to authenticate to a Kerberos Realm, the <application>krb5-user</application> and <application>libpam-krb5</application>
        packages are needed, along with a few others that are not strictly necessary but make life easier.  To install the packages 
        enter the following in a terminal prompt:
        </para>

<screen>
<command>sudo apt-get install krb5-user libpam-krb5 libpam-ccreds auth-client-config</command>
</screen>

        <para>
        The <application>auth-client-config</application> package allows simple configuration of PAM for authentication from multiple 
        sources, and the <application>libpam-ccreds</application> will cache authentication credentials allowing you to login in case the 
        Key Distribution Center (KDC) is unavailable.  This package is also useful for laptops that may authenticate using Kerberos while 
        on the corporate network, but will need to be accessed off the network as well.
        </para>

      </sect3>
      <sect3 id="kerberos-client-configuration" status="review">
        <title>Konfiguration</title>

        <para>
        To configure the client in a terminal enter:
        </para>

<screen>
<command>sudo dpkg-reconfigure krb5-config</command>
</screen>

        <para>
        You will then be prompted to enter the name of the Kerberos Realm.  Also, if you don't have DNS configured with Kerberos 
        <emphasis>SRV</emphasis> records, the menu will prompt you for the hostname of the Key Distribution Center (KDC) and 
        Realm Administration server.
        </para>

        <para>
        The <application>dpkg-reconfigure</application> adds entries to the <filename>/etc/krb5.conf</filename> file for your Realm.
        You should have entries similar to the following:
        </para>

<programlisting>
[libdefaults]
        default_realm = EXAMPLE.COM
...
[realms]
        EXAMPLE.COM = }                
                kdc = 192.168.0.1               
                admin_server = 192.168.0.1
        }
</programlisting>

        <para>
        You can test the configuration by requesting a ticket using the <application>kinit</application> utility.  For example:
        </para>

<screen>
<command>kinit steve@EXAMPLE.COM</command>
<computeroutput>Password for steve@EXAMPLE.COM:</computeroutput>
</screen>

        <para>
        When a ticket has been granted, the details can be viewed using <application>klist</application>:
        </para>

<screen>
<command>klist</command>
<computeroutput>Ticket cache: FILE:/tmp/krb5cc_1000
Default principal: steve@EXAMPLE.COM

Valid starting     Expires            Service principal
07/24/08 05:18:56  07/24/08 15:18:56  krbtgt/EXAMPLE.COM@EXAMPLE.COM
        renew until 07/25/08 05:18:57


Kerberos 4 ticket cache: /tmp/tkt1000
klist: You have no tickets cached</computeroutput>
</screen>

        <para>
        Next, use the <application>auth-client-config</application> to configure the <application>libpam-krb5</application> module
        to request a ticket during login:
        </para>

<screen>
<command>sudo auth-client-config -a -p kerberos_example</command>
</screen>

        <para>
        You will should now receive a ticket upon successful login authentication. 
        </para>

      </sect3>
    </sect2>
    <sect2 id="kerberos-resources" status="review">
      <title>Quellen</title>

      <itemizedlist>
        <listitem>
          <para>
          For more information on Kerberos see the <ulink url="http://web.mit.edu/Kerberos/">MIT Kerberos</ulink> site.
          </para>
        </listitem>
        <listitem>
          <para>
          O'Reilly's <ulink url="http://oreilly.com/catalog/9780596004033/">Kerberos: The Definitive Guide</ulink> is a great reference when
          setting up Kerberos.
          </para>
        </listitem>
        <listitem>
          <para>
          Also, feel free to stop by the <emphasis>#ubuntu-server</emphasis> IRC channel on <ulink url="http://freenode.net/">Freenode</ulink>  
          if you have Kerberos questions.
          </para>
        </listitem>
      </itemizedlist>

    </sect2>
  </sect1>
  <sect1 id="kerberos-ldap" status="review">
    <title>Kerberos and LDAP</title>

    <para>
    Replicating a Kerberos principal database between two servers can be complicated, and adds an additional user
    database to your network.  Fortunately, MIT Kerberos can be configured to use an <application>LDAP</application>
    directory as a principal database.  This section covers configuring a primary and secondary kerberos server to use
    <application>OpenLDAP</application> for the principal database.
    </para>

    <sect2 id="kerberos-ldap-openldap" status="review">
      <title>Configuring OpenLDAP</title>

      <para>
      First, the necessary <emphasis>schema</emphasis> needs to be loaded on an <application>OpenLDAP</application> server that has
      network connectivity to the Primary and Secondary KDCs.  The rest of this section assumes that you also have LDAP replication
      configured between at least two servers.  For information on setting up OpenLDAP see <xref linkend="openldap-server"/>.
      </para>

      
      <para>
      It is also required to configure OpenLDAP for TLS and SSL connections, so that traffic between the KDC and LDAP server is encrypted.
      See <xref linkend="openldap-tls"/> for details.
      </para>
      
      <itemizedlist>
        <listitem>
          <para>
          To load the schema into LDAP, on the LDAP server install the <application>krb5-kdc-ldap</application> package.
          From a terminal enter:
          </para>

<screen>
<command>sudo apt-get install krb5-kdc-ldap</command>
</screen>

        </listitem>
        <listitem>
          <para>
          Next, extract the <filename>kerberos.schema.gz</filename> file:
          </para>

<screen>
<command>sudo gzip -d /usr/share/doc/krb5-kdc-ldap/kerberos.schema.gz</command>
<command>sudo cp /usr/share/doc/krb5-kdc-ldap/kerberos.schema /etc/ldap/schema/</command>
</screen>

        </listitem>
        <listitem>

           <para>
           The <emphasis>kerberos</emphasis> schema needs to be added to the <emphasis>cn=config</emphasis> tree.
           The procedure to add a new schema to <application>slapd</application> is also detailed in 
           <xref linkend="openldap-configuration"/>.
           </para>

           <procedure>
              <step>
                <para>Zuerst erstellen Sie eine Konfigurationsdatei mit dem Namen <filename>schema_convert.conf</filename> oder einem ähnlich sprechenden Namen, welche die folgenden Zeilen beinhaltet:</para>

<programlisting>
include /etc/ldap/schema/core.schema
include /etc/ldap/schema/collective.schema
include /etc/ldap/schema/corba.schema
include /etc/ldap/schema/cosine.schema
include /etc/ldap/schema/duaconf.schema
include /etc/ldap/schema/dyngroup.schema
include /etc/ldap/schema/inetorgperson.schema
include /etc/ldap/schema/java.schema
include /etc/ldap/schema/misc.schema
include /etc/ldap/schema/nis.schema
include /etc/ldap/schema/openldap.schema
include /etc/ldap/schema/ppolicy.schema
include /etc/ldap/schema/kerberos.schema
</programlisting>


                </step>
                <step>

                  <para>
                   Create a temporary directory to hold the LDIF files:
                  </para>
<screen>
<command>mkdir /tmp/ldif_output</command>
</screen>

                </step>
                <step>

                  <para>Benutzen Sie jetzt <application>slaptest</application>, um die Schemadateien zu konvertieren:</para>

<screen>
<command>slaptest -f schema_convert.conf -F /tmp/ldif_output</command>
</screen>

                  <para>Passen Sie obige Datei- und Pfadnamen auf ihre eigenen an, falls Sie sich unterscheiden sollten.</para>
                
                </step>
                <step>

                  <para>
                  Edit the generated <filename>/tmp/ldif_output/cn=config/cn=schema/cn={12}kerberos.ldif</filename>
                  file, changing the following attributes: 
                  </para>

<programlisting>
dn: cn=kerberos,cn=schema,cn=config
...
cn: kerberos
</programlisting>

                  <para>
                  And remove the following lines from the end of the file:
                  </para>

<programlisting>
structuralObjectClass: olcSchemaConfig
entryUUID: 18ccd010-746b-102d-9fbe-3760cca765dc
creatorsName: cn=config
createTimestamp: 20090111203515Z
entryCSN: 20090111203515.326445Z#000000#000#000000
modifiersName: cn=config
modifyTimestamp: 20090111203515Z
</programlisting>

                  <note>
                    <para>Die Attributwerte können variieren; stellen Sie einfach sicher, dass die Attribute entfernt werden.</para>
                  </note>

                </step>
                <step>

                  <para>
                  Load the new schema with <application>ldapadd</application>:
                  </para>

<screen>
<command>ldapadd -x -D cn=admin,cn=config -W -f /tmp/ldif_output/cn\=config/cn\=schema/cn\=\{12\}kerberos.ldif</command>
</screen>

                </step>
                <step>
        
                  <para>
                  Add an index for the <emphasis>krb5principalname</emphasis> attribute:
                  </para>

<screen>
<command>ldapmodify -x -D cn=admin,cn=config -W</command>
<computeroutput>Enter LDAP Password:
<userinput>dn: olcDatabase={1}hdb,cn=config
add: olcDbIndex
olcDbIndex: krbPrincipalName eq,pres,sub</userinput>

modifying entry "olcDatabase={1}hdb,cn=config"</computeroutput>
</screen>
      
                </step>
                <step>
        
                  <para>
                  Finally, update the Access Control Lists (ACL):
                  </para>

<screen>
<command>ldapmodify -x -D cn=admin,cn=config -W</command>
<computeroutput>Enter LDAP Password: 
<userinput>dn: olcDatabase={1}hdb,cn=config
replace: olcAccess
olcAccess: to attrs=userPassword,shadowLastChange,krbPrincipalKey by dn="cn=admin,dc=exampl
 e,dc=com" write by anonymous auth by self write by * none
-
add: olcAccess
olcAccess: to dn.base="" by * read
-
add: olcAccess
olcAccess: to * by dn="cn=admin,dc=example,dc=com" write by * read</userinput>

modifying entry "olcDatabase={1}hdb,cn=config"
</computeroutput>
</screen>
      
                </step>
           </procedure>    
        </listitem>
      </itemizedlist>

      <para>
      That's it, your LDAP directory is now ready to serve as a Kerberos principal database.
      </para>

    </sect2>
    <sect2 id="kerberos-ldap-primary-kdc" status="review">
      <title>Primary KDC Configuration</title>

      <para>
      With <application>OpenLDAP</application> configured it is time to configure the KDC.
      </para>

      <itemizedlist>
        <listitem>
          <para>
          First, install the necessary packages, from a terminal enter:
          </para>

<screen>
<command>sudo apt-get install krb5-kdc krb5-admin-server krb5-kdc-ldap</command>
</screen>

        </listitem>
        <listitem>

          <para>
          Now edit <filename>/etc/krb5.conf</filename> adding the following options to under the appropriate sections:
          </para>

<programlisting>
[libdefaults]
        default_realm = EXAMPLE.COM

...

[realms]
        EXAMPLE.COM = {
                kdc = kdc01.example.com
                kdc = kdc02.example.com
                admin_server = kdc01.example.com
                admin_server = kdc02.example.com
                default_domain = example.com
                database_module = openldap_ldapconf
        }

...

[domain_realm]
        .example.com = EXAMPLE.COM


...

[dbdefaults]
        ldap_kerberos_container_dn = dc=example,dc=com

[dbmodules]
        openldap_ldapconf = {
                db_library = kldap
                ldap_kdc_dn = "cn=admin,dc=example,dc=com"

                # this object needs to have read rights on
                # the realm container, principal container and realm sub-trees
                ldap_kadmind_dn = "cn=admin,dc=example,dc=com"

                # this object needs to have read and write rights on
                # the realm container, principal container and realm sub-trees
                ldap_service_password_file = /etc/krb5kdc/service.keyfile
                ldap_servers = ldaps://ldap01.example.com ldaps://ldap02.example.com
                ldap_conns_per_server = 5
        }
</programlisting>

          <note>
            <para>
            Change <emphasis>example.com</emphasis>, <emphasis>dc=example,dc=com</emphasis>, <emphasis>cn=admin,dc=example,dc=com</emphasis>,
            and <emphasis>ldap01.example.com</emphasis> to the appropriate domain, LDAP object, and LDAP server for your network.
            </para>
          </note>

        </listitem>
        <listitem>
        
          <para>
          Next, use the <application>kdb5_ldap_util</application> utility to create the realm:
          </para>

<screen>
<command>sudo kdb5_ldap_util -D  cn=admin,dc=example,dc=com create -subtrees dc=example,dc=com -r EXAMPLE.COM -s -H ldap://ldap01.example.com</command>
</screen>
      
        </listitem>
        <listitem>
        
          <para>
          Create a stash of the password used to bind to the LDAP server.  This password is used by the <emphasis>ldap_kdc_dn</emphasis> and        
          <emphasis>ldap_kadmin_dn</emphasis> options in <filename>/etc/krb5.conf</filename>:
          </para>

<screen>
<command>sudo kdb5_ldap_util -D  cn=admin,dc=example,dc=com stashsrvpw -f /etc/krb5kdc/service.keyfile cn=admin,dc=example,dc=com</command>
</screen>
      
        </listitem>
        <listitem>
        
          <para>
          Copy the CA certificate from the LDAP server:
          </para>

<screen>
<command>scp ldap01:/etc/ssl/certs/cacert.pem .</command>
<command>sudo cp cacert.pem /etc/ssl/certs</command>
</screen>

          <para> 
          And edit <filename>/etc/ldap/ldap.conf</filename> to use the certificate:
          </para>

<programlisting>
TLS_CACERT /etc/ssl/certs/cacert.pem
</programlisting>

          <note>
            <para>
            The certificate will also need to be copied to the Secondary KDC, to allow the connection to the LDAP servers using
            LDAPS.
            </para>
          </note>
      
        </listitem>
      </itemizedlist>

      <para>
      You can now add Kerberos principals to the LDAP database, and they will be copied to any other LDAP servers configured for replication.
      To add a principal using the <application>kadmin.local</application> utility enter:
      </para>

<screen>
<command>sudo kadmin.local</command>
<computeroutput>Authenticating as principal root/admin@EXAMPLE.COM with password.
kadmin.local:  <userinput>addprinc -x dn="uid=steve,ou=people,dc=example,dc=com" steve</userinput>
WARNING: no policy specified for steve@EXAMPLE.COM; defaulting to no policy
Enter password for principal "steve@EXAMPLE.COM": 
Re-enter password for principal "steve@EXAMPLE.COM": 
Principal "steve@EXAMPLE.COM" created.</computeroutput>
</screen>

      <para>
      There should now be krbPrincipalName, krbPrincipalKey, krbLastPwdChange, and krbExtraData attributes added to the 
      <emphasis>uid=steve,ou=people,dc=example,dc=com</emphasis> user object.  Use the <application>kinit</application> and 
      <application>klist</application> utilities to test that the user is indeed issued a ticket.
      </para>

      <note>
        <para>
        If the user object is already created the <emphasis>-x dn="..."</emphasis> option is needed to add the Kerberos attributes.
        Otherwise a new <emphasis>principal</emphasis> object will be created in the realm subtree.
        </para>
      </note>

    </sect2>
    <sect2 id="kerberos-ldap-secondary-kdc" status="review">
      <title>Secondary KDC Configuration</title>

      <para>
      Configuring a Secondary KDC using the LDAP backend is similar to configuring one using the normal Kerberos database.
      </para>

      <itemizedlist>
        <listitem>
          <para>
          First, install the necessary packages.  In a terminal enter:
          </para>

<screen>
<command>sudo apt-get install krb5-kdc krb5-admin-server krb5-kdc-ldap</command>
</screen>

        </listitem>
        <listitem>

          <para>
          Next, edit <filename>/etc/krb5.conf</filename> to use the LDAP backend:
          </para>

<programlisting>
[libdefaults]
        default_realm = EXAMPLE.COM

...

[realms]
        EXAMPLE.COM = {
                kdc = kdc01.example.com
                kdc = kdc02.example.com
                admin_server = kdc01.example.com
                admin_server = kdc02.example.com
                default_domain = example.com
                database_module = openldap_ldapconf
        }

...

[domain_realm]
        .example.com = EXAMPLE.COM

...

[dbdefaults]
        ldap_kerberos_container_dn = dc=example,dc=com

[dbmodules]
        openldap_ldapconf = {
                db_library = kldap
                ldap_kdc_dn = "cn=admin,dc=example,dc=com"

                # this object needs to have read rights on
                # the realm container, principal container and realm sub-trees
                ldap_kadmind_dn = "cn=admin,dc=example,dc=com"

                # this object needs to have read and write rights on
                # the realm container, principal container and realm sub-trees
                ldap_service_password_file = /etc/krb5kdc/service.keyfile
                ldap_servers = ldaps://ldap01.example.com ldaps://ldap02.example.com
                ldap_conns_per_server = 5
        }
</programlisting>


        </listitem>
        <listitem>
        
      <para>
      Create the stash for the LDAP bind password:
      </para>

<screen>
<command>sudo kdb5_ldap_util -D  cn=admin,dc=example,dc=com stashsrvpw -f /etc/krb5kdc/service.keyfile cn=admin,dc=example,dc=com</command>
</screen>
      
        </listitem>
        <listitem>

          <para>
          Now, on the <emphasis>Primary KDC</emphasis> copy the <filename>/etc/krb5kdc/.k5.EXAMPLE.COM</filename> 
          <emphasis>Master Key</emphasis> stash to the Secondary KDC.  Be sure to copy the file over an encrypted 
          connection such as <application>scp</application>, or on physical media.
          </para>

<screen>
<command>sudo scp /etc/krb5kdc/.k5.EXAMPLE.COM steve@kdc02.example.com:~</command>
<command>sudo mv .k5.EXAMPLE.COM /etc/krb5kdc/</command>
</screen>

        <note>
          <para>
          Again, replace <emphasis>EXAMPLE.COM</emphasis> with your actual realm.
          </para>
        </note>

        </listitem>
        <listitem>

          <para>
          Finally, start the <application>krb5-kdc</application> daemon:
          </para>

<screen>
<command>sudo /etc/init.d/krb5-kdc start</command>
</screen>

        </listitem>
      </itemizedlist>

      <para>
      You now have redundant KDCs on your network, and with redundant LDAP servers you should be able to 
      continue to authenticate users if one LDAP server, one Kerberos server, or one LDAP and one Kerberos 
      server become unavailable. 
      </para>

    </sect2>
    <sect2 id="kerberos-ldap-resources" status="review">
      <title>Quellen</title>

      <itemizedlist>
        <listitem>
          <para>
          The <ulink url="http://web.mit.edu/Kerberos/krb5-1.6/krb5-1.6.3/doc/krb5-admin.html#Configuring-Kerberos-with-OpenLDAP-back_002dend">
          Kerberos Admin Guide</ulink> has some additional details.
          </para>
        </listitem>
        <listitem>
          <para>
          For more information on <application>kdb5_ldap_util</application> see 
          <ulink url="http://web.mit.edu/Kerberos/krb5-1.6/krb5-1.6.3/doc/krb5-admin.html#Global-Operations-on-the-Kerberos-LDAP-Database">
          Section 5.6</ulink> and the 
          <ulink url="http://manpages.ubuntu.com/manpages/jaunty/en/man8/kdb5_ldap_util.8.html">kdb5_ldap_util man page</ulink>.
          </para>
        </listitem>
        <listitem>
          <para>
          Another useful link is the <ulink url="http://manpages.ubuntu.com/manpages/jaunty/en/man5/krb5.conf.5.html">krb5.conf man page</ulink>.
          </para>
        </listitem>
      </itemizedlist>

    </sect2>
  </sect1>
</chapter>
